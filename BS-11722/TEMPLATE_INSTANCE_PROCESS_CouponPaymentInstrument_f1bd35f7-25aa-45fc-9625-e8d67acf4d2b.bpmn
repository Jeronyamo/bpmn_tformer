<?xml version="1.0" encoding="UTF-8"?>
<bpmn:definitions xmlns:bpmn="http://www.omg.org/spec/BPMN/20100524/MODEL" xmlns:bpmndi="http://www.omg.org/spec/BPMN/20100524/DI" xmlns:camunda="http://camunda.org/schema/1.0/bpmn" xmlns:dc="http://www.omg.org/spec/DD/20100524/DC" xmlns:di="http://www.omg.org/spec/DD/20100524/DI" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:bioc="http://bpmn.io/schema/bpmn/biocolor/1.0" id="Definitions_1" targetNamespace="http://bpmn.io/schema/bpmn" exporter="Camunda Modeler" exporterVersion="3.4.1"><bpmn:process id="TEMPLATE_INSTANCE_PROCESS_CouponPaymentInstrument_f1bd35f7-25aa-45fc-9625-e8d67acf4d2b" name="Выплата купона по инструменту" isExecutable="true"><bpmn:documentation /><bpmn:startEvent id="StartEvent_1"><bpmn:outgoing>SequenceFlow_0or7jn6</bpmn:outgoing></bpmn:startEvent><bpmn:endEvent id="EndEvent_0djl7a3"><bpmn:incoming>SequenceFlow_1ipv7pi</bpmn:incoming></bpmn:endEvent><bpmn:sequenceFlow id="SequenceFlow_0or7jn6" sourceRef="StartEvent_1" targetRef="Activity_055zv9q" /><bpmn:serviceTask id="ServiceTask_1bg1mhj" name="Статус Подтверждено"><bpmn:extensionElements><camunda:properties><camunda:property name="isEzdocServiceTask" value="true" /><camunda:property name="ezdocServiceTaskType" value="request" /><camunda:property name="requestType" value="GENERIC" /></camunda:properties><camunda:connector><camunda:inputOutput><camunda:inputParameter name="headers"><camunda:map><camunda:entry key="Accept">*/*</camunda:entry><camunda:entry key="Content-Type">application/json</camunda:entry></camunda:map></camunda:inputParameter><camunda:inputParameter name="url">${ezdocUrl}/api/camunda/instance/enrichment/saveLabel/${instanceId}?label=Подтверждено</camunda:inputParameter><camunda:inputParameter name="method">POST</camunda:inputParameter></camunda:inputOutput><camunda:connectorId>http-connector</camunda:connectorId></camunda:connector></bpmn:extensionElements><bpmn:incoming>SequenceFlow_0yf6y97</bpmn:incoming><bpmn:outgoing>SequenceFlow_03rewy1</bpmn:outgoing></bpmn:serviceTask><bpmn:sequenceFlow id="SequenceFlow_03rewy1" sourceRef="ServiceTask_1bg1mhj" targetRef="ServiceTask_1lr659d" /><bpmn:serviceTask id="ServiceTask_1n1fr9v" name="Получить значение из объекта" camunda:asyncAfter="true"><bpmn:extensionElements><camunda:properties><camunda:property name="isEzdocServiceTask" value="true" /><camunda:property name="ezdocServiceTaskType" value="request" /><camunda:property name="requestType" value="GENERIC" /></camunda:properties><camunda:connector><camunda:inputOutput><camunda:inputParameter name="headers"><camunda:map><camunda:entry key="Accept">*/*</camunda:entry><camunda:entry key="Content-Type">application/json</camunda:entry></camunda:map></camunda:inputParameter><camunda:inputParameter name="url">${ezdocUrl}/api/camunda/common/executeRequest</camunda:inputParameter><camunda:inputParameter name="method">POST</camunda:inputParameter><camunda:inputParameter name="payload">{
    "find": "enrichment",
    "filter": {
        "_id": ObjectId("${instanceId}")
    },
    "projection": {
        "attributes.AssetFlows___lkupClient___ValueDisplayed": 1
    }
}</camunda:inputParameter><camunda:outputParameter name="clientPrimaryId"><camunda:script scriptFormat="javascript">JSON.parse(response).cursor.firstBatch[0].attributes.AssetFlows___lkupClient___ValueDisplayed.primaryId</camunda:script></camunda:outputParameter><camunda:outputParameter name="clientSource"><camunda:script scriptFormat="javascript">JSON.parse(response).cursor.firstBatch[0].attributes.AssetFlows___lkupClient___ValueDisplayed.source</camunda:script></camunda:outputParameter></camunda:inputOutput><camunda:connectorId>http-connector</camunda:connectorId></camunda:connector></bpmn:extensionElements><bpmn:incoming>Flow_09lu4yt</bpmn:incoming><bpmn:outgoing>SequenceFlow_0pvahkb</bpmn:outgoing></bpmn:serviceTask><bpmn:sequenceFlow id="SequenceFlow_0pvahkb" sourceRef="ServiceTask_1n1fr9v" targetRef="ServiceTask_020uorz" /><bpmn:serviceTask id="ServiceTask_020uorz" name="Сохранить значение из связанного объекта"><bpmn:extensionElements><camunda:properties><camunda:property name="isEzdocServiceTask" value="true" /><camunda:property name="ezdocServiceTaskType" value="request" /><camunda:property name="requestType" value="GENERIC" /></camunda:properties><camunda:connector><camunda:inputOutput><camunda:inputParameter name="headers"><camunda:map><camunda:entry key="Accept">*/*</camunda:entry><camunda:entry key="Content-Type">application/json</camunda:entry></camunda:map></camunda:inputParameter><camunda:inputParameter name="url">${ezdocUrl}/api/camunda/instance/enrichment/${instanceId}/setAttributes</camunda:inputParameter><camunda:inputParameter name="method">POST</camunda:inputParameter><camunda:inputParameter name="payload">{
 "hlk_app_id": "${clientPrimaryId}"
}</camunda:inputParameter></camunda:inputOutput><camunda:connectorId>http-connector</camunda:connectorId></camunda:connector></bpmn:extensionElements><bpmn:incoming>SequenceFlow_0pvahkb</bpmn:incoming><bpmn:outgoing>SequenceFlow_0tsmnqr</bpmn:outgoing></bpmn:serviceTask><bpmn:sequenceFlow id="SequenceFlow_0tsmnqr" sourceRef="ServiceTask_020uorz" targetRef="Activity_0e8pjgf" /><bpmn:serviceTask id="ServiceTask_11wvth6" name="Получить номер обязательства"><bpmn:extensionElements><camunda:properties><camunda:property name="isEzdocServiceTask" value="true" /><camunda:property name="ezdocServiceTaskType" value="request" /><camunda:property name="requestType" value="GENERIC" /></camunda:properties><camunda:connector><camunda:inputOutput><camunda:inputParameter name="headers"><camunda:map><camunda:entry key="Accept">*/*</camunda:entry><camunda:entry key="Content-Type">application/json</camunda:entry></camunda:map></camunda:inputParameter><camunda:inputParameter name="url">${ezdocUrl}/api/camunda/instance/enrichment/${instanceId}/getAttribute/AssetFlows___txtID___ValueDisplayed</camunda:inputParameter><camunda:inputParameter name="method">GET</camunda:inputParameter><camunda:inputParameter name="payload" /><camunda:outputParameter name="assetflowid">${response}</camunda:outputParameter></camunda:inputOutput><camunda:connectorId>http-connector</camunda:connectorId></camunda:connector></bpmn:extensionElements><bpmn:incoming>Flow_04wrr6j</bpmn:incoming><bpmn:outgoing>SequenceFlow_0o6jqpa</bpmn:outgoing></bpmn:serviceTask><bpmn:sequenceFlow id="SequenceFlow_0o6jqpa" sourceRef="ServiceTask_11wvth6" targetRef="ServiceTask_093rfnw" /><bpmn:serviceTask id="ServiceTask_093rfnw" name="Формируем отчёт"><bpmn:extensionElements><camunda:properties><camunda:property name="isEzdocServiceTask" value="true" /><camunda:property name="ezdocServiceTaskType" value="request" /><camunda:property name="requestType" value="GENERIC" /></camunda:properties><camunda:connector><camunda:inputOutput><camunda:inputParameter name="headers"><camunda:map><camunda:entry key="Accept">*/*</camunda:entry><camunda:entry key="Content-Type">application/json</camunda:entry></camunda:map></camunda:inputParameter><camunda:inputParameter name="url">${ezdocUrl}/api/report-service/generate-report-save/by-name?name=CouponTicketReport</camunda:inputParameter><camunda:inputParameter name="method">POST</camunda:inputParameter><camunda:inputParameter name="payload">[
	{
		"displayName": "Номер заказа",
		"name": "FlowId",
		"value":  "${assetflowid}"
	}
]</camunda:inputParameter><camunda:outputParameter name="generated">${response}</camunda:outputParameter></camunda:inputOutput><camunda:connectorId>http-connector</camunda:connectorId></camunda:connector></bpmn:extensionElements><bpmn:incoming>SequenceFlow_0o6jqpa</bpmn:incoming><bpmn:outgoing>SequenceFlow_0zhzfvs</bpmn:outgoing></bpmn:serviceTask><bpmn:sequenceFlow id="SequenceFlow_0zhzfvs" sourceRef="ServiceTask_093rfnw" targetRef="ServiceTask_0zuy7vw" /><bpmn:serviceTask id="ServiceTask_0zuy7vw" name="Привязываем отчёт к обязательству"><bpmn:extensionElements><camunda:connector><camunda:inputOutput><camunda:inputParameter name="url">${ezdocUrl}/api/camunda/instance/file/create/ENRICHMENT/${instanceId}</camunda:inputParameter><camunda:inputParameter name="method">POST</camunda:inputParameter><camunda:inputParameter name="headers"><camunda:map><camunda:entry key="Accept">*/*</camunda:entry><camunda:entry key="Content-Type">application/json</camunda:entry></camunda:map></camunda:inputParameter><camunda:inputParameter name="payload">${generated}</camunda:inputParameter></camunda:inputOutput><camunda:connectorId>http-connector</camunda:connectorId></camunda:connector></bpmn:extensionElements><bpmn:incoming>SequenceFlow_0zhzfvs</bpmn:incoming><bpmn:outgoing>SequenceFlow_186bmfk</bpmn:outgoing></bpmn:serviceTask><bpmn:sequenceFlow id="SequenceFlow_1mefry5" sourceRef="Gateway_18zfpzg" targetRef="ServiceTask_1itkaaz"><bpmn:conditionExpression xsi:type="bpmn:tFormalExpression">${"KZT".equals(ccy)}</bpmn:conditionExpression></bpmn:sequenceFlow><bpmn:exclusiveGateway id="Gateway_18zfpzg" default="SequenceFlow_0faby30"><bpmn:incoming>SequenceFlow_1oz3cfp</bpmn:incoming><bpmn:outgoing>SequenceFlow_1mefry5</bpmn:outgoing><bpmn:outgoing>SequenceFlow_0faby30</bpmn:outgoing></bpmn:exclusiveGateway><bpmn:serviceTask id="ServiceTask_0e1uuwi" name="Получение курса валюты"><bpmn:extensionElements><camunda:properties><camunda:property name="isEzdocServiceTask" value="true" /><camunda:property name="ezdocServiceTaskType" value="request" /><camunda:property name="requestType" value="GENERIC" /></camunda:properties><camunda:connector><camunda:inputOutput><camunda:inputParameter name="headers"><camunda:map><camunda:entry key="Accept">*/*</camunda:entry><camunda:entry key="Content-Type">application/json</camunda:entry></camunda:map></camunda:inputParameter><camunda:inputParameter name="url">${msUrl}/api/FXRates?ccyCode1=${ccy}&amp;ccyCode2=KZT&amp;rateSet=NBRK&amp;dateHist=${date.substring(0,10)}</camunda:inputParameter><camunda:inputParameter name="method">GET</camunda:inputParameter><camunda:outputParameter name="rate">${response}</camunda:outputParameter></camunda:inputOutput><camunda:connectorId>http-connector</camunda:connectorId></camunda:connector></bpmn:extensionElements><bpmn:incoming>SequenceFlow_0faby30</bpmn:incoming><bpmn:outgoing>SequenceFlow_0tnturo</bpmn:outgoing></bpmn:serviceTask><bpmn:sequenceFlow id="SequenceFlow_0faby30" sourceRef="Gateway_18zfpzg" targetRef="ServiceTask_0e1uuwi" /><bpmn:serviceTask id="ServiceTask_051yabk" name="Получение данных из объекта для расчета суммы в KZT"><bpmn:extensionElements><camunda:properties><camunda:property name="isEzdocServiceTask" value="true" /><camunda:property name="ezdocServiceTaskType" value="request" /><camunda:property name="requestType" value="GENERIC" /></camunda:properties><camunda:connector><camunda:inputOutput><camunda:inputParameter name="headers"><camunda:map><camunda:entry key="Accept">*/*</camunda:entry><camunda:entry key="Content-Type">application/json</camunda:entry></camunda:map></camunda:inputParameter><camunda:inputParameter name="url">${ezdocUrl}/api/camunda/instance/enrichment/${instanceId}/getAttributes?systemName=AssetFlows___lkupAsset___ValueDisplayed&amp;systemName=AssetFlows___txtQtyPcs___Value&amp;systemName=AssetFlows___dateFlowDate___ValueDisplayed</camunda:inputParameter><camunda:inputParameter name="method">GET</camunda:inputParameter><camunda:outputParameter name="ccy"><camunda:script scriptFormat="javascript">JSON.parse(response).AssetFlows___lkupAsset___ValueDisplayed</camunda:script></camunda:outputParameter><camunda:outputParameter name="amount"><camunda:script scriptFormat="javascript">JSON.parse(response).AssetFlows___txtQtyPcs___Value</camunda:script></camunda:outputParameter><camunda:outputParameter name="date"><camunda:script scriptFormat="javascript">JSON.parse(response).AssetFlows___dateFlowDate___ValueDisplayed</camunda:script></camunda:outputParameter></camunda:inputOutput><camunda:connectorId>http-connector</camunda:connectorId></camunda:connector></bpmn:extensionElements><bpmn:incoming>SequenceFlow_0nlcfr2</bpmn:incoming><bpmn:outgoing>SequenceFlow_1oz3cfp</bpmn:outgoing></bpmn:serviceTask><bpmn:sequenceFlow id="SequenceFlow_1oz3cfp" sourceRef="ServiceTask_051yabk" targetRef="Gateway_18zfpzg" /><bpmn:sequenceFlow id="SequenceFlow_0tnturo" sourceRef="ServiceTask_0e1uuwi" targetRef="ServiceTask_139zij8" /><bpmn:serviceTask id="ServiceTask_139zij8" name="Расчет суммы в валюте KZT" camunda:expression="${amount * rate}" camunda:resultVariable="amount"><bpmn:incoming>SequenceFlow_0tnturo</bpmn:incoming><bpmn:outgoing>SequenceFlow_1z0g30k</bpmn:outgoing></bpmn:serviceTask><bpmn:sequenceFlow id="SequenceFlow_1z0g30k" sourceRef="ServiceTask_139zij8" targetRef="ServiceTask_1itkaaz" /><bpmn:serviceTask id="ServiceTask_1itkaaz" name="Сохранение суммы в KZT"><bpmn:extensionElements><camunda:properties><camunda:property name="isEzdocServiceTask" value="true" /><camunda:property name="ezdocServiceTaskType" value="request" /><camunda:property name="requestType" value="GENERIC" /></camunda:properties><camunda:connector><camunda:inputOutput><camunda:inputParameter name="headers"><camunda:map><camunda:entry key="Accept">*/*</camunda:entry><camunda:entry key="Content-Type">application/json</camunda:entry></camunda:map></camunda:inputParameter><camunda:inputParameter name="url">${ezdocUrl}/api/camunda/instance/enrichment/${instanceId}/setAttributes</camunda:inputParameter><camunda:inputParameter name="method">POST</camunda:inputParameter><camunda:inputParameter name="payload">{"amountKZT": ${amount}}</camunda:inputParameter></camunda:inputOutput><camunda:connectorId>http-connector</camunda:connectorId></camunda:connector></bpmn:extensionElements><bpmn:incoming>SequenceFlow_1mefry5</bpmn:incoming><bpmn:incoming>SequenceFlow_1z0g30k</bpmn:incoming><bpmn:outgoing>SequenceFlow_0yf6y97</bpmn:outgoing></bpmn:serviceTask><bpmn:sequenceFlow id="SequenceFlow_0yf6y97" sourceRef="ServiceTask_1itkaaz" targetRef="ServiceTask_1bg1mhj" /><bpmn:serviceTask id="Activity_055zv9q" name="Статус Новая"><bpmn:extensionElements><camunda:properties><camunda:property name="isEzdocServiceTask" value="true" /><camunda:property name="ezdocServiceTaskType" value="request" /><camunda:property name="requestType" value="GENERIC" /></camunda:properties><camunda:connector><camunda:inputOutput><camunda:inputParameter name="headers"><camunda:map><camunda:entry key="Accept">*/*</camunda:entry><camunda:entry key="Content-Type">application/json</camunda:entry></camunda:map></camunda:inputParameter><camunda:inputParameter name="url">${ezdocUrl}/api/camunda/instance/enrichment/saveLabel/${instanceId}?label=Новая</camunda:inputParameter><camunda:inputParameter name="method">POST</camunda:inputParameter></camunda:inputOutput><camunda:connectorId>http-connector</camunda:connectorId></camunda:connector></bpmn:extensionElements><bpmn:incoming>SequenceFlow_0or7jn6</bpmn:incoming><bpmn:outgoing>Flow_09lu4yt</bpmn:outgoing></bpmn:serviceTask><bpmn:sequenceFlow id="Flow_09lu4yt" sourceRef="Activity_055zv9q" targetRef="ServiceTask_1n1fr9v" /><bpmn:serviceTask id="Activity_0oyrqvm" name="Найти связанный объект клиент"><bpmn:extensionElements><camunda:properties><camunda:property name="isEzdocServiceTask" value="true" /><camunda:property name="ezdocServiceTaskType" value="request" /><camunda:property name="requestType" value="GENERIC" /></camunda:properties><camunda:connector><camunda:inputOutput><camunda:inputParameter name="headers"><camunda:map><camunda:entry key="Accept">*/*</camunda:entry><camunda:entry key="Content-Type">application/json</camunda:entry></camunda:map></camunda:inputParameter><camunda:inputParameter name="url">${ezdocUrl}/api/camunda/common/executeRequest</camunda:inputParameter><camunda:inputParameter name="method">POST</camunda:inputParameter><camunda:inputParameter name="payload">{
    "find": "${clientSource}",
    "filter": {
        "primaryId": "${clientPrimaryId}",
		"activityStatus": "ACTIVE"
    },
    "projection": {
        "attributes.hlk_app_id": 1
    }
}</camunda:inputParameter><camunda:outputParameter name="hlk_app_id"><camunda:script scriptFormat="javascript">JSON.parse(response).cursor.firstBatch[0].attributes.hlk_app_id</camunda:script></camunda:outputParameter></camunda:inputOutput><camunda:connectorId>http-connector</camunda:connectorId></camunda:connector></bpmn:extensionElements></bpmn:serviceTask><bpmn:serviceTask id="Activity_0e8pjgf" name="Получение данных из объекта для счета"><bpmn:extensionElements><camunda:properties><camunda:property name="isEzdocServiceTask" value="true" /><camunda:property name="ezdocServiceTaskType" value="request" /><camunda:property name="requestType" value="GENERIC" /></camunda:properties><camunda:connector><camunda:inputOutput><camunda:inputParameter name="headers"><camunda:map><camunda:entry key="Accept">*/*</camunda:entry><camunda:entry key="Content-Type">application/json</camunda:entry></camunda:map></camunda:inputParameter><camunda:inputParameter name="url">${ezdocUrl}/api/camunda/instance/enrichment/${instanceId}/getAttributes?systemName=AssetFlows___lkupAsset___ValueDisplayed&amp;systemName=AssetFlows___lkupCS___ValueDisplayed&amp;systemName=AssetFlows___dateFlowDate___ValueDisplayed</camunda:inputParameter><camunda:inputParameter name="method">GET</camunda:inputParameter><camunda:outputParameter name="ccyCS"><camunda:script scriptFormat="javascript">JSON.parse(response).AssetFlows___lkupAsset___ValueDisplayed</camunda:script></camunda:outputParameter><camunda:outputParameter name="CS"><camunda:script scriptFormat="javascript">JSON.parse(response).AssetFlows___lkupCS___ValueDisplayed</camunda:script></camunda:outputParameter><camunda:outputParameter name="date"><camunda:script scriptFormat="javascript">JSON.parse(response).AssetFlows___dateFlowDate___ValueDisplayed</camunda:script></camunda:outputParameter></camunda:inputOutput><camunda:connectorId>http-connector</camunda:connectorId></camunda:connector></bpmn:extensionElements><bpmn:incoming>SequenceFlow_0tsmnqr</bpmn:incoming><bpmn:outgoing>Flow_1ar7cpn</bpmn:outgoing></bpmn:serviceTask><bpmn:sequenceFlow id="Flow_1ar7cpn" sourceRef="Activity_0e8pjgf" targetRef="Gateway_0plj0gr" /><bpmn:serviceTask id="Activity_0uxj2nu" name="Найти cчет, попадающий под условия"><bpmn:extensionElements><camunda:properties><camunda:property name="isEzdocServiceTask" value="true" /><camunda:property name="ezdocServiceTaskType" value="request" /><camunda:property name="requestType" value="GENERIC" /></camunda:properties><camunda:connector><camunda:inputOutput><camunda:inputParameter name="headers"><camunda:map><camunda:entry key="Accept">*/*</camunda:entry><camunda:entry key="Content-Type">application/json</camunda:entry></camunda:map></camunda:inputParameter><camunda:inputParameter name="url">${ezdocUrl}/api/camunda/common/executeRequest</camunda:inputParameter><camunda:inputParameter name="method">POST</camunda:inputParameter><camunda:inputParameter name="payload">{
    "find": "invoice",
    "filter": {
        "templatePrimaryId": "5d9af8742ab79c000a9a05c5",
		"attributes.hlk_account_type": "Денежный",   
        "attributes.hlk_account_currency": "${ccyCS}", 
   "attributes.hlk_account_owner.primaryId": "${clientPrimaryId}",
    "attributes.hlk_clearing_system.value": "${CS.replaceAll("\"", "\\\\\\\"")}",
		"activityStatus": "ACTIVE"
    },
    "projection": {
        "attributes.hlk_Account_Number": 1
"primaryId" : 1
    }
}</camunda:inputParameter><camunda:outputParameter name="hlk_Account_Number"><camunda:script scriptFormat="javascript">try{
JSON.parse(response).cursor.firstBatch[0].attributes.hlk_Account_Number;
} catch(e) {
"";
}</camunda:script></camunda:outputParameter><camunda:outputParameter name="hlk_Account_Number_primaryId"><camunda:script scriptFormat="javascript">JSON.parse(response).cursor.firstBatch[0].primaryId</camunda:script></camunda:outputParameter></camunda:inputOutput><camunda:connectorId>http-connector</camunda:connectorId></camunda:connector></bpmn:extensionElements><bpmn:incoming>Flow_0rsyheo</bpmn:incoming><bpmn:incoming>SequenceFlow_005npna</bpmn:incoming><bpmn:outgoing>Flow_0ts9i9r</bpmn:outgoing></bpmn:serviceTask><bpmn:sequenceFlow id="Flow_0ts9i9r" sourceRef="Activity_0uxj2nu" targetRef="Activity_1b2d7j0" /><bpmn:exclusiveGateway id="Gateway_0plj0gr" default="Flow_0rsyheo"><bpmn:incoming>Flow_1ar7cpn</bpmn:incoming><bpmn:outgoing>Flow_1khw88t</bpmn:outgoing><bpmn:outgoing>Flow_0rsyheo</bpmn:outgoing></bpmn:exclusiveGateway><bpmn:sequenceFlow id="Flow_1khw88t" sourceRef="Gateway_0plj0gr" targetRef="ServiceTask_0mqn5le"><bpmn:conditionExpression xsi:type="bpmn:tFormalExpression">${"RUR".equals(ccyCS)}</bpmn:conditionExpression></bpmn:sequenceFlow><bpmn:sequenceFlow id="Flow_0rsyheo" sourceRef="Gateway_0plj0gr" targetRef="Activity_0uxj2nu" /><bpmn:serviceTask id="ServiceTask_0mqn5le" name="Изменить валюту с RUR на RUB" camunda:expression="RUB" camunda:resultVariable="ccyCS"><bpmn:incoming>Flow_1khw88t</bpmn:incoming><bpmn:outgoing>SequenceFlow_005npna</bpmn:outgoing></bpmn:serviceTask><bpmn:sequenceFlow id="SequenceFlow_005npna" sourceRef="ServiceTask_0mqn5le" targetRef="Activity_0uxj2nu" /><bpmn:serviceTask id="Activity_1k0dsuo" name="создание обязательств"><bpmn:extensionElements><camunda:properties><camunda:property name="isEzdocServiceTask" value="true" /><camunda:property name="ezdocServiceTaskType" value="request" /><camunda:property name="requestType" value="GENERIC" /></camunda:properties><camunda:connector><camunda:inputOutput><camunda:inputParameter name="headers"><camunda:map><camunda:entry key="Accept">*/*</camunda:entry><camunda:entry key="Content-Type">application/json</camunda:entry></camunda:map></camunda:inputParameter><camunda:inputParameter name="method">POST</camunda:inputParameter><camunda:inputParameter name="url">${ezdocUrl}/api/camunda/instance/enrichment/sendInstanceTo/ENRICHMENT_OBLIGATION/${instanceId}?AssetFlows___radioFactPlan___ValueDisplayed=План</camunda:inputParameter><camunda:inputParameter name="payload">{
}</camunda:inputParameter></camunda:inputOutput><camunda:connectorId>http-connector</camunda:connectorId></camunda:connector></bpmn:extensionElements><bpmn:incoming>Flow_0a8viul</bpmn:incoming><bpmn:outgoing>SequenceFlow_1ebaopj</bpmn:outgoing></bpmn:serviceTask><bpmn:serviceTask id="Activity_1b2d7j0" name="Сохранить номер счета"><bpmn:extensionElements><camunda:properties><camunda:property name="isEzdocServiceTask" value="true" /><camunda:property name="ezdocServiceTaskType" value="request" /><camunda:property name="requestType" value="GENERIC" /></camunda:properties><camunda:connector><camunda:inputOutput><camunda:inputParameter name="headers"><camunda:map><camunda:entry key="Accept">*/*</camunda:entry><camunda:entry key="Content-Type">application/json</camunda:entry></camunda:map></camunda:inputParameter><camunda:inputParameter name="url">${ezdocUrl}/api/camunda/instance/enrichment/${instanceId}/setAttributes</camunda:inputParameter><camunda:inputParameter name="method">POST</camunda:inputParameter><camunda:inputParameter name="payload">{
"AssetFlows___lkupBOAccountNumber___ValueDisplayed" : {
"value" : "${hlk_Account_Number}",
"primaryId" : "${hlk_Account_Number_primaryId}",
"source" : "invoice",
"_class" : "egar.ezdoc.model.entity.attribute.DictionaryValue"
}
}</camunda:inputParameter></camunda:inputOutput><camunda:connectorId>http-connector</camunda:connectorId></camunda:connector></bpmn:extensionElements><bpmn:incoming>Flow_0ts9i9r</bpmn:incoming><bpmn:outgoing>Flow_0a8viul</bpmn:outgoing></bpmn:serviceTask><bpmn:sequenceFlow id="Flow_0a8viul" sourceRef="Activity_1b2d7j0" targetRef="Activity_1k0dsuo" /><bpmn:serviceTask id="ServiceTask_1lr659d" name="Поиск обязательства"><bpmn:extensionElements><camunda:properties><camunda:property name="isEzdocServiceTask" value="true" /><camunda:property name="ezdocServiceTaskType" value="request" /><camunda:property name="requestType" value="GENERIC" /></camunda:properties><camunda:connector><camunda:inputOutput><camunda:inputParameter name="headers"><camunda:map><camunda:entry key="Accept">*/*</camunda:entry><camunda:entry key="Content-Type">application/json</camunda:entry></camunda:map></camunda:inputParameter><camunda:inputParameter name="url">${ezdocUrl}/api/camunda/instance/enrichment/${instanceId}/obligations/one/by-attribute?name=AssetflowID&amp;value=40</camunda:inputParameter><camunda:inputParameter name="method">GET</camunda:inputParameter><camunda:outputParameter name="OutputCash">${response}</camunda:outputParameter></camunda:inputOutput><camunda:connectorId>http-connector</camunda:connectorId></camunda:connector></bpmn:extensionElements><bpmn:incoming>SequenceFlow_03rewy1</bpmn:incoming><bpmn:outgoing>SequenceFlow_0vfzzkc</bpmn:outgoing></bpmn:serviceTask><bpmn:sequenceFlow id="SequenceFlow_0vfzzkc" sourceRef="ServiceTask_1lr659d" targetRef="ServiceTask_1h8wfyo" /><bpmn:serviceTask id="ServiceTask_1h8wfyo" name="Создание фактов"><bpmn:extensionElements><camunda:properties><camunda:property name="isEzdocServiceTask" value="true" /><camunda:property name="ezdocServiceTaskType" value="request" /><camunda:property name="requestType" value="GENERIC" /></camunda:properties><camunda:connector><camunda:inputOutput><camunda:inputParameter name="headers"><camunda:map><camunda:entry key="Accept">*/*</camunda:entry><camunda:entry key="Content-Type">application/json</camunda:entry></camunda:map></camunda:inputParameter><camunda:inputParameter name="url">${ezdocUrl}/api/camunda/instance/enrichment-obligation/fact/${OutputCash}?AssetFlows___radioFactPlan___ValueDisplayed=Факт&amp;AssetFlows___dateFlowDate___ValueDisplayed=${Date_fact_payment}&amp;AssetFlows___txtQtyPcs___Value=${AssetFlows___txtQtyPcs___Value}</camunda:inputParameter><camunda:inputParameter name="method">POST</camunda:inputParameter></camunda:inputOutput><camunda:connectorId>http-connector</camunda:connectorId></camunda:connector></bpmn:extensionElements><bpmn:incoming>SequenceFlow_0vfzzkc</bpmn:incoming><bpmn:outgoing>SequenceFlow_09ur6qb</bpmn:outgoing></bpmn:serviceTask><bpmn:sequenceFlow id="SequenceFlow_09ur6qb" sourceRef="ServiceTask_1h8wfyo" targetRef="Activity_1cspi0z" /><bpmn:sequenceFlow id="SequenceFlow_186bmfk" sourceRef="ServiceTask_0zuy7vw" targetRef="ExclusiveGateway_1jqzlz5" /><bpmn:serviceTask id="ServiceTask_0jlvz4c" name="Статус Заполнение:Дата фактической выплаты"><bpmn:extensionElements><camunda:connector><camunda:inputOutput><camunda:inputParameter name="url">${ezdocUrl}/api/camunda/instance/enrichment/saveLabel/${instanceId}?label=Заполнение:+Дата+фактической+выплаты</camunda:inputParameter><camunda:inputParameter name="method">POST</camunda:inputParameter><camunda:inputParameter name="headers"><camunda:map><camunda:entry key="Accept">*/*</camunda:entry></camunda:map></camunda:inputParameter></camunda:inputOutput><camunda:connectorId>http-connector</camunda:connectorId></camunda:connector></bpmn:extensionElements></bpmn:serviceTask><bpmn:subProcess id="SubProcess_16lckol"><bpmn:incoming>SequenceFlow_1xuvaia</bpmn:incoming><bpmn:outgoing>SequenceFlow_0nlcfr2</bpmn:outgoing><bpmn:startEvent id="StartEvent_10lxvh5"><bpmn:outgoing>SequenceFlow_03igxtg</bpmn:outgoing></bpmn:startEvent><bpmn:userTask id="UserTask_0s9zcay" name="Заполнение поля Дата факта и Количество актива" camunda:formKey="FILL" camunda:candidateGroups="jira-users,cb_backoffice"><bpmn:extensionElements><camunda:properties><camunda:property name="isEzdocTask" value="true" /><camunda:property name="ezdocTaskType" value="fillverify" /></camunda:properties><camunda:taskListener event="create"><camunda:script scriptFormat="javascript">try {
              var formData = task.execution.processEngineServices.formService.getTaskFormData(task.id);
              var data = {};
              data.taskId = task.id;
              data.templateId = templateId;
              data.formKey = formData.formKey;
              var formFields = [];
              formData.formFields.forEach(function (a) {formFields.push(a.id)});
              data.formFields = formFields;

              httpPost(ezdocUrl + "/api/camunda/common/taskNotify?type=" + type + "&amp;instanceId=" + instanceId, JSON.stringify(data));
              }
              catch(error) {}

              /*************
              UTILITY FUNCTIONS
              *************/
              function httpPost(e,t,n){n=n||"application/json;charset=UTF-8";var a=new java.net.URL(e).openConnection();return a.requestMethod="POST",a.setRequestProperty("Content-Type",n),a.setRequestProperty("Accept-Charset", "UTF-8"),a.doOutput=!0,write(a.outputStream,t),asResponse(a)}function asResponse(e){return{data:read(e.inputStream),statusCode:e.responseCode}}function write(e,t){var n=new java.io.DataOutputStream(e);n.writeChars(t),n.flush(),n.close()}function read(e){for(var t,n=new java.io.BufferedReader(new java.io.InputStreamReader(e)),a=new java.lang.StringBuffer;null!=(t=n.readLine());)a.append(t);return n.close(),a.toString()}</camunda:script></camunda:taskListener><camunda:formData><camunda:formField id="Date_fact_payment" label="Corp. Дата фактической выплаты" type="string" /><camunda:formField id="AssetFlows___txtQtyPcs___Value" label="Corp. Количество актива" type="string" /></camunda:formData></bpmn:extensionElements><bpmn:incoming>Flow_0p1mha9</bpmn:incoming><bpmn:incoming>SequenceFlow_0cfnmb5</bpmn:incoming><bpmn:incoming>SequenceFlow_1uanxjp</bpmn:incoming><bpmn:incoming>SequenceFlow_0i1ly01</bpmn:incoming><bpmn:outgoing>SequenceFlow_1tyf09u</bpmn:outgoing></bpmn:userTask><bpmn:exclusiveGateway id="Gateway_0ltyurx" default="Flow_1wo9hq0"><bpmn:incoming>SequenceFlow_0pbsi3a</bpmn:incoming><bpmn:outgoing>Flow_187y73v</bpmn:outgoing><bpmn:outgoing>Flow_1wo9hq0</bpmn:outgoing></bpmn:exclusiveGateway><bpmn:serviceTask id="Activity_0tw6m2r" name="Статус заявки &#34;Дата факта не указана&#34;"><bpmn:extensionElements><camunda:connector><camunda:inputOutput><camunda:inputParameter name="url">${ezdocUrl}/api/camunda/instance/enrichment/saveLabel/${instanceId}?label=Дата+фактической+выплаты+не+указана</camunda:inputParameter><camunda:inputParameter name="method">POST</camunda:inputParameter><camunda:inputParameter name="headers"><camunda:map><camunda:entry key="Accept">*/*</camunda:entry></camunda:map></camunda:inputParameter></camunda:inputOutput><camunda:connectorId>http-connector</camunda:connectorId></camunda:connector></bpmn:extensionElements><bpmn:incoming>Flow_187y73v</bpmn:incoming><bpmn:outgoing>Flow_0p1mha9</bpmn:outgoing></bpmn:serviceTask><bpmn:serviceTask id="Activity_0n2k0x7" name="Статус заявки &#34;Дата факта &#62; TODAY&#34;"><bpmn:extensionElements><camunda:connector><camunda:inputOutput><camunda:inputParameter name="url">${ezdocUrl}/api/camunda/instance/enrichment/saveLabel/${instanceId}?label=Дата+фактической+выплаты+больше+текущей+даты</camunda:inputParameter><camunda:inputParameter name="method">POST</camunda:inputParameter><camunda:inputParameter name="headers"><camunda:map><camunda:entry key="Accept">*/*</camunda:entry></camunda:map></camunda:inputParameter></camunda:inputOutput><camunda:connectorId>http-connector</camunda:connectorId></camunda:connector></bpmn:extensionElements><bpmn:incoming>SequenceFlow_09ympdj</bpmn:incoming><bpmn:outgoing>SequenceFlow_0cfnmb5</bpmn:outgoing></bpmn:serviceTask><bpmn:serviceTask id="ServiceTask_1ps98me" name="Получаем modifyDate"><bpmn:extensionElements><camunda:connector><camunda:inputOutput><camunda:inputParameter name="url">${ezdocUrl}/api/camunda/common/executeRequest</camunda:inputParameter><camunda:inputParameter name="method">POST</camunda:inputParameter><camunda:inputParameter name="headers"><camunda:map><camunda:entry key="Accept">*/*</camunda:entry></camunda:map></camunda:inputParameter><camunda:inputParameter name="payload">{
	"find": "enrichment",
	"filter": {
	"_id" : ObjectId("${instanceId}")
	},
	"projection": {
		"modifyDate": 1
	}
}</camunda:inputParameter><camunda:outputParameter name="modifyDate"><camunda:script scriptFormat="javascript">JSON.parse(response).cursor.firstBatch[0].modifyDate</camunda:script></camunda:outputParameter></camunda:inputOutput><camunda:connectorId>http-connector</camunda:connectorId></camunda:connector></bpmn:extensionElements><bpmn:incoming>Flow_1wo9hq0</bpmn:incoming><bpmn:outgoing>SequenceFlow_1sdfegr</bpmn:outgoing></bpmn:serviceTask><bpmn:exclusiveGateway id="ExclusiveGateway_0s7jt7g" default="SequenceFlow_064k9t6"><bpmn:incoming>SequenceFlow_1sdfegr</bpmn:incoming><bpmn:outgoing>SequenceFlow_064k9t6</bpmn:outgoing><bpmn:outgoing>SequenceFlow_09ympdj</bpmn:outgoing><bpmn:outgoing>SequenceFlow_0spwh5u</bpmn:outgoing></bpmn:exclusiveGateway><bpmn:serviceTask id="ServiceTask_0hblwcs" name="Статус Подтверждение заявки" camunda:expression="${&#34;Подтверждение заявки&#34;}" camunda:resultVariable="labelStatus"><bpmn:incoming>SequenceFlow_064k9t6</bpmn:incoming><bpmn:outgoing>SequenceFlow_0azno9h</bpmn:outgoing></bpmn:serviceTask><bpmn:userTask id="Activity_0xg8132" name="Подтверждение заявки" camunda:assignee="${initiator}" camunda:candidateGroups="jira-users,cb_backoffice"><bpmn:extensionElements><camunda:properties><camunda:property name="isEzdocTask" value="true" /><camunda:property name="ezdocTaskType" value="buttons" /></camunda:properties><camunda:taskListener event="create"><camunda:script scriptFormat="javascript">try {
              var formData = task.execution.processEngineServices.formService.getTaskFormData(task.id);
              var data = {};
              data.taskId = task.id;
              data.templateId = templateId;
              data.formKey = formData.formKey;
              var formFields = [];
              formData.formFields.forEach(function (a) {formFields.push(a.id)});
              data.formFields = formFields;

              httpPost(ezdocUrl + "/api/camunda/common/taskNotify?type=" + type + "&amp;instanceId=" + instanceId, JSON.stringify(data));
              }
              catch(error) {}

              /*************
              UTILITY FUNCTIONS
              *************/
              function httpPost(e,t,n){n=n||"application/json;charset=UTF-8";var a=new java.net.URL(e).openConnection();return a.requestMethod="POST",a.setRequestProperty("Content-Type",n),a.setRequestProperty("Accept-Charset", "UTF-8"),a.doOutput=!0,write(a.outputStream,t),asResponse(a)}function asResponse(e){return{data:read(e.inputStream),statusCode:e.responseCode}}function write(e,t){var n=new java.io.DataOutputStream(e);n.writeChars(t),n.flush(),n.close()}function read(e){for(var t,n=new java.io.BufferedReader(new java.io.InputStreamReader(e)),a=new java.lang.StringBuffer;null!=(t=n.readLine());)a.append(t);return n.close(),a.toString()}</camunda:script></camunda:taskListener><camunda:formData><camunda:formField id="{&#34;id&#34;:&#34;Accept&#34;,&#34;label&#34;:&#34;Подтвердить&#34;,&#34;type&#34;:&#34;simple&#34;}" type="string" /></camunda:formData></bpmn:extensionElements><bpmn:incoming>SequenceFlow_0azno9h</bpmn:incoming><bpmn:outgoing>SequenceFlow_0izcyjx</bpmn:outgoing></bpmn:userTask><bpmn:sequenceFlow id="Flow_0p1mha9" sourceRef="Activity_0tw6m2r" targetRef="UserTask_0s9zcay" /><bpmn:sequenceFlow id="SequenceFlow_0cfnmb5" sourceRef="Activity_0n2k0x7" targetRef="UserTask_0s9zcay" /><bpmn:sequenceFlow id="SequenceFlow_1tyf09u" sourceRef="UserTask_0s9zcay" targetRef="ServiceTask_1wuoqjq" /><bpmn:sequenceFlow id="Flow_187y73v" sourceRef="Gateway_0ltyurx" targetRef="Activity_0tw6m2r"><bpmn:conditionExpression xsi:type="bpmn:tFormalExpression">${( Date_fact_payment ==null )||( Date_fact_payment   =="")}</bpmn:conditionExpression></bpmn:sequenceFlow><bpmn:sequenceFlow id="Flow_1wo9hq0" sourceRef="Gateway_0ltyurx" targetRef="ServiceTask_1ps98me" /><bpmn:sequenceFlow id="SequenceFlow_09ympdj" sourceRef="ExclusiveGateway_0s7jt7g" targetRef="Activity_0n2k0x7"><bpmn:conditionExpression xsi:type="bpmn:tFormalExpression">${(Date_fact_payment &gt; modifyDate)}</bpmn:conditionExpression></bpmn:sequenceFlow><bpmn:sequenceFlow id="SequenceFlow_1sdfegr" sourceRef="ServiceTask_1ps98me" targetRef="ExclusiveGateway_0s7jt7g" /><bpmn:sequenceFlow id="SequenceFlow_064k9t6" sourceRef="ExclusiveGateway_0s7jt7g" targetRef="ServiceTask_0hblwcs" /><bpmn:sequenceFlow id="SequenceFlow_0azno9h" sourceRef="ServiceTask_0hblwcs" targetRef="Activity_0xg8132" /><bpmn:sequenceFlow id="SequenceFlow_03igxtg" sourceRef="StartEvent_10lxvh5" targetRef="ExclusiveGateway_1ghfgqk" /><bpmn:sequenceFlow id="SequenceFlow_1uanxjp" sourceRef="ExclusiveGateway_1ghfgqk" targetRef="UserTask_0s9zcay" /><bpmn:parallelGateway id="ExclusiveGateway_1ghfgqk"><bpmn:incoming>SequenceFlow_03igxtg</bpmn:incoming><bpmn:outgoing>SequenceFlow_1uanxjp</bpmn:outgoing><bpmn:outgoing>SequenceFlow_1u1pneb</bpmn:outgoing></bpmn:parallelGateway><bpmn:sequenceFlow id="SequenceFlow_1u1pneb" sourceRef="ExclusiveGateway_1ghfgqk" targetRef="ServiceTask_192v0me" /><bpmn:receiveTask id="Task_1kwf0ya" messageRef="Message_0vmdoci"><bpmn:incoming>SequenceFlow_0a37jmr</bpmn:incoming><bpmn:outgoing>SequenceFlow_1t2znab</bpmn:outgoing></bpmn:receiveTask><bpmn:sequenceFlow id="SequenceFlow_0izcyjx" sourceRef="Activity_0xg8132" targetRef="EndEvent_1hf96hf" /><bpmn:endEvent id="EndEvent_1hf96hf"><bpmn:incoming>SequenceFlow_0izcyjx</bpmn:incoming><bpmn:terminateEventDefinition /></bpmn:endEvent><bpmn:endEvent id="EndEvent_017d4lj"><bpmn:incoming>SequenceFlow_00whpon</bpmn:incoming><bpmn:terminateEventDefinition /></bpmn:endEvent><bpmn:serviceTask id="ServiceTask_06f6ojp" name="Сохранение  даты факта"><bpmn:extensionElements><camunda:properties><camunda:property name="isEzdocServiceTask" value="true" /><camunda:property name="ezdocServiceTaskType" value="request" /><camunda:property name="requestType" value="GENERIC" /></camunda:properties><camunda:connector><camunda:inputOutput><camunda:inputParameter name="headers"><camunda:map><camunda:entry key="Accept">*/*</camunda:entry><camunda:entry key="Content-Type">application/json</camunda:entry></camunda:map></camunda:inputParameter><camunda:inputParameter name="url">${ezdocUrl}/api/camunda/instance/enrichment/${instanceId}/setAttributes</camunda:inputParameter><camunda:inputParameter name="method">POST</camunda:inputParameter><camunda:inputParameter name="payload">{"Date_fact_payment": "${Date_fact_payment}"}</camunda:inputParameter></camunda:inputOutput><camunda:connectorId>http-connector</camunda:connectorId></camunda:connector></bpmn:extensionElements><bpmn:incoming>SequenceFlow_1t2znab</bpmn:incoming><bpmn:outgoing>SequenceFlow_09gmhwz</bpmn:outgoing></bpmn:serviceTask><bpmn:sequenceFlow id="SequenceFlow_09gmhwz" sourceRef="ServiceTask_06f6ojp" targetRef="ServiceTask_0h73wiu" /><bpmn:sequenceFlow id="SequenceFlow_1t2znab" sourceRef="Task_1kwf0ya" targetRef="ServiceTask_06f6ojp" /><bpmn:serviceTask id="ServiceTask_0c5wet8" name="Получить данные с форма: дата плана, инструмент, тип"><bpmn:extensionElements><camunda:properties><camunda:property name="isEzdocServiceTask" value="true" /><camunda:property name="ezdocServiceTaskType" value="request" /><camunda:property name="requestType" value="GENERIC" /></camunda:properties><camunda:connector><camunda:inputOutput><camunda:inputParameter name="headers"><camunda:map><camunda:entry key="Accept">*/*</camunda:entry><camunda:entry key="Content-Type">application/json</camunda:entry></camunda:map></camunda:inputParameter><camunda:inputParameter name="method">GET</camunda:inputParameter><camunda:inputParameter name="url">${ezdocUrl}/api/camunda/instance/enrichment/${instanceId}/getAttributes?systemName=AssetFlows___dateFlowDate___ValueDisplayed&amp;systemName=AssetFlows___lkupFlowType___ValueDisplayed&amp;systemName=AssetFlows___lkupCorpEventAsset___ValueDisplayed&amp;systemName=AssetFlows___txtQtyPcs___Value</camunda:inputParameter><camunda:outputParameter name="AssetFlows___dateFlowDate___ValueDisplayed"><camunda:script scriptFormat="javascript">JSON.parse(response).AssetFlows___dateFlowDate___ValueDisplayed.substring(0, 10)</camunda:script></camunda:outputParameter><camunda:outputParameter name="AssetFlows___lkupFlowType___ValueDisplayed">${S(response).prop('AssetFlows___lkupFlowType___ValueDisplayed').stringValue()}</camunda:outputParameter><camunda:outputParameter name="AssetFlows___lkupCorpEventAsset___ValueDisplayed">${S(response).prop('AssetFlows___lkupCorpEventAsset___ValueDisplayed').stringValue()}</camunda:outputParameter><camunda:outputParameter name="AssetFlows___txtQtyPcs___Value"><camunda:script scriptFormat="javascript">JSON.parse(response).AssetFlows___txtQtyPcs___Value</camunda:script></camunda:outputParameter></camunda:inputOutput><camunda:connectorId>http-connector</camunda:connectorId></camunda:connector></bpmn:extensionElements><bpmn:incoming>SequenceFlow_021n1cl</bpmn:incoming><bpmn:outgoing>SequenceFlow_0a37jmr</bpmn:outgoing></bpmn:serviceTask><bpmn:sequenceFlow id="SequenceFlow_0a37jmr" sourceRef="ServiceTask_0c5wet8" targetRef="Task_1kwf0ya" /><bpmn:serviceTask id="ServiceTask_192v0me" name="Статус Подтверждение заявки" camunda:expression="${&#34;Подтверждение заявки&#34;}" camunda:resultVariable="labelStatus"><bpmn:incoming>SequenceFlow_1u1pneb</bpmn:incoming><bpmn:outgoing>SequenceFlow_021n1cl</bpmn:outgoing></bpmn:serviceTask><bpmn:sequenceFlow id="SequenceFlow_021n1cl" sourceRef="ServiceTask_192v0me" targetRef="ServiceTask_0c5wet8" /><bpmn:serviceTask id="ServiceTask_1wuoqjq" name="Получение поля Дата факта и Количества"><bpmn:extensionElements><camunda:properties><camunda:property name="isEzdocServiceTask" value="true" /><camunda:property name="ezdocServiceTaskType" value="request" /><camunda:property name="requestType" value="GENERIC" /></camunda:properties><camunda:connector><camunda:inputOutput><camunda:inputParameter name="headers"><camunda:map><camunda:entry key="Accept">*/*</camunda:entry><camunda:entry key="Content-Type">application/json</camunda:entry></camunda:map></camunda:inputParameter><camunda:inputParameter name="url">${ezdocUrl}/api/camunda/common/executeRequest</camunda:inputParameter><camunda:inputParameter name="method">POST</camunda:inputParameter><camunda:inputParameter name="payload">{
	"find": "enrichment",
	"filter": {
	"_id" : ObjectId("${instanceId}")
	},
	"projection": {
		"attributes.Date_fact_payment": 1
"attributes.AssetFlows___txtQtyPcs___Value": 1
"attributes.hlk_plan_qty": 1
	}
}</camunda:inputParameter><camunda:outputParameter name="Date_fact_payment"><camunda:script scriptFormat="javascript">JSON.parse(response).cursor.firstBatch[0].attributes.Date_fact_payment</camunda:script></camunda:outputParameter><camunda:outputParameter name="AssetFlows___txtQtyPcs___Value"><camunda:script scriptFormat="javascript">JSON.parse(response).cursor.firstBatch[0].attributes.AssetFlows___txtQtyPcs___Value</camunda:script></camunda:outputParameter><camunda:outputParameter name="hlk_plan_qty"><camunda:script scriptFormat="javascript">JSON.parse(response).cursor.firstBatch[0].attributes.hlk_plan_qty</camunda:script></camunda:outputParameter></camunda:inputOutput><camunda:connectorId>http-connector</camunda:connectorId></camunda:connector></bpmn:extensionElements><bpmn:incoming>SequenceFlow_1tyf09u</bpmn:incoming><bpmn:outgoing>SequenceFlow_0pbsi3a</bpmn:outgoing></bpmn:serviceTask><bpmn:sequenceFlow id="SequenceFlow_0pbsi3a" sourceRef="ServiceTask_1wuoqjq" targetRef="Gateway_0ltyurx" /><bpmn:serviceTask id="ServiceTask_16dpjoi" name="Статус заявки &#34;Сумма фактического исполнения не может быть больше плановой&#34;"><bpmn:extensionElements><camunda:connector><camunda:inputOutput><camunda:inputParameter name="url">${ezdocUrl}/api/camunda/instance/enrichment/saveLabel/${instanceId}?label=Сумма+фактического+исполнения+не+может+быть+больше+плановой</camunda:inputParameter><camunda:inputParameter name="method">POST</camunda:inputParameter><camunda:inputParameter name="headers"><camunda:map><camunda:entry key="Accept">*/*</camunda:entry></camunda:map></camunda:inputParameter></camunda:inputOutput><camunda:connectorId>http-connector</camunda:connectorId></camunda:connector></bpmn:extensionElements><bpmn:incoming>SequenceFlow_0spwh5u</bpmn:incoming><bpmn:outgoing>SequenceFlow_0i1ly01</bpmn:outgoing></bpmn:serviceTask><bpmn:sequenceFlow id="SequenceFlow_0spwh5u" sourceRef="ExclusiveGateway_0s7jt7g" targetRef="ServiceTask_16dpjoi"><bpmn:conditionExpression xsi:type="bpmn:tFormalExpression">${(AssetFlows___txtQtyPcs___Value &gt; hlk_plan_qty)}</bpmn:conditionExpression></bpmn:sequenceFlow><bpmn:sequenceFlow id="SequenceFlow_0i1ly01" sourceRef="ServiceTask_16dpjoi" targetRef="UserTask_0s9zcay" /><bpmn:serviceTask id="ServiceTask_0h73wiu" name="Получение поля Дата факта"><bpmn:extensionElements><camunda:properties><camunda:property name="isEzdocServiceTask" value="true" /><camunda:property name="ezdocServiceTaskType" value="request" /><camunda:property name="requestType" value="GENERIC" /></camunda:properties><camunda:connector><camunda:inputOutput><camunda:inputParameter name="headers"><camunda:map><camunda:entry key="Accept">*/*</camunda:entry><camunda:entry key="Content-Type">application/json</camunda:entry></camunda:map></camunda:inputParameter><camunda:inputParameter name="url">${ezdocUrl}/api/camunda/common/executeRequest</camunda:inputParameter><camunda:inputParameter name="method">POST</camunda:inputParameter><camunda:inputParameter name="payload">{
	"find": "enrichment",
	"filter": {
	"_id" : ObjectId("${instanceId}")
	},
	"projection": {
		"attributes.Date_fact_payment": 1
	}
}</camunda:inputParameter><camunda:outputParameter name="Date_fact_payment"><camunda:script scriptFormat="javascript">JSON.parse(response).cursor.firstBatch[0].attributes.Date_fact_payment</camunda:script></camunda:outputParameter></camunda:inputOutput><camunda:connectorId>http-connector</camunda:connectorId></camunda:connector></bpmn:extensionElements><bpmn:incoming>SequenceFlow_09gmhwz</bpmn:incoming><bpmn:outgoing>SequenceFlow_00whpon</bpmn:outgoing></bpmn:serviceTask><bpmn:sequenceFlow id="SequenceFlow_00whpon" sourceRef="ServiceTask_0h73wiu" targetRef="EndEvent_017d4lj" /></bpmn:subProcess><bpmn:sequenceFlow id="SequenceFlow_0nlcfr2" sourceRef="SubProcess_16lckol" targetRef="ServiceTask_051yabk" /><bpmn:serviceTask id="ServiceTask_011gh1y" name="Получение количества"><bpmn:extensionElements><camunda:properties><camunda:property name="isEzdocServiceTask" value="true" /><camunda:property name="ezdocServiceTaskType" value="request" /><camunda:property name="requestType" value="GENERIC" /></camunda:properties><camunda:connector><camunda:inputOutput><camunda:inputParameter name="headers"><camunda:map><camunda:entry key="Accept">*/*</camunda:entry><camunda:entry key="Content-Type">application/json</camunda:entry></camunda:map></camunda:inputParameter><camunda:inputParameter name="url">${ezdocUrl}/api/camunda/instance/enrichment/${instanceId}/getAttribute/AssetFlows___txtQtyPcs___Value</camunda:inputParameter><camunda:inputParameter name="method">GET</camunda:inputParameter><camunda:outputParameter name="qty">${response}</camunda:outputParameter></camunda:inputOutput><camunda:connectorId>http-connector</camunda:connectorId></camunda:connector></bpmn:extensionElements><bpmn:incoming>SequenceFlow_1ebaopj</bpmn:incoming><bpmn:outgoing>SequenceFlow_09swwgl</bpmn:outgoing></bpmn:serviceTask><bpmn:sequenceFlow id="SequenceFlow_09swwgl" sourceRef="ServiceTask_011gh1y" targetRef="ServiceTask_16pudpq" /><bpmn:serviceTask id="ServiceTask_16pudpq" name="Сохранить количество в тех параметры"><bpmn:extensionElements><camunda:properties><camunda:property name="isEzdocServiceTask" value="true" /><camunda:property name="ezdocServiceTaskType" value="request" /><camunda:property name="requestType" value="GENERIC" /></camunda:properties><camunda:connector><camunda:inputOutput><camunda:inputParameter name="headers"><camunda:map><camunda:entry key="Accept">*/*</camunda:entry><camunda:entry key="Content-Type">application/json</camunda:entry></camunda:map></camunda:inputParameter><camunda:inputParameter name="url">${ezdocUrl}/api/camunda/instance/enrichment/${instanceId}/setAttributes</camunda:inputParameter><camunda:inputParameter name="method">POST</camunda:inputParameter><camunda:inputParameter name="payload">{"hlk_plan_qty": "${qty}"}</camunda:inputParameter></camunda:inputOutput><camunda:connectorId>http-connector</camunda:connectorId></camunda:connector></bpmn:extensionElements><bpmn:incoming>SequenceFlow_09swwgl</bpmn:incoming><bpmn:outgoing>SequenceFlow_1xuvaia</bpmn:outgoing></bpmn:serviceTask><bpmn:sequenceFlow id="SequenceFlow_1xuvaia" sourceRef="ServiceTask_16pudpq" targetRef="SubProcess_16lckol" /><bpmn:sequenceFlow id="SequenceFlow_1ebaopj" sourceRef="Activity_1k0dsuo" targetRef="ServiceTask_011gh1y" /><bpmn:userTask id="Activity_1cspi0z"><bpmn:incoming>SequenceFlow_09ur6qb</bpmn:incoming><bpmn:outgoing>Flow_04wrr6j</bpmn:outgoing></bpmn:userTask><bpmn:sequenceFlow id="Flow_04wrr6j" sourceRef="Activity_1cspi0z" targetRef="ServiceTask_11wvth6" /><bpmn:exclusiveGateway id="ExclusiveGateway_1jqzlz5" default="SequenceFlow_0mhtggn"><bpmn:incoming>SequenceFlow_186bmfk</bpmn:incoming><bpmn:outgoing>SequenceFlow_0mhtggn</bpmn:outgoing><bpmn:outgoing>SequenceFlow_0lpy6d4</bpmn:outgoing></bpmn:exclusiveGateway><bpmn:sequenceFlow id="SequenceFlow_0mhtggn" sourceRef="ExclusiveGateway_1jqzlz5" targetRef="ServiceTask_1we1gd3" /><bpmn:sequenceFlow id="SequenceFlow_0lpy6d4" sourceRef="ExclusiveGateway_1jqzlz5" targetRef="ServiceTask_1wtxo6n"><bpmn:conditionExpression xsi:type="bpmn:tFormalExpression">${clientSource == 'legalEntity'}</bpmn:conditionExpression></bpmn:sequenceFlow><bpmn:sequenceFlow id="SequenceFlow_1ljpcx7" sourceRef="ExclusiveGateway_1iyrj52" targetRef="ServiceTask_1l91n7b" /><bpmn:exclusiveGateway id="ExclusiveGateway_1iyrj52"><bpmn:incoming>SequenceFlow_0vqbwth</bpmn:incoming><bpmn:incoming>SequenceFlow_1kh3pe6</bpmn:incoming><bpmn:outgoing>SequenceFlow_1ljpcx7</bpmn:outgoing></bpmn:exclusiveGateway><bpmn:sequenceFlow id="SequenceFlow_0vqbwth" sourceRef="ServiceTask_1wtxo6n" targetRef="ExclusiveGateway_1iyrj52" /><bpmn:sequenceFlow id="SequenceFlow_1kh3pe6" sourceRef="ServiceTask_1we1gd3" targetRef="ExclusiveGateway_1iyrj52" /><bpmn:serviceTask id="ServiceTask_1we1gd3" name="ФЗ. Получаем почту клиента"><bpmn:extensionElements><camunda:connector><camunda:inputOutput><camunda:inputParameter name="payload">{
  "aggregate": "individualPerson",
  "pipeline": [
    {
      "$match": {
        "actual": true,
        "status": "VERIFICATED",
        "primaryId": "${clientPrimaryId}",
      }
    },
    {
      "$project": {
        "hlk_email": { "$ifNull": ["$attributes.hlk_email", null]},
        "_id": 0
      }
    }
  ],
  "cursor": {
    "batchSize": 10000
  },
  "allowDiskUse": true
}</camunda:inputParameter><camunda:inputParameter name="url">${ezdocUrl}/api/camunda/common/executeRequest</camunda:inputParameter><camunda:inputParameter name="method">POST</camunda:inputParameter><camunda:inputParameter name="headers"><camunda:map><camunda:entry key="Accept">*/*</camunda:entry><camunda:entry key="Content-Type">application/json</camunda:entry></camunda:map></camunda:inputParameter><camunda:outputParameter name="Email"><camunda:script scriptFormat="javascript">JSON.parse(response).cursor.firstBatch[0].hlk_email</camunda:script></camunda:outputParameter></camunda:inputOutput><camunda:connectorId>http-connector</camunda:connectorId></camunda:connector></bpmn:extensionElements><bpmn:incoming>SequenceFlow_0mhtggn</bpmn:incoming><bpmn:outgoing>SequenceFlow_1kh3pe6</bpmn:outgoing></bpmn:serviceTask><bpmn:serviceTask id="ServiceTask_1wtxo6n" name="ЮЛ. Получаем почту клиента"><bpmn:extensionElements><camunda:connector><camunda:inputOutput><camunda:inputParameter name="payload">{
  "aggregate": "legalEntity",
  "pipeline": [
    {
      "$match": {
        "actual": true,
        "status": "VERIFICATED",
        "primaryId": "${clientPrimaryId}",
      }
    },
    {
      "$project": {
        "hlk_email": { "$ifNull": ["$attributes.hlk_email", null]},
        "_id": 0
      }
    }
  ],
  "cursor": {
    "batchSize": 10000
  },
  "allowDiskUse": true
}</camunda:inputParameter><camunda:inputParameter name="url">${ezdocUrl}/api/camunda/common/executeRequest</camunda:inputParameter><camunda:inputParameter name="method">POST</camunda:inputParameter><camunda:inputParameter name="headers"><camunda:map><camunda:entry key="Accept">*/*</camunda:entry><camunda:entry key="Content-Type">application/json</camunda:entry></camunda:map></camunda:inputParameter><camunda:outputParameter name="Email"><camunda:script scriptFormat="javascript">JSON.parse(response).cursor.firstBatch[0].hlk_email</camunda:script></camunda:outputParameter></camunda:inputOutput><camunda:connectorId>http-connector</camunda:connectorId></camunda:connector></bpmn:extensionElements><bpmn:incoming>SequenceFlow_0lpy6d4</bpmn:incoming><bpmn:outgoing>SequenceFlow_0vqbwth</bpmn:outgoing></bpmn:serviceTask><bpmn:serviceTask id="ServiceTask_1l91n7b" name="Отправляем отчёт клиенту"><bpmn:extensionElements><camunda:connector><camunda:inputOutput><camunda:inputParameter name="method">POST</camunda:inputParameter><camunda:inputParameter name="headers"><camunda:map><camunda:entry key="Accept">*/*</camunda:entry><camunda:entry key="Content-Type">application/json</camunda:entry></camunda:map></camunda:inputParameter><camunda:inputParameter name="url">${ezdocUrl}/api/camunda/instance/email/send</camunda:inputParameter><camunda:inputParameter name="payload">{
"email":"${Email}",
"subject":"Отчёт о зачислении суммы вознаграждения/погашения по финансовым инструментам",
"text":"",
"attachments": ["${generated}"]
}</camunda:inputParameter><camunda:outputParameter name="errorMessage">${response}</camunda:outputParameter></camunda:inputOutput><camunda:connectorId>http-connector</camunda:connectorId></camunda:connector></bpmn:extensionElements><bpmn:incoming>SequenceFlow_1ljpcx7</bpmn:incoming><bpmn:outgoing>SequenceFlow_1ipv7pi</bpmn:outgoing></bpmn:serviceTask><bpmn:sequenceFlow id="SequenceFlow_1ipv7pi" sourceRef="ServiceTask_1l91n7b" targetRef="EndEvent_0djl7a3" /></bpmn:process><bpmn:message id="Message_0vmdoci" name="confirmPayment" /><bpmndi:BPMNDiagram id="BPMNDiagram_1"><bpmndi:BPMNPlane id="BPMNPlane_1" bpmnElement="TEMPLATE_INSTANCE_PROCESS_CouponPaymentInstrument_f1bd35f7-25aa-45fc-9625-e8d67acf4d2b"><bpmndi:BPMNEdge id="SequenceFlow_1ipv7pi_di" bpmnElement="SequenceFlow_1ipv7pi"><di:waypoint x="5150" y="398" /><di:waypoint x="5182" y="398" /></bpmndi:BPMNEdge><bpmndi:BPMNEdge id="SequenceFlow_1kh3pe6_di" bpmnElement="SequenceFlow_1kh3pe6"><di:waypoint x="4970" y="340" /><di:waypoint x="5000" y="340" /><di:waypoint x="5000" y="373" /></bpmndi:BPMNEdge><bpmndi:BPMNEdge id="SequenceFlow_0vqbwth_di" bpmnElement="SequenceFlow_0vqbwth"><di:waypoint x="4970" y="450" /><di:waypoint x="5000" y="450" /><di:waypoint x="5000" y="423" /></bpmndi:BPMNEdge><bpmndi:BPMNEdge id="SequenceFlow_1ljpcx7_di" bpmnElement="SequenceFlow_1ljpcx7"><di:waypoint x="5025" y="398" /><di:waypoint x="5050" y="398" /></bpmndi:BPMNEdge><bpmndi:BPMNEdge id="SequenceFlow_0lpy6d4_di" bpmnElement="SequenceFlow_0lpy6d4"><di:waypoint x="4840" y="423" /><di:waypoint x="4840" y="450" /><di:waypoint x="4870" y="450" /></bpmndi:BPMNEdge><bpmndi:BPMNEdge id="SequenceFlow_0mhtggn_di" bpmnElement="SequenceFlow_0mhtggn"><di:waypoint x="4840" y="373" /><di:waypoint x="4840" y="340" /><di:waypoint x="4870" y="340" /></bpmndi:BPMNEdge><bpmndi:BPMNEdge id="Flow_04wrr6j_di" bpmnElement="Flow_04wrr6j"><di:waypoint x="4420" y="398" /><di:waypoint x="4450" y="398" /></bpmndi:BPMNEdge><bpmndi:BPMNEdge id="SequenceFlow_1ebaopj_di" bpmnElement="SequenceFlow_1ebaopj"><di:waypoint x="1250" y="398" /><di:waypoint x="1290" y="398" /></bpmndi:BPMNEdge><bpmndi:BPMNEdge id="SequenceFlow_1xuvaia_di" bpmnElement="SequenceFlow_1xuvaia"><di:waypoint x="1510" y="398" /><di:waypoint x="1598" y="398" /></bpmndi:BPMNEdge><bpmndi:BPMNEdge id="SequenceFlow_09swwgl_di" bpmnElement="SequenceFlow_09swwgl"><di:waypoint x="1390" y="398" /><di:waypoint x="1410" y="398" /></bpmndi:BPMNEdge><bpmndi:BPMNEdge id="SequenceFlow_0nlcfr2_di" bpmnElement="SequenceFlow_0nlcfr2"><di:waypoint x="3312" y="398" /><di:waypoint x="3370" y="398" /></bpmndi:BPMNEdge><bpmndi:BPMNEdge id="SequenceFlow_186bmfk_di" bpmnElement="SequenceFlow_186bmfk"><di:waypoint x="4790" y="398" /><di:waypoint x="4815" y="398" /></bpmndi:BPMNEdge><bpmndi:BPMNEdge id="SequenceFlow_09ur6qb_di" bpmnElement="SequenceFlow_09ur6qb"><di:waypoint x="4296" y="398" /><di:waypoint x="4320" y="398" /></bpmndi:BPMNEdge><bpmndi:BPMNEdge id="SequenceFlow_0vfzzkc_di" bpmnElement="SequenceFlow_0vfzzkc"><di:waypoint x="4151" y="398" /><di:waypoint x="4196" y="398" /></bpmndi:BPMNEdge><bpmndi:BPMNEdge id="Flow_0a8viul_di" bpmnElement="Flow_0a8viul"><di:waypoint x="1130" y="398" /><di:waypoint x="1150" y="398" /></bpmndi:BPMNEdge><bpmndi:BPMNEdge id="SequenceFlow_005npna_di" bpmnElement="SequenceFlow_005npna"><di:waypoint x="890" y="398" /><di:waypoint x="910" y="398" /></bpmndi:BPMNEdge><bpmndi:BPMNEdge id="Flow_0rsyheo_di" bpmnElement="Flow_0rsyheo"><di:waypoint x="740" y="423" /><di:waypoint x="740" y="500" /><di:waypoint x="960" y="500" /><di:waypoint x="960" y="438" /></bpmndi:BPMNEdge><bpmndi:BPMNEdge id="Flow_1khw88t_di" bpmnElement="Flow_1khw88t"><di:waypoint x="765" y="398" /><di:waypoint x="790" y="398" /></bpmndi:BPMNEdge><bpmndi:BPMNEdge id="Flow_0ts9i9r_di" bpmnElement="Flow_0ts9i9r"><di:waypoint x="1010" y="398" /><di:waypoint x="1030" y="398" /></bpmndi:BPMNEdge><bpmndi:BPMNEdge id="Flow_1ar7cpn_di" bpmnElement="Flow_1ar7cpn"><di:waypoint x="690" y="398" /><di:waypoint x="715" y="398" /></bpmndi:BPMNEdge><bpmndi:BPMNEdge id="Flow_09lu4yt_di" bpmnElement="Flow_09lu4yt"><di:waypoint x="320" y="398" /><di:waypoint x="350" y="398" /></bpmndi:BPMNEdge><bpmndi:BPMNEdge id="SequenceFlow_0yf6y97_di" bpmnElement="SequenceFlow_0yf6y97"><di:waypoint x="3890" y="398" /><di:waypoint x="3918" y="398" /></bpmndi:BPMNEdge><bpmndi:BPMNEdge id="SequenceFlow_1z0g30k_di" bpmnElement="SequenceFlow_1z0g30k"><di:waypoint x="3800" y="500" /><di:waypoint x="3840" y="500" /><di:waypoint x="3840" y="438" /></bpmndi:BPMNEdge><bpmndi:BPMNEdge id="SequenceFlow_0tnturo_di" bpmnElement="SequenceFlow_0tnturo"><di:waypoint x="3660" y="500" /><di:waypoint x="3700" y="500" /></bpmndi:BPMNEdge><bpmndi:BPMNEdge id="SequenceFlow_1oz3cfp_di" bpmnElement="SequenceFlow_1oz3cfp"><di:waypoint x="3470" y="398" /><di:waypoint x="3505" y="398" /></bpmndi:BPMNEdge><bpmndi:BPMNEdge id="SequenceFlow_0faby30_di" bpmnElement="SequenceFlow_0faby30"><di:waypoint x="3530" y="423" /><di:waypoint x="3530" y="507" /><di:waypoint x="3560" y="507" /></bpmndi:BPMNEdge><bpmndi:BPMNEdge id="SequenceFlow_1mefry5_di" bpmnElement="SequenceFlow_1mefry5"><di:waypoint x="3555" y="398" /><di:waypoint x="3790" y="398" /></bpmndi:BPMNEdge><bpmndi:BPMNEdge id="SequenceFlow_0zhzfvs_di" bpmnElement="SequenceFlow_0zhzfvs"><di:waypoint x="4670" y="398" /><di:waypoint x="4690" y="398" /></bpmndi:BPMNEdge><bpmndi:BPMNEdge id="SequenceFlow_0o6jqpa_di" bpmnElement="SequenceFlow_0o6jqpa"><di:waypoint x="4550" y="398" /><di:waypoint x="4570" y="398" /></bpmndi:BPMNEdge><bpmndi:BPMNEdge id="SequenceFlow_0tsmnqr_di" bpmnElement="SequenceFlow_0tsmnqr"><di:waypoint x="570" y="398" /><di:waypoint x="590" y="398" /></bpmndi:BPMNEdge><bpmndi:BPMNEdge id="SequenceFlow_0pvahkb_di" bpmnElement="SequenceFlow_0pvahkb"><di:waypoint x="450" y="398" /><di:waypoint x="470" y="398" /></bpmndi:BPMNEdge><bpmndi:BPMNEdge id="SequenceFlow_03rewy1_di" bpmnElement="SequenceFlow_03rewy1"><di:waypoint x="4018" y="398" /><di:waypoint x="4051" y="398" /></bpmndi:BPMNEdge><bpmndi:BPMNEdge id="SequenceFlow_0or7jn6_di" bpmnElement="SequenceFlow_0or7jn6"><di:waypoint x="188" y="398" /><di:waypoint x="220" y="398" /><bpmndi:BPMNLabel><dc:Bounds x="193" y="99" width="90" height="12" /></bpmndi:BPMNLabel></bpmndi:BPMNEdge><bpmndi:BPMNShape id="_BPMNShape_StartEvent_2" bpmnElement="StartEvent_1"><dc:Bounds x="152" y="380" width="36" height="36" /><bpmndi:BPMNLabel><dc:Bounds x="147" y="138" width="90" height="20" /></bpmndi:BPMNLabel></bpmndi:BPMNShape><bpmndi:BPMNShape id="EndEvent_0djl7a3_di" bpmnElement="EndEvent_0djl7a3"><dc:Bounds x="5182" y="380" width="36" height="36" /><bpmndi:BPMNLabel><dc:Bounds x="1078" y="142" width="90" height="12" /></bpmndi:BPMNLabel></bpmndi:BPMNShape><bpmndi:BPMNShape id="ServiceTask_1bg1mhj_di" bpmnElement="ServiceTask_1bg1mhj"><dc:Bounds x="3918" y="358" width="100" height="80" /></bpmndi:BPMNShape><bpmndi:BPMNShape id="ServiceTask_1n1fr9v_di" bpmnElement="ServiceTask_1n1fr9v"><dc:Bounds x="350" y="358" width="100" height="80" /></bpmndi:BPMNShape><bpmndi:BPMNShape id="ServiceTask_020uorz_di" bpmnElement="ServiceTask_020uorz"><dc:Bounds x="470" y="358" width="100" height="80" /></bpmndi:BPMNShape><bpmndi:BPMNShape id="ServiceTask_11wvth6_di" bpmnElement="ServiceTask_11wvth6"><dc:Bounds x="4450" y="358" width="100" height="80" /></bpmndi:BPMNShape><bpmndi:BPMNShape id="ServiceTask_093rfnw_di" bpmnElement="ServiceTask_093rfnw"><dc:Bounds x="4570" y="358" width="100" height="80" /></bpmndi:BPMNShape><bpmndi:BPMNShape id="ServiceTask_0zuy7vw_di" bpmnElement="ServiceTask_0zuy7vw"><dc:Bounds x="4690" y="358" width="100" height="80" /></bpmndi:BPMNShape><bpmndi:BPMNShape id="ExclusiveGateway_1lqg8yo_di" bpmnElement="Gateway_18zfpzg" isMarkerVisible="true"><dc:Bounds x="3505" y="373" width="50" height="50" /></bpmndi:BPMNShape><bpmndi:BPMNShape id="ServiceTask_0e1uuwi_di" bpmnElement="ServiceTask_0e1uuwi"><dc:Bounds x="3560" y="467" width="100" height="80" /></bpmndi:BPMNShape><bpmndi:BPMNShape id="ServiceTask_051yabk_di" bpmnElement="ServiceTask_051yabk"><dc:Bounds x="3370" y="358" width="100" height="80" /></bpmndi:BPMNShape><bpmndi:BPMNShape id="ServiceTask_139zij8_di" bpmnElement="ServiceTask_139zij8"><dc:Bounds x="3700" y="460" width="100" height="80" /></bpmndi:BPMNShape><bpmndi:BPMNShape id="ServiceTask_1itkaaz_di" bpmnElement="ServiceTask_1itkaaz"><dc:Bounds x="3790" y="358" width="100" height="80" /></bpmndi:BPMNShape><bpmndi:BPMNShape id="Activity_055zv9q_di" bpmnElement="Activity_055zv9q"><dc:Bounds x="220" y="358" width="100" height="80" /></bpmndi:BPMNShape><bpmndi:BPMNShape id="Activity_0oyrqvm_di" bpmnElement="Activity_0oyrqvm"><dc:Bounds x="470" y="240" width="100" height="80" /></bpmndi:BPMNShape><bpmndi:BPMNShape id="Activity_0e8pjgf_di" bpmnElement="Activity_0e8pjgf"><dc:Bounds x="590" y="358" width="100" height="80" /></bpmndi:BPMNShape><bpmndi:BPMNShape id="Activity_0uxj2nu_di" bpmnElement="Activity_0uxj2nu"><dc:Bounds x="910" y="358" width="100" height="80" /></bpmndi:BPMNShape><bpmndi:BPMNShape id="Gateway_0plj0gr_di" bpmnElement="Gateway_0plj0gr" isMarkerVisible="true"><dc:Bounds x="715" y="373" width="50" height="50" /></bpmndi:BPMNShape><bpmndi:BPMNShape id="ServiceTask_0mqn5le_di" bpmnElement="ServiceTask_0mqn5le"><dc:Bounds x="790" y="358" width="100" height="80" /></bpmndi:BPMNShape><bpmndi:BPMNShape id="Activity_1k0dsuo_di" bpmnElement="Activity_1k0dsuo"><dc:Bounds x="1150" y="358" width="100" height="80" /></bpmndi:BPMNShape><bpmndi:BPMNShape id="Activity_1b2d7j0_di" bpmnElement="Activity_1b2d7j0"><dc:Bounds x="1030" y="358" width="100" height="80" /></bpmndi:BPMNShape><bpmndi:BPMNShape id="ServiceTask_1lr659d_di" bpmnElement="ServiceTask_1lr659d"><dc:Bounds x="4051" y="358" width="100" height="80" /></bpmndi:BPMNShape><bpmndi:BPMNShape id="ServiceTask_1h8wfyo_di" bpmnElement="ServiceTask_1h8wfyo"><dc:Bounds x="4196" y="358" width="100" height="80" /></bpmndi:BPMNShape><bpmndi:BPMNShape id="ServiceTask_0jlvz4c_di" bpmnElement="ServiceTask_0jlvz4c"><dc:Bounds x="1490" y="140" width="100" height="80" /></bpmndi:BPMNShape><bpmndi:BPMNShape id="SubProcess_16lckol_di" bpmnElement="SubProcess_16lckol" isExpanded="true"><dc:Bounds x="1598" y="79" width="1714" height="637" /></bpmndi:BPMNShape><bpmndi:BPMNEdge id="SequenceFlow_00whpon_di" bpmnElement="SequenceFlow_00whpon"><di:waypoint x="2730" y="550" /><di:waypoint x="2753" y="550" /><di:waypoint x="2753" y="550" /><di:waypoint x="3086" y="549" /></bpmndi:BPMNEdge><bpmndi:BPMNEdge id="SequenceFlow_0i1ly01_di" bpmnElement="SequenceFlow_0i1ly01"><di:waypoint x="2366" y="470" /><di:waypoint x="1900" y="470" /><di:waypoint x="1900" y="339" /></bpmndi:BPMNEdge><bpmndi:BPMNEdge id="SequenceFlow_0spwh5u_di" bpmnElement="SequenceFlow_0spwh5u"><di:waypoint x="2540" y="324" /><di:waypoint x="2540" y="489" /><di:waypoint x="2466" y="489" /></bpmndi:BPMNEdge><bpmndi:BPMNEdge id="SequenceFlow_0pbsi3a_di" bpmnElement="SequenceFlow_0pbsi3a"><di:waypoint x="2210" y="299" /><di:waypoint x="2245" y="299" /></bpmndi:BPMNEdge><bpmndi:BPMNEdge id="SequenceFlow_021n1cl_di" bpmnElement="SequenceFlow_021n1cl"><di:waypoint x="1890" y="550" /><di:waypoint x="1920" y="550" /></bpmndi:BPMNEdge><bpmndi:BPMNEdge id="SequenceFlow_0a37jmr_di" bpmnElement="SequenceFlow_0a37jmr"><di:waypoint x="2020" y="550" /><di:waypoint x="2180" y="550" /></bpmndi:BPMNEdge><bpmndi:BPMNEdge id="SequenceFlow_1t2znab_di" bpmnElement="SequenceFlow_1t2znab"><di:waypoint x="2280" y="550" /><di:waypoint x="2320" y="550" /></bpmndi:BPMNEdge><bpmndi:BPMNEdge id="SequenceFlow_09gmhwz_di" bpmnElement="SequenceFlow_09gmhwz"><di:waypoint x="2420" y="550" /><di:waypoint x="2630" y="550" /></bpmndi:BPMNEdge><bpmndi:BPMNEdge id="SequenceFlow_0izcyjx_di" bpmnElement="SequenceFlow_0izcyjx"><di:waypoint x="2986" y="299" /><di:waypoint x="3086" y="299" /></bpmndi:BPMNEdge><bpmndi:BPMNEdge id="SequenceFlow_1u1pneb_di" bpmnElement="SequenceFlow_1u1pneb"><di:waypoint x="1771" y="402" /><di:waypoint x="1771" y="550" /><di:waypoint x="1790" y="550" /></bpmndi:BPMNEdge><bpmndi:BPMNEdge id="SequenceFlow_1uanxjp_di" bpmnElement="SequenceFlow_1uanxjp"><di:waypoint x="1771" y="352" /><di:waypoint x="1771" y="299" /><di:waypoint x="1883" y="299" /></bpmndi:BPMNEdge><bpmndi:BPMNEdge id="SequenceFlow_03igxtg_di" bpmnElement="SequenceFlow_03igxtg"><di:waypoint x="1696" y="377" /><di:waypoint x="1746" y="377" /></bpmndi:BPMNEdge><bpmndi:BPMNEdge id="SequenceFlow_0azno9h_di" bpmnElement="SequenceFlow_0azno9h"><di:waypoint x="2760" y="299" /><di:waypoint x="2886" y="299" /></bpmndi:BPMNEdge><bpmndi:BPMNEdge id="SequenceFlow_064k9t6_di" bpmnElement="SequenceFlow_064k9t6"><di:waypoint x="2565" y="299" /><di:waypoint x="2660" y="299" /></bpmndi:BPMNEdge><bpmndi:BPMNEdge id="SequenceFlow_1sdfegr_di" bpmnElement="SequenceFlow_1sdfegr"><di:waypoint x="2460" y="299" /><di:waypoint x="2515" y="299" /></bpmndi:BPMNEdge><bpmndi:BPMNEdge id="SequenceFlow_09ympdj_di" bpmnElement="SequenceFlow_09ympdj"><di:waypoint x="2540" y="274" /><di:waypoint x="2540" y="187" /><di:waypoint x="2356" y="187" /></bpmndi:BPMNEdge><bpmndi:BPMNEdge id="Flow_1wo9hq0_di" bpmnElement="Flow_1wo9hq0"><di:waypoint x="2295" y="299" /><di:waypoint x="2360" y="299" /></bpmndi:BPMNEdge><bpmndi:BPMNEdge id="Flow_187y73v_di" bpmnElement="Flow_187y73v"><di:waypoint x="2270" y="324" /><di:waypoint x="2270" y="421" /><di:waypoint x="2126" y="421" /></bpmndi:BPMNEdge><bpmndi:BPMNEdge id="SequenceFlow_1tyf09u_di" bpmnElement="SequenceFlow_1tyf09u"><di:waypoint x="1983" y="299" /><di:waypoint x="2110" y="299" /></bpmndi:BPMNEdge><bpmndi:BPMNEdge id="SequenceFlow_0cfnmb5_di" bpmnElement="SequenceFlow_0cfnmb5"><di:waypoint x="2256" y="187" /><di:waypoint x="1933" y="187" /><di:waypoint x="1933" y="259" /></bpmndi:BPMNEdge><bpmndi:BPMNEdge id="Flow_0p1mha9_di" bpmnElement="Flow_0p1mha9"><di:waypoint x="2026" y="421" /><di:waypoint x="1933" y="421" /><di:waypoint x="1933" y="339" /></bpmndi:BPMNEdge><bpmndi:BPMNShape id="StartEvent_10lxvh5_di" bpmnElement="StartEvent_10lxvh5"><dc:Bounds x="1660" y="359" width="36" height="36" /></bpmndi:BPMNShape><bpmndi:BPMNShape id="UserTask_0s9zcay_di" bpmnElement="UserTask_0s9zcay"><dc:Bounds x="1883" y="259" width="100" height="80" /></bpmndi:BPMNShape><bpmndi:BPMNShape id="Gateway_0ltyurx_di" bpmnElement="Gateway_0ltyurx" isMarkerVisible="true"><dc:Bounds x="2245" y="274" width="50" height="50" /></bpmndi:BPMNShape><bpmndi:BPMNShape id="Activity_0tw6m2r_di" bpmnElement="Activity_0tw6m2r"><dc:Bounds x="2026" y="381" width="100" height="80" /></bpmndi:BPMNShape><bpmndi:BPMNShape id="Activity_0n2k0x7_di" bpmnElement="Activity_0n2k0x7"><dc:Bounds x="2256" y="147" width="100" height="80" /></bpmndi:BPMNShape><bpmndi:BPMNShape id="ServiceTask_1ps98me_di" bpmnElement="ServiceTask_1ps98me"><dc:Bounds x="2360" y="259" width="100" height="80" /></bpmndi:BPMNShape><bpmndi:BPMNShape id="ExclusiveGateway_0s7jt7g_di" bpmnElement="ExclusiveGateway_0s7jt7g" isMarkerVisible="true"><dc:Bounds x="2515" y="274" width="50" height="50" /></bpmndi:BPMNShape><bpmndi:BPMNShape id="ServiceTask_0hblwcs_di" bpmnElement="ServiceTask_0hblwcs"><dc:Bounds x="2660" y="259" width="100" height="80" /></bpmndi:BPMNShape><bpmndi:BPMNShape id="Activity_0xg8132_di" bpmnElement="Activity_0xg8132" bioc:stroke="rgb(67, 160, 71)" bioc:fill="rgb(200, 230, 201)"><dc:Bounds x="2886" y="259" width="100" height="80" /></bpmndi:BPMNShape><bpmndi:BPMNShape id="ParallelGateway_07gg1mn_di" bpmnElement="ExclusiveGateway_1ghfgqk"><dc:Bounds x="1746" y="352" width="50" height="50" /></bpmndi:BPMNShape><bpmndi:BPMNShape id="ReceiveTask_1a5vsiw_di" bpmnElement="Task_1kwf0ya"><dc:Bounds x="2180" y="510" width="100" height="80" /></bpmndi:BPMNShape><bpmndi:BPMNShape id="EndEvent_0qh5pqh_di" bpmnElement="EndEvent_1hf96hf"><dc:Bounds x="3086" y="281" width="36" height="36" /></bpmndi:BPMNShape><bpmndi:BPMNShape id="EndEvent_19rrx5u_di" bpmnElement="EndEvent_017d4lj"><dc:Bounds x="3086" y="531" width="36" height="36" /></bpmndi:BPMNShape><bpmndi:BPMNShape id="ServiceTask_06f6ojp_di" bpmnElement="ServiceTask_06f6ojp"><dc:Bounds x="2320" y="510" width="100" height="80" /></bpmndi:BPMNShape><bpmndi:BPMNShape id="ServiceTask_0c5wet8_di" bpmnElement="ServiceTask_0c5wet8"><dc:Bounds x="1920" y="510" width="100" height="80" /></bpmndi:BPMNShape><bpmndi:BPMNShape id="ServiceTask_192v0me_di" bpmnElement="ServiceTask_192v0me"><dc:Bounds x="1790" y="510" width="100" height="80" /></bpmndi:BPMNShape><bpmndi:BPMNShape id="ServiceTask_1wuoqjq_di" bpmnElement="ServiceTask_1wuoqjq"><dc:Bounds x="2110" y="259" width="100" height="80" /></bpmndi:BPMNShape><bpmndi:BPMNShape id="ServiceTask_16dpjoi_di" bpmnElement="ServiceTask_16dpjoi"><dc:Bounds x="2366" y="430" width="100" height="80" /></bpmndi:BPMNShape><bpmndi:BPMNShape id="ServiceTask_0h73wiu_di" bpmnElement="ServiceTask_0h73wiu"><dc:Bounds x="2630" y="510" width="100" height="80" /></bpmndi:BPMNShape><bpmndi:BPMNShape id="ServiceTask_011gh1y_di" bpmnElement="ServiceTask_011gh1y"><dc:Bounds x="1290" y="358" width="100" height="80" /></bpmndi:BPMNShape><bpmndi:BPMNShape id="ServiceTask_16pudpq_di" bpmnElement="ServiceTask_16pudpq"><dc:Bounds x="1410" y="358" width="100" height="80" /></bpmndi:BPMNShape><bpmndi:BPMNShape id="Activity_1cspi0z_di" bpmnElement="Activity_1cspi0z"><dc:Bounds x="4320" y="358" width="100" height="80" /></bpmndi:BPMNShape><bpmndi:BPMNShape id="ExclusiveGateway_1jqzlz5_di" bpmnElement="ExclusiveGateway_1jqzlz5" isMarkerVisible="true"><dc:Bounds x="4815" y="373" width="50" height="50" /></bpmndi:BPMNShape><bpmndi:BPMNShape id="ExclusiveGateway_1iyrj52_di" bpmnElement="ExclusiveGateway_1iyrj52" isMarkerVisible="true"><dc:Bounds x="4975" y="373" width="50" height="50" /></bpmndi:BPMNShape><bpmndi:BPMNShape id="ServiceTask_1we1gd3_di" bpmnElement="ServiceTask_1we1gd3"><dc:Bounds x="4870" y="300" width="100" height="80" /></bpmndi:BPMNShape><bpmndi:BPMNShape id="ServiceTask_1wtxo6n_di" bpmnElement="ServiceTask_1wtxo6n"><dc:Bounds x="4870" y="410" width="100" height="80" /></bpmndi:BPMNShape><bpmndi:BPMNShape id="ServiceTask_1l91n7b_di" bpmnElement="ServiceTask_1l91n7b"><dc:Bounds x="5050" y="358" width="100" height="80" /></bpmndi:BPMNShape></bpmndi:BPMNPlane></bpmndi:BPMNDiagram></bpmn:definitions>