<?xml version="1.0" encoding="UTF-8"?>
<bpmn:definitions xmlns:bpmn="http://www.omg.org/spec/BPMN/20100524/MODEL" xmlns:bpmndi="http://www.omg.org/spec/BPMN/20100524/DI" xmlns:camunda="http://camunda.org/schema/1.0/bpmn" xmlns:dc="http://www.omg.org/spec/DD/20100524/DC" xmlns:di="http://www.omg.org/spec/DD/20100524/DI" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:bioc="http://bpmn.io/schema/bpmn/biocolor/1.0" id="Definitions_1" targetNamespace="http://bpmn.io/schema/bpmn" exporter="Camunda Modeler" exporterVersion="4.2.0"><bpmn:process id="TEMPLATE_INSTANCE_PROCESS_enablingAccount_08b1d1c5-2983-4ace-9e84-e62d23e1956b" name="Подключение услуги" isExecutable="true"><bpmn:documentation /><bpmn:startEvent id="StartEvent_1"><bpmn:outgoing>Flow_1fuhu56</bpmn:outgoing></bpmn:startEvent><bpmn:serviceTask id="Activity_0sqnh1c" name="Получаем значение параметров"><bpmn:extensionElements><camunda:properties><camunda:property name="isEzdocServiceTask" value="true" /><camunda:property name="ezdocServiceTaskType" value="request" /><camunda:property name="requestType" value="GENERIC" /></camunda:properties><camunda:connector><camunda:inputOutput><camunda:inputParameter name="headers"><camunda:map><camunda:entry key="Accept">*/*</camunda:entry><camunda:entry key="Content-Type">application/json</camunda:entry></camunda:map></camunda:inputParameter><camunda:inputParameter name="url">${ezdocUrl}/api/camunda/instance/book/${instanceId}/getAttributes?systemName=cifID&amp;systemName=brokerageAccountID</camunda:inputParameter><camunda:inputParameter name="method">GET</camunda:inputParameter><camunda:outputParameter name="CIF"><camunda:script scriptFormat="javascript">JSON.parse(response).cifID</camunda:script></camunda:outputParameter><camunda:outputParameter name="brokerageAccountID"><camunda:script scriptFormat="javascript">JSON.parse(response).brokerageAccountID</camunda:script></camunda:outputParameter></camunda:inputOutput><camunda:connectorId>http-connector</camunda:connectorId></camunda:connector></bpmn:extensionElements><bpmn:incoming>Flow_11q0rn1</bpmn:incoming><bpmn:outgoing>Flow_0t4255l</bpmn:outgoing></bpmn:serviceTask><bpmn:serviceTask id="Activity_08jdouv" name="Ищем клиентский портфель"><bpmn:extensionElements><camunda:properties><camunda:property name="isEzdocServiceTask" value="true" /><camunda:property name="ezdocServiceTaskType" value="request" /><camunda:property name="requestType" value="GENERIC" /></camunda:properties><camunda:connector><camunda:inputOutput><camunda:inputParameter name="headers"><camunda:map><camunda:entry key="Accept">*/*</camunda:entry><camunda:entry key="Content-Type">application/json</camunda:entry></camunda:map></camunda:inputParameter><camunda:inputParameter name="url">${ezdocUrl}/api/camunda/common/executeRequest</camunda:inputParameter><camunda:inputParameter name="method">POST</camunda:inputParameter><camunda:inputParameter name="payload">{ 	"find": "book", 	
"filter": 
{
"activityStatus": "ACTIVE", 
"templatePrimaryId": "6167d4df7ef9df0776685460", 
"attributes.brokerageAccountID": "${brokerageAccountID}",
"attributes.cifID": "${CIF}"
},
"projection": { 		"_id": 1 	}
}</camunda:inputParameter><camunda:outputParameter name="Portfolio_refid"><camunda:script scriptFormat="javascript">try {
JSON.parse(response).cursor.firstBatch[0]._id
}
catch (e)
{
"0"
}</camunda:script></camunda:outputParameter><camunda:outputParameter name="isEmptyPortf"><camunda:script scriptFormat="javascript">S(response)
.prop("cursor")
.prop("firstBatch").elements().isEmpty()</camunda:script></camunda:outputParameter></camunda:inputOutput><camunda:connectorId>http-connector</camunda:connectorId></camunda:connector></bpmn:extensionElements><bpmn:incoming>Flow_1s43g4n</bpmn:incoming><bpmn:outgoing>Flow_1yf8jcb</bpmn:outgoing></bpmn:serviceTask><bpmn:exclusiveGateway id="Gateway_1irgztq" default="Flow_13jr3ef"><bpmn:incoming>Flow_1yf8jcb</bpmn:incoming><bpmn:outgoing>Flow_13jr3ef</bpmn:outgoing><bpmn:outgoing>Flow_06sa7q7</bpmn:outgoing></bpmn:exclusiveGateway><bpmn:sequenceFlow id="Flow_1yf8jcb" sourceRef="Activity_08jdouv" targetRef="Gateway_1irgztq" /><bpmn:serviceTask id="Activity_1wfpugf" name="Получаем  параметры клиентского портфеля"><bpmn:extensionElements><camunda:properties><camunda:property name="isEzdocServiceTask" value="true" /><camunda:property name="ezdocServiceTaskType" value="request" /><camunda:property name="requestType" value="GENERIC" /></camunda:properties><camunda:connector><camunda:inputOutput><camunda:inputParameter name="headers"><camunda:map><camunda:entry key="Accept">*/*</camunda:entry><camunda:entry key="Content-Type">application/json</camunda:entry></camunda:map></camunda:inputParameter><camunda:inputParameter name="method">GET</camunda:inputParameter><camunda:inputParameter name="url">${ezdocUrl}/api/camunda/instance/book/${Portfolio_refid}/getAttributes?systemName=GuideSteps&amp;systemName=clientCode</camunda:inputParameter><camunda:outputParameter name="clientCode"><camunda:script scriptFormat="javascript">JSON.parse(response).clientCode</camunda:script></camunda:outputParameter><camunda:outputParameter name="GuideSteps"><camunda:script scriptFormat="javascript">try{
S(response).prop("GuideSteps")
} catch(e) {
throw new org.camunda.bpm.engine.delegate.BpmnError("IT_EXCEPTION",e);
}</camunda:script></camunda:outputParameter><camunda:outputParameter name="TestLength"><camunda:script scriptFormat="javascript">try{
S(response).prop("GuideSteps").elements().size()
} catch(e) {
0
}</camunda:script></camunda:outputParameter></camunda:inputOutput><camunda:connectorId>http-connector</camunda:connectorId></camunda:connector></bpmn:extensionElements><bpmn:incoming>Flow_13jr3ef</bpmn:incoming><bpmn:incoming>Flow_1xwkqvn</bpmn:incoming><bpmn:outgoing>Flow_1bfstw1</bpmn:outgoing></bpmn:serviceTask><bpmn:sequenceFlow id="Flow_13jr3ef" sourceRef="Gateway_1irgztq" targetRef="Activity_1wfpugf" /><bpmn:sequenceFlow id="Flow_1fuhu56" sourceRef="StartEvent_1" targetRef="Activity_1xdcgfq" /><bpmn:sequenceFlow id="Flow_1bfstw1" sourceRef="Activity_1wfpugf" targetRef="Gateway_03dq40m" /><bpmn:scriptTask id="Activity_15tjqx0" name="Меняем в табличном блоке строку по заданному номеру" scriptFormat="javascript" camunda:resultVariable="GSA_modified"><bpmn:incoming>Flow_1bz70bg</bpmn:incoming><bpmn:incoming>Flow_0b7o2rd</bpmn:incoming><bpmn:outgoing>Flow_1trtmgk</bpmn:outgoing><bpmn:script>var GuideSteps_modified = JSON.parse(GuideSteps);

GuideSteps_modified[1]['NumStep'] = 2;
GuideSteps_modified[1]['NameProcessBar'] = StepName2;
GuideSteps_modified[1]['StatusStep'] = true;
GuideSteps_modified[1]['AnketaId'] = instanceId;
GuideSteps_modified[1]['ResultDateTime'] = ResultDateTime;

result = new Object();
result.GuideSteps = GuideSteps_modified;
JSON.stringify(result);</bpmn:script></bpmn:scriptTask><bpmn:scriptTask id="Activity_0rxw1ho" name="json" scriptFormat="JavaScript" camunda:resultVariable="GuideSteps12"><bpmn:incoming>Flow_1trtmgk</bpmn:incoming><bpmn:outgoing>Flow_03w6pmh</bpmn:outgoing><bpmn:script>S(GSA_modified).prop("GuideSteps")</bpmn:script></bpmn:scriptTask><bpmn:serviceTask id="Activity_1839i3u" name="Ищем этап 2 в списке этапов"><bpmn:extensionElements><camunda:properties><camunda:property name="isEzdocServiceTask" value="true" /><camunda:property name="ezdocServiceTaskType" value="request" /><camunda:property name="requestType" value="GENERIC" /></camunda:properties><camunda:connector><camunda:inputOutput><camunda:inputParameter name="headers"><camunda:map><camunda:entry key="Accept">*/*</camunda:entry><camunda:entry key="Content-Type">application/json</camunda:entry></camunda:map></camunda:inputParameter><camunda:inputParameter name="url">${ezdocUrl}/api/camunda/common/executeRequest</camunda:inputParameter><camunda:inputParameter name="method">POST</camunda:inputParameter><camunda:inputParameter name="payload">{ 	"find": "book", 	
"filter": 
{
"activityStatus": "ACTIVE", 
"templatePrimaryId": "61cd56f319807c2315dfed7d", 
"attributes.NumStep" : 2
},
"projection": { 		"attributes.NameProcessBar": 1	}
}</camunda:inputParameter><camunda:outputParameter name="StepName2"><camunda:script scriptFormat="javascript">try {
var result_json = 
JSON.parse(response).cursor.firstBatch[0].attributes.NameProcessBar;
JSON.stringify(result_json).replaceAll("\"", "")
}
catch (e)
{
" "
}</camunda:script></camunda:outputParameter><camunda:outputParameter name="isEmpty1"><camunda:script scriptFormat="javascript">S(response)
.prop("cursor")
.prop("firstBatch").elements().isEmpty()</camunda:script></camunda:outputParameter></camunda:inputOutput><camunda:connectorId>http-connector</camunda:connectorId></camunda:connector></bpmn:extensionElements><bpmn:incoming>Flow_04meod7</bpmn:incoming><bpmn:outgoing>Flow_0aqrffm</bpmn:outgoing></bpmn:serviceTask><bpmn:exclusiveGateway id="Gateway_18sbfc0" default="Flow_1bz70bg"><bpmn:incoming>Flow_0aqrffm</bpmn:incoming><bpmn:outgoing>Flow_1bz70bg</bpmn:outgoing><bpmn:outgoing>Flow_0bj1465</bpmn:outgoing></bpmn:exclusiveGateway><bpmn:scriptTask id="Activity_0p5mh2m" name="Название этапа" scriptFormat="JavaScript" camunda:resultVariable="StepName2"><bpmn:incoming>Flow_0bj1465</bpmn:incoming><bpmn:outgoing>Flow_0b7o2rd</bpmn:outgoing><bpmn:script>String('')</bpmn:script></bpmn:scriptTask><bpmn:serviceTask id="Activity_1qzjugx" name="Обновляем портфель"><bpmn:extensionElements><camunda:connector><camunda:inputOutput><camunda:inputParameter name="url">${ezdocUrl}/api/integration/queue/BOOK</camunda:inputParameter><camunda:inputParameter name="method">POST</camunda:inputParameter><camunda:inputParameter name="headers"><camunda:map><camunda:entry key="Accept">*/*</camunda:entry><camunda:entry key="Content-Type">application/json</camunda:entry></camunda:map></camunda:inputParameter><camunda:inputParameter name="payload">{
	"attributes": {
        "TemplateType": "BrokeragePortfolio",
        "brokerageAccountID": "${brokerageAccountID}",
        "enablingAccountOrderId": "${instanceId}",
        "enablingAccountDateTime": "${ResultDateTime}",
        "isEnablingAccount": true,
        "num_contract": "${num_contract}",
        "date_contract": "${date_contract}",
        "disablingAccountOrderId": null,
        "disablingAccountDateTime": null,
        "GuideSteps": ${GuideSteps12}
}
}</camunda:inputParameter></camunda:inputOutput><camunda:connectorId>http-connector</camunda:connectorId></camunda:connector></bpmn:extensionElements><bpmn:incoming>Flow_17b7rep</bpmn:incoming><bpmn:outgoing>Flow_17r224g</bpmn:outgoing></bpmn:serviceTask><bpmn:sequenceFlow id="Flow_1bz70bg" sourceRef="Gateway_18sbfc0" targetRef="Activity_15tjqx0" /><bpmn:sequenceFlow id="Flow_0b7o2rd" sourceRef="Activity_0p5mh2m" targetRef="Activity_15tjqx0" /><bpmn:sequenceFlow id="Flow_1trtmgk" sourceRef="Activity_15tjqx0" targetRef="Activity_0rxw1ho" /><bpmn:sequenceFlow id="Flow_0aqrffm" sourceRef="Activity_1839i3u" targetRef="Gateway_18sbfc0" /><bpmn:sequenceFlow id="Flow_0bj1465" sourceRef="Gateway_18sbfc0" targetRef="Activity_0p5mh2m"><bpmn:conditionExpression xsi:type="bpmn:tFormalExpression">${isEmpty1 == true}</bpmn:conditionExpression></bpmn:sequenceFlow><bpmn:scriptTask id="Activity_1cjrfpn" name="Получаем текущую дату и время" scriptFormat="JavaScript" camunda:resultVariable="ResultDateTime"><bpmn:incoming>Flow_0swut6m</bpmn:incoming><bpmn:outgoing>Flow_00zlj53</bpmn:outgoing><bpmn:script>JSON.stringify(new Date()).replace(/"/g, '').substring(0, 19).replace('T', ' ')</bpmn:script></bpmn:scriptTask><bpmn:sequenceFlow id="Flow_00zlj53" sourceRef="Activity_1cjrfpn" targetRef="Activity_16kibf9" /><bpmn:sequenceFlow id="Flow_03w6pmh" sourceRef="Activity_0rxw1ho" targetRef="Activity_0z96jix" /><bpmn:serviceTask id="Activity_0eir13n" name="Сообщаем об окончании процесса" camunda:asyncAfter="true"><bpmn:extensionElements><camunda:connector><camunda:inputOutput><camunda:inputParameter name="url">${ezdocUrl}/api/camunda/instance/book/processCompleted/${instanceId}</camunda:inputParameter><camunda:inputParameter name="method">POST</camunda:inputParameter><camunda:inputParameter name="headers"><camunda:map><camunda:entry key="Accept">*/*</camunda:entry></camunda:map></camunda:inputParameter></camunda:inputOutput><camunda:connectorId>http-connector</camunda:connectorId></camunda:connector></bpmn:extensionElements><bpmn:incoming>Flow_1qji0wp</bpmn:incoming><bpmn:outgoing>Flow_10zjoi8</bpmn:outgoing></bpmn:serviceTask><bpmn:sequenceFlow id="Flow_17r224g" sourceRef="Activity_1qzjugx" targetRef="Activity_04e1yma" /><bpmn:endEvent id="Event_0rtuz4z"><bpmn:incoming>Flow_10zjoi8</bpmn:incoming></bpmn:endEvent><bpmn:sequenceFlow id="Flow_10zjoi8" sourceRef="Activity_0eir13n" targetRef="Event_0rtuz4z" /><bpmn:exclusiveGateway id="Gateway_010ppfy" default="Flow_0swut6m"><bpmn:incoming>Flow_0hedayr</bpmn:incoming><bpmn:outgoing>Flow_0swut6m</bpmn:outgoing><bpmn:outgoing>Flow_02wig0e</bpmn:outgoing></bpmn:exclusiveGateway><bpmn:sequenceFlow id="Flow_0swut6m" sourceRef="Gateway_010ppfy" targetRef="Activity_1cjrfpn" /><bpmn:serviceTask id="Activity_16kibf9" name="Устанавливаем значение параметров"><bpmn:extensionElements><camunda:properties><camunda:property name="isEzdocServiceTask" value="true" /><camunda:property name="ezdocServiceTaskType" value="request" /><camunda:property name="requestType" value="GENERIC" /></camunda:properties><camunda:connector><camunda:inputOutput><camunda:inputParameter name="headers"><camunda:map><camunda:entry key="Accept">*/*</camunda:entry><camunda:entry key="Content-Type">application/json</camunda:entry></camunda:map></camunda:inputParameter><camunda:inputParameter name="url">${ezdocUrl}/api/camunda/instance/book/${instanceId}/setAttributes</camunda:inputParameter><camunda:inputParameter name="method">POST</camunda:inputParameter><camunda:inputParameter name="payload"><camunda:script scriptFormat="javascript">S("{}")
.prop("ResultDateTime", ResultDateTime)
.prop("Message", " ")
.prop("clientCode", clientCode)
.toString()</camunda:script></camunda:inputParameter></camunda:inputOutput><camunda:connectorId>http-connector</camunda:connectorId></camunda:connector></bpmn:extensionElements><bpmn:incoming>Flow_00zlj53</bpmn:incoming><bpmn:outgoing>Flow_04meod7</bpmn:outgoing></bpmn:serviceTask><bpmn:sequenceFlow id="Flow_04meod7" sourceRef="Activity_16kibf9" targetRef="Activity_1839i3u" /><bpmn:serviceTask id="Activity_08factb" name="Статус: Не найден клиентский портфель"><bpmn:extensionElements><camunda:connector><camunda:inputOutput><camunda:inputParameter name="url">${ezdocUrl}/api/camunda/instance/book/saveLabel/${instanceId}?label=Не+найден+клиентский+портфель</camunda:inputParameter><camunda:inputParameter name="method">POST</camunda:inputParameter><camunda:inputParameter name="headers"><camunda:map><camunda:entry key="Accept">*/*</camunda:entry></camunda:map></camunda:inputParameter></camunda:inputOutput><camunda:connectorId>http-connector</camunda:connectorId></camunda:connector></bpmn:extensionElements><bpmn:incoming>Flow_1a2g4c7</bpmn:incoming><bpmn:outgoing>Flow_12b9dh0</bpmn:outgoing></bpmn:serviceTask><bpmn:endEvent id="Event_0v40lyu"><bpmn:incoming>Flow_0szg7pi</bpmn:incoming></bpmn:endEvent><bpmn:sequenceFlow id="Flow_06sa7q7" name="Не найден портфель" sourceRef="Gateway_1irgztq" targetRef="Activity_131qv8p"><bpmn:conditionExpression xsi:type="bpmn:tFormalExpression">${isEmptyPortf == true}</bpmn:conditionExpression></bpmn:sequenceFlow><bpmn:serviceTask id="Activity_1mjr46s" name="Устанавливаем значение параметров"><bpmn:extensionElements><camunda:properties><camunda:property name="isEzdocServiceTask" value="true" /><camunda:property name="ezdocServiceTaskType" value="request" /><camunda:property name="requestType" value="GENERIC" /></camunda:properties><camunda:connector><camunda:inputOutput><camunda:inputParameter name="headers"><camunda:map><camunda:entry key="Accept">*/*</camunda:entry><camunda:entry key="Content-Type">application/json</camunda:entry></camunda:map></camunda:inputParameter><camunda:inputParameter name="url">${ezdocUrl}/api/camunda/instance/book/${instanceId}/setAttributes</camunda:inputParameter><camunda:inputParameter name="method">POST</camunda:inputParameter><camunda:inputParameter name="payload"><camunda:script scriptFormat="javascript">S("{}")
.prop("Message", "Не найден клиентский портфель")
.toString()</camunda:script></camunda:inputParameter></camunda:inputOutput><camunda:connectorId>http-connector</camunda:connectorId></camunda:connector></bpmn:extensionElements><bpmn:incoming>Flow_0ndx1bh</bpmn:incoming><bpmn:incoming>Flow_17gh0x8</bpmn:incoming><bpmn:outgoing>Flow_1a2g4c7</bpmn:outgoing></bpmn:serviceTask><bpmn:sequenceFlow id="Flow_1a2g4c7" sourceRef="Activity_1mjr46s" targetRef="Activity_08factb" /><bpmn:serviceTask id="Activity_0fyvm6x" name="Сообщаем об окончании процесса" camunda:asyncAfter="true"><bpmn:extensionElements><camunda:connector><camunda:inputOutput><camunda:inputParameter name="url">${ezdocUrl}/api/camunda/instance/book/processCompleted/${instanceId}</camunda:inputParameter><camunda:inputParameter name="method">POST</camunda:inputParameter><camunda:inputParameter name="headers"><camunda:map><camunda:entry key="Accept">*/*</camunda:entry></camunda:map></camunda:inputParameter></camunda:inputOutput><camunda:connectorId>http-connector</camunda:connectorId></camunda:connector></bpmn:extensionElements><bpmn:incoming>Flow_18klgis</bpmn:incoming><bpmn:outgoing>Flow_0szg7pi</bpmn:outgoing></bpmn:serviceTask><bpmn:sequenceFlow id="Flow_0szg7pi" sourceRef="Activity_0fyvm6x" targetRef="Event_0v40lyu" /><bpmn:serviceTask id="Activity_0v831cg" name="Статус: Услуга ранее была подключена"><bpmn:extensionElements><camunda:connector><camunda:inputOutput><camunda:inputParameter name="url">${ezdocUrl}/api/camunda/instance/book/saveLabel/${instanceId}?label=Услуга+ранее+была+подключена</camunda:inputParameter><camunda:inputParameter name="method">POST</camunda:inputParameter><camunda:inputParameter name="headers"><camunda:map><camunda:entry key="Accept">*/*</camunda:entry></camunda:map></camunda:inputParameter></camunda:inputOutput><camunda:connectorId>http-connector</camunda:connectorId></camunda:connector></bpmn:extensionElements><bpmn:incoming>Flow_057sqy4</bpmn:incoming><bpmn:outgoing>Flow_0nbwbqo</bpmn:outgoing></bpmn:serviceTask><bpmn:endEvent id="Event_0w2j8nd"><bpmn:incoming>Flow_0hu2vww</bpmn:incoming></bpmn:endEvent><bpmn:serviceTask id="Activity_0kwpg98" name="Устанавливаем значение параметров"><bpmn:extensionElements><camunda:properties><camunda:property name="isEzdocServiceTask" value="true" /><camunda:property name="ezdocServiceTaskType" value="request" /><camunda:property name="requestType" value="GENERIC" /></camunda:properties><camunda:connector><camunda:inputOutput><camunda:inputParameter name="headers"><camunda:map><camunda:entry key="Accept">*/*</camunda:entry><camunda:entry key="Content-Type">application/json</camunda:entry></camunda:map></camunda:inputParameter><camunda:inputParameter name="url">${ezdocUrl}/api/camunda/instance/book/${instanceId}/setAttributes</camunda:inputParameter><camunda:inputParameter name="method">POST</camunda:inputParameter><camunda:inputParameter name="payload"><camunda:script scriptFormat="javascript">S("{}")
.prop("Message", "Услуга ранее была подключена")
.toString()</camunda:script></camunda:inputParameter></camunda:inputOutput><camunda:connectorId>http-connector</camunda:connectorId></camunda:connector></bpmn:extensionElements><bpmn:incoming>Flow_02wig0e</bpmn:incoming><bpmn:outgoing>Flow_057sqy4</bpmn:outgoing></bpmn:serviceTask><bpmn:serviceTask id="Activity_1s57wdl" name="Сообщаем об окончании процесса" camunda:asyncAfter="true"><bpmn:extensionElements><camunda:connector><camunda:inputOutput><camunda:inputParameter name="url">${ezdocUrl}/api/camunda/instance/book/processCompleted/${instanceId}</camunda:inputParameter><camunda:inputParameter name="method">POST</camunda:inputParameter><camunda:inputParameter name="headers"><camunda:map><camunda:entry key="Accept">*/*</camunda:entry></camunda:map></camunda:inputParameter></camunda:inputOutput><camunda:connectorId>http-connector</camunda:connectorId></camunda:connector></bpmn:extensionElements><bpmn:incoming>Flow_0bfnahk</bpmn:incoming><bpmn:outgoing>Flow_0hu2vww</bpmn:outgoing></bpmn:serviceTask><bpmn:sequenceFlow id="Flow_057sqy4" sourceRef="Activity_0kwpg98" targetRef="Activity_0v831cg" /><bpmn:sequenceFlow id="Flow_0nbwbqo" sourceRef="Activity_0v831cg" targetRef="Activity_0n3hzb9" /><bpmn:sequenceFlow id="Flow_0hu2vww" sourceRef="Activity_1s57wdl" targetRef="Event_0w2j8nd" /><bpmn:sequenceFlow id="Flow_02wig0e" name="Этап 2 = true" sourceRef="Gateway_010ppfy" targetRef="Activity_0kwpg98"><bpmn:conditionExpression xsi:type="bpmn:tFormalExpression">${StatusStep2 == true}</bpmn:conditionExpression></bpmn:sequenceFlow><bpmn:exclusiveGateway id="Gateway_03dq40m" default="Flow_196f9ic"><bpmn:incoming>Flow_1bfstw1</bpmn:incoming><bpmn:outgoing>Flow_196f9ic</bpmn:outgoing><bpmn:outgoing>Flow_10xo2s5</bpmn:outgoing></bpmn:exclusiveGateway><bpmn:sequenceFlow id="Flow_196f9ic" sourceRef="Gateway_03dq40m" targetRef="Gateway_12znkgj" /><bpmn:serviceTask id="Activity_0tqs7br" name="Статус: Не найден список этапов в клиентском портфеле"><bpmn:extensionElements><camunda:connector><camunda:inputOutput><camunda:inputParameter name="url">${ezdocUrl}/api/camunda/instance/book/saveLabel/${instanceId}?label=Не+найден+список+этапов+в+клиентском+портфеле</camunda:inputParameter><camunda:inputParameter name="method">POST</camunda:inputParameter><camunda:inputParameter name="headers"><camunda:map><camunda:entry key="Accept">*/*</camunda:entry></camunda:map></camunda:inputParameter></camunda:inputOutput><camunda:connectorId>http-connector</camunda:connectorId></camunda:connector></bpmn:extensionElements><bpmn:incoming>Flow_065ob8i</bpmn:incoming><bpmn:outgoing>Flow_0rhrob7</bpmn:outgoing></bpmn:serviceTask><bpmn:endEvent id="Event_1l5ghhr"><bpmn:incoming>Flow_1dgg3a8</bpmn:incoming></bpmn:endEvent><bpmn:serviceTask id="Activity_1r70rkw" name="Устанавливаем значение параметров"><bpmn:extensionElements><camunda:properties><camunda:property name="isEzdocServiceTask" value="true" /><camunda:property name="ezdocServiceTaskType" value="request" /><camunda:property name="requestType" value="GENERIC" /></camunda:properties><camunda:connector><camunda:inputOutput><camunda:inputParameter name="headers"><camunda:map><camunda:entry key="Accept">*/*</camunda:entry><camunda:entry key="Content-Type">application/json</camunda:entry></camunda:map></camunda:inputParameter><camunda:inputParameter name="url">${ezdocUrl}/api/camunda/instance/book/${instanceId}/setAttributes</camunda:inputParameter><camunda:inputParameter name="method">POST</camunda:inputParameter><camunda:inputParameter name="payload"><camunda:script scriptFormat="javascript">S("{}")
.prop("Message", "Не найден список этапов в клиентском портфеле")
.toString()</camunda:script></camunda:inputParameter></camunda:inputOutput><camunda:connectorId>http-connector</camunda:connectorId></camunda:connector></bpmn:extensionElements><bpmn:incoming>Flow_10xo2s5</bpmn:incoming><bpmn:outgoing>Flow_065ob8i</bpmn:outgoing></bpmn:serviceTask><bpmn:serviceTask id="Activity_1a2yrap" name="Сообщаем об окончании процесса" camunda:asyncAfter="true"><bpmn:extensionElements><camunda:connector><camunda:inputOutput><camunda:inputParameter name="url">${ezdocUrl}/api/camunda/instance/book/processCompleted/${instanceId}</camunda:inputParameter><camunda:inputParameter name="method">POST</camunda:inputParameter><camunda:inputParameter name="headers"><camunda:map><camunda:entry key="Accept">*/*</camunda:entry></camunda:map></camunda:inputParameter></camunda:inputOutput><camunda:connectorId>http-connector</camunda:connectorId></camunda:connector></bpmn:extensionElements><bpmn:incoming>Flow_0tsnb5y</bpmn:incoming><bpmn:outgoing>Flow_1dgg3a8</bpmn:outgoing></bpmn:serviceTask><bpmn:sequenceFlow id="Flow_065ob8i" sourceRef="Activity_1r70rkw" targetRef="Activity_0tqs7br" /><bpmn:sequenceFlow id="Flow_0rhrob7" sourceRef="Activity_0tqs7br" targetRef="Activity_0lik84h" /><bpmn:sequenceFlow id="Flow_1dgg3a8" sourceRef="Activity_1a2yrap" targetRef="Event_1l5ghhr" /><bpmn:sequenceFlow id="Flow_10xo2s5" name="Не найден список этапов" sourceRef="Gateway_03dq40m" targetRef="Activity_1r70rkw"><bpmn:conditionExpression xsi:type="bpmn:tFormalExpression">${GuideSteps == null}</bpmn:conditionExpression></bpmn:sequenceFlow><bpmn:serviceTask id="Activity_1mfxf7u" name="Получаем  подключение услуги"><bpmn:extensionElements><camunda:properties><camunda:property name="isEzdocServiceTask" value="true" /><camunda:property name="ezdocServiceTaskType" value="request" /><camunda:property name="requestType" value="GENERIC" /></camunda:properties><camunda:connector><camunda:inputOutput><camunda:inputParameter name="headers"><camunda:map><camunda:entry key="Accept">*/*</camunda:entry><camunda:entry key="Content-Type">application/json</camunda:entry></camunda:map></camunda:inputParameter><camunda:inputParameter name="method">GET</camunda:inputParameter><camunda:inputParameter name="url">${ezdocUrl}/api/camunda/instance/book/${Portfolio_refid}/getAttributes?systemName=GuideSteps</camunda:inputParameter><camunda:outputParameter name="StatusStep1"><camunda:script scriptFormat="javascript">JSON.parse(response).GuideSteps[0].StatusStep</camunda:script></camunda:outputParameter><camunda:outputParameter name="StatusStep2"><camunda:script scriptFormat="javascript">JSON.parse(response).GuideSteps[1].StatusStep</camunda:script></camunda:outputParameter><camunda:outputParameter name="TestLength"><camunda:script scriptFormat="javascript">try{
S(response).prop("GuideSteps").elements().size()
} catch(e) {
0
}</camunda:script></camunda:outputParameter></camunda:inputOutput><camunda:connectorId>http-connector</camunda:connectorId></camunda:connector></bpmn:extensionElements><bpmn:incoming>Flow_093o21i</bpmn:incoming><bpmn:outgoing>Flow_17a5k4x</bpmn:outgoing></bpmn:serviceTask><bpmn:sequenceFlow id="Flow_17a5k4x" sourceRef="Activity_1mfxf7u" targetRef="Gateway_1x0ggt7" /><bpmn:serviceTask id="Activity_04e1yma" name="Статус: Услуга подключена"><bpmn:extensionElements><camunda:connector><camunda:inputOutput><camunda:inputParameter name="url">${ezdocUrl}/api/camunda/instance/book/saveLabel/${instanceId}?label=Услуга+подключена</camunda:inputParameter><camunda:inputParameter name="method">POST</camunda:inputParameter><camunda:inputParameter name="headers"><camunda:map><camunda:entry key="Accept">*/*</camunda:entry></camunda:map></camunda:inputParameter></camunda:inputOutput><camunda:connectorId>http-connector</camunda:connectorId></camunda:connector></bpmn:extensionElements><bpmn:incoming>Flow_17r224g</bpmn:incoming><bpmn:outgoing>Flow_0i0vkl4</bpmn:outgoing></bpmn:serviceTask><bpmn:sequenceFlow id="Flow_0i0vkl4" sourceRef="Activity_04e1yma" targetRef="Activity_11g05ia" /><bpmn:serviceTask id="Activity_1xdcgfq" name="Устанавливаем значение параметров"><bpmn:extensionElements><camunda:properties><camunda:property name="isEzdocServiceTask" value="true" /><camunda:property name="ezdocServiceTaskType" value="request" /><camunda:property name="requestType" value="GENERIC" /></camunda:properties><camunda:connector><camunda:inputOutput><camunda:inputParameter name="headers"><camunda:map><camunda:entry key="Accept">*/*</camunda:entry><camunda:entry key="Content-Type">application/json</camunda:entry></camunda:map></camunda:inputParameter><camunda:inputParameter name="url">${ezdocUrl}/api/camunda/instance/book/${instanceId}/setAttributes</camunda:inputParameter><camunda:inputParameter name="method">POST</camunda:inputParameter><camunda:inputParameter name="payload"><camunda:script scriptFormat="javascript">S("{}")
.prop("objectId", instanceId)
.toString()</camunda:script></camunda:inputParameter></camunda:inputOutput><camunda:connectorId>http-connector</camunda:connectorId></camunda:connector></bpmn:extensionElements><bpmn:incoming>Flow_1fuhu56</bpmn:incoming><bpmn:outgoing>Flow_11q0rn1</bpmn:outgoing></bpmn:serviceTask><bpmn:sequenceFlow id="Flow_11q0rn1" sourceRef="Activity_1xdcgfq" targetRef="Activity_0sqnh1c" /><bpmn:exclusiveGateway id="Gateway_1x0ggt7" default="Flow_0hedayr"><bpmn:incoming>Flow_17a5k4x</bpmn:incoming><bpmn:outgoing>Flow_0hedayr</bpmn:outgoing><bpmn:outgoing>Flow_07zf7yf</bpmn:outgoing></bpmn:exclusiveGateway><bpmn:sequenceFlow id="Flow_0hedayr" sourceRef="Gateway_1x0ggt7" targetRef="Gateway_010ppfy" /><bpmn:serviceTask id="Activity_0tcpisn" name="Не пройдено риск-профилирование"><bpmn:extensionElements><camunda:properties><camunda:property name="isEzdocServiceTask" value="true" /><camunda:property name="ezdocServiceTaskType" value="request" /><camunda:property name="requestType" value="GENERIC" /></camunda:properties><camunda:connector><camunda:inputOutput><camunda:inputParameter name="headers"><camunda:map><camunda:entry key="Accept">*/*</camunda:entry><camunda:entry key="Content-Type">application/json</camunda:entry></camunda:map></camunda:inputParameter><camunda:inputParameter name="url">${ezdocUrl}/api/camunda/instance/book/${instanceId}/setAttributes</camunda:inputParameter><camunda:inputParameter name="method">POST</camunda:inputParameter><camunda:inputParameter name="payload"><camunda:script scriptFormat="javascript">S("{}")
.prop("Message", "Не пройдено риск-профилирование")
.toString()</camunda:script></camunda:inputParameter></camunda:inputOutput><camunda:connectorId>http-connector</camunda:connectorId></camunda:connector></bpmn:extensionElements><bpmn:incoming>Flow_07zf7yf</bpmn:incoming><bpmn:outgoing>Flow_0rxrjdp</bpmn:outgoing></bpmn:serviceTask><bpmn:serviceTask id="Activity_0863e20" name="Статус: Ошибка исполнения процесса"><bpmn:extensionElements><camunda:connector><camunda:inputOutput><camunda:inputParameter name="url">${ezdocUrl}/api/camunda/instance/book/saveLabel/${instanceId}?label=Ошибка+исполнения+процесса</camunda:inputParameter><camunda:inputParameter name="method">POST</camunda:inputParameter><camunda:inputParameter name="headers"><camunda:map><camunda:entry key="Accept">*/*</camunda:entry></camunda:map></camunda:inputParameter></camunda:inputOutput><camunda:connectorId>http-connector</camunda:connectorId></camunda:connector></bpmn:extensionElements><bpmn:incoming>Flow_0rxrjdp</bpmn:incoming><bpmn:outgoing>Flow_1buxbit</bpmn:outgoing></bpmn:serviceTask><bpmn:serviceTask id="Activity_026riex" name="Сообщаем об окончании процесса" camunda:asyncAfter="true"><bpmn:extensionElements><camunda:connector><camunda:inputOutput><camunda:inputParameter name="url">${ezdocUrl}/api/camunda/instance/book/processCompleted/${instanceId}</camunda:inputParameter><camunda:inputParameter name="method">POST</camunda:inputParameter><camunda:inputParameter name="headers"><camunda:map><camunda:entry key="Accept">*/*</camunda:entry></camunda:map></camunda:inputParameter></camunda:inputOutput><camunda:connectorId>http-connector</camunda:connectorId></camunda:connector></bpmn:extensionElements><bpmn:incoming>Flow_0hoftp4</bpmn:incoming><bpmn:outgoing>Flow_0j3fnpv</bpmn:outgoing></bpmn:serviceTask><bpmn:endEvent id="Event_0dcqvpn"><bpmn:incoming>Flow_0j3fnpv</bpmn:incoming></bpmn:endEvent><bpmn:sequenceFlow id="Flow_0rxrjdp" sourceRef="Activity_0tcpisn" targetRef="Activity_0863e20" /><bpmn:sequenceFlow id="Flow_1buxbit" sourceRef="Activity_0863e20" targetRef="Activity_0x92fnj" /><bpmn:sequenceFlow id="Flow_0j3fnpv" sourceRef="Activity_026riex" targetRef="Event_0dcqvpn" /><bpmn:sequenceFlow id="Flow_07zf7yf" name="Этап 1 = false" sourceRef="Gateway_1x0ggt7" targetRef="Activity_0tcpisn"><bpmn:conditionExpression xsi:type="bpmn:tFormalExpression">${StatusStep1 == false}</bpmn:conditionExpression></bpmn:sequenceFlow><bpmn:serviceTask id="Activity_06r7jiu" name="Ищем клиента"><bpmn:extensionElements><camunda:properties><camunda:property name="isEzdocServiceTask" value="true" /><camunda:property name="ezdocServiceTaskType" value="request" /><camunda:property name="requestType" value="GENERIC" /></camunda:properties><camunda:connector><camunda:inputOutput><camunda:inputParameter name="headers"><camunda:map><camunda:entry key="Accept">*/*</camunda:entry><camunda:entry key="Content-Type">application/json</camunda:entry></camunda:map></camunda:inputParameter><camunda:inputParameter name="url">${ezdocUrl}/api/camunda/common/executeRequest</camunda:inputParameter><camunda:inputParameter name="method">POST</camunda:inputParameter><camunda:inputParameter name="payload">{ 	"find": "individualPerson", 	

"filter": 

{

"activityStatus": "ACTIVE", 

"attributes.cifID": "${CIF}"

},

"projection": { 		"_id": 1, "attributes.date_contract": 1, "attributes.num_contract":1 	}

}</camunda:inputParameter><camunda:outputParameter name="ClientId"><camunda:script scriptFormat="javascript">try {
JSON.parse(response).cursor.firstBatch[0]._id
}
catch (e)
{
"0"
}</camunda:script></camunda:outputParameter><camunda:outputParameter name="isEmpty"><camunda:script scriptFormat="javascript">S(response)
.prop("cursor")
.prop("firstBatch").elements().isEmpty()</camunda:script></camunda:outputParameter><camunda:outputParameter name="date_contract"><camunda:script scriptFormat="javascript">try {

JSON.parse(response).cursor.firstBatch[0].attributes.date_contract

}

catch (e)

{

""

}</camunda:script></camunda:outputParameter><camunda:outputParameter name="num_contract"><camunda:script scriptFormat="javascript">try {

JSON.parse(response).cursor.firstBatch[0].attributes.num_contract

}

catch (e)

{

""

}</camunda:script></camunda:outputParameter></camunda:inputOutput><camunda:connectorId>http-connector</camunda:connectorId></camunda:connector></bpmn:extensionElements><bpmn:incoming>Flow_0t4255l</bpmn:incoming><bpmn:outgoing>Flow_0b5e4bd</bpmn:outgoing></bpmn:serviceTask><bpmn:exclusiveGateway id="Gateway_0dg4rlu" default="Flow_1uqylzo"><bpmn:incoming>Flow_0b5e4bd</bpmn:incoming><bpmn:outgoing>Flow_1gfw6vl</bpmn:outgoing><bpmn:outgoing>Flow_1uqylzo</bpmn:outgoing></bpmn:exclusiveGateway><bpmn:serviceTask id="Activity_12w1g3x" name="Установка статуса &#34;Ошибка - не найден клиент&#34;"><bpmn:extensionElements><camunda:properties><camunda:property name="isEzdocServiceTask" value="true" /><camunda:property name="ezdocServiceTaskType" value="request" /><camunda:property name="requestType" value="GENERIC" /></camunda:properties><camunda:connector><camunda:inputOutput><camunda:inputParameter name="headers"><camunda:map><camunda:entry key="Accept">*/*</camunda:entry><camunda:entry key="Content-Type">application/json</camunda:entry></camunda:map></camunda:inputParameter><camunda:inputParameter name="url">${ezdocUrl}/api/camunda/instance/book/saveLabel/${instanceId}?label=Ошибка:+Не+найден+клиент</camunda:inputParameter><camunda:inputParameter name="method">POST</camunda:inputParameter></camunda:inputOutput><camunda:connectorId>http-connector</camunda:connectorId></camunda:connector></bpmn:extensionElements><bpmn:incoming>Flow_1gfw6vl</bpmn:incoming><bpmn:outgoing>Flow_073vw9e</bpmn:outgoing></bpmn:serviceTask><bpmn:serviceTask id="Activity_0mn355m" name="Устанавливаем значение параметров (сообщение об ошибке)" camunda:asyncAfter="true"><bpmn:extensionElements><camunda:properties><camunda:property name="isEzdocServiceTask" value="true" /><camunda:property name="ezdocServiceTaskType" value="request" /><camunda:property name="requestType" value="GENERIC" /></camunda:properties><camunda:connector><camunda:inputOutput><camunda:inputParameter name="headers"><camunda:map><camunda:entry key="Accept">*/*</camunda:entry><camunda:entry key="Content-Type">application/json</camunda:entry></camunda:map></camunda:inputParameter><camunda:inputParameter name="url">${ezdocUrl}/api/camunda/instance/book/${instanceId}/setAttributes?esWaitUntil=true</camunda:inputParameter><camunda:inputParameter name="method">POST</camunda:inputParameter><camunda:inputParameter name="payload"><camunda:script scriptFormat="javascript">S("{}")
.prop("Message","Не найден клиент")
.toString()</camunda:script></camunda:inputParameter></camunda:inputOutput><camunda:connectorId>http-connector</camunda:connectorId></camunda:connector></bpmn:extensionElements><bpmn:incoming>Flow_0l1msdm</bpmn:incoming><bpmn:outgoing>Flow_1jw0p2g</bpmn:outgoing></bpmn:serviceTask><bpmn:serviceTask id="Activity_1hl3l31" name="Сообщаем об окончании процесса"><bpmn:extensionElements><camunda:connector><camunda:inputOutput><camunda:inputParameter name="url">${ezdocUrl}/api/camunda/instance/book/processCompleted/${instanceId}</camunda:inputParameter><camunda:inputParameter name="method">POST</camunda:inputParameter><camunda:inputParameter name="headers"><camunda:map><camunda:entry key="Accept">*/*</camunda:entry></camunda:map></camunda:inputParameter></camunda:inputOutput><camunda:connectorId>http-connector</camunda:connectorId></camunda:connector></bpmn:extensionElements><bpmn:incoming>Flow_1jw0p2g</bpmn:incoming><bpmn:outgoing>Flow_0rwrk3c</bpmn:outgoing></bpmn:serviceTask><bpmn:endEvent id="Event_1i0hj0d"><bpmn:incoming>Flow_0rwrk3c</bpmn:incoming></bpmn:endEvent><bpmn:sequenceFlow id="Flow_0b5e4bd" sourceRef="Activity_06r7jiu" targetRef="Gateway_0dg4rlu" /><bpmn:sequenceFlow id="Flow_1gfw6vl" name="Не найден клиент" sourceRef="Gateway_0dg4rlu" targetRef="Activity_12w1g3x"><bpmn:conditionExpression xsi:type="bpmn:tFormalExpression">${isEmpty == true}</bpmn:conditionExpression></bpmn:sequenceFlow><bpmn:sequenceFlow id="Flow_073vw9e" sourceRef="Activity_12w1g3x" targetRef="Activity_1fibfpu" /><bpmn:sequenceFlow id="Flow_1jw0p2g" sourceRef="Activity_0mn355m" targetRef="Activity_1hl3l31" /><bpmn:sequenceFlow id="Flow_0rwrk3c" sourceRef="Activity_1hl3l31" targetRef="Event_1i0hj0d" /><bpmn:sequenceFlow id="Flow_0t4255l" sourceRef="Activity_0sqnh1c" targetRef="Activity_06r7jiu" /><bpmn:sequenceFlow id="Flow_1uqylzo" sourceRef="Gateway_0dg4rlu" targetRef="Gateway_0741lfn" /><bpmn:exclusiveGateway id="Gateway_0741lfn" default="Flow_1cagmnf"><bpmn:incoming>Flow_1uqylzo</bpmn:incoming><bpmn:outgoing>Flow_0wtm8tq</bpmn:outgoing><bpmn:outgoing>Flow_1cagmnf</bpmn:outgoing></bpmn:exclusiveGateway><bpmn:serviceTask id="Activity_0qme0ka" name="Сообщаем об окончании процесса"><bpmn:extensionElements><camunda:connector><camunda:inputOutput><camunda:inputParameter name="url">${ezdocUrl}/api/camunda/instance/book/processCompleted/${instanceId}</camunda:inputParameter><camunda:inputParameter name="method">POST</camunda:inputParameter><camunda:inputParameter name="headers"><camunda:map><camunda:entry key="Accept">*/*</camunda:entry></camunda:map></camunda:inputParameter></camunda:inputOutput><camunda:connectorId>http-connector</camunda:connectorId></camunda:connector></bpmn:extensionElements><bpmn:incoming>Flow_1uu33o9</bpmn:incoming><bpmn:outgoing>Flow_1ingrqu</bpmn:outgoing></bpmn:serviceTask><bpmn:endEvent id="Event_0zqsue4"><bpmn:incoming>Flow_1ingrqu</bpmn:incoming></bpmn:endEvent><bpmn:serviceTask id="Activity_0a824wv" name="Установка статуса &#34;Ошибка - нет подключенного договора&#34;"><bpmn:extensionElements><camunda:properties><camunda:property name="isEzdocServiceTask" value="true" /><camunda:property name="ezdocServiceTaskType" value="request" /><camunda:property name="requestType" value="GENERIC" /></camunda:properties><camunda:connector><camunda:inputOutput><camunda:inputParameter name="headers"><camunda:map><camunda:entry key="Accept">*/*</camunda:entry><camunda:entry key="Content-Type">application/json</camunda:entry></camunda:map></camunda:inputParameter><camunda:inputParameter name="url">${ezdocUrl}/api/camunda/instance/book/saveLabel/${instanceId}?label=Ошибка:+Нет+подключенного+договора</camunda:inputParameter><camunda:inputParameter name="method">POST</camunda:inputParameter></camunda:inputOutput><camunda:connectorId>http-connector</camunda:connectorId></camunda:connector></bpmn:extensionElements><bpmn:incoming>Flow_0ochgeq</bpmn:incoming><bpmn:incoming>Flow_17j4r8b</bpmn:incoming><bpmn:outgoing>Flow_1r2h58q</bpmn:outgoing></bpmn:serviceTask><bpmn:serviceTask id="Activity_0roflre" name="Устанавливаем значение параметров (сообщение об ошибке)" camunda:asyncAfter="true"><bpmn:extensionElements><camunda:properties><camunda:property name="isEzdocServiceTask" value="true" /><camunda:property name="ezdocServiceTaskType" value="request" /><camunda:property name="requestType" value="GENERIC" /></camunda:properties><camunda:connector><camunda:inputOutput><camunda:inputParameter name="headers"><camunda:map><camunda:entry key="Accept">*/*</camunda:entry><camunda:entry key="Content-Type">application/json</camunda:entry></camunda:map></camunda:inputParameter><camunda:inputParameter name="url">${ezdocUrl}/api/camunda/instance/book/${instanceId}/setAttributes?esWaitUntil=true</camunda:inputParameter><camunda:inputParameter name="method">POST</camunda:inputParameter><camunda:inputParameter name="payload"><camunda:script scriptFormat="javascript">S("{}")
.prop("Message","Нет подключенного договора")
.toString()</camunda:script></camunda:inputParameter></camunda:inputOutput><camunda:connectorId>http-connector</camunda:connectorId></camunda:connector></bpmn:extensionElements><bpmn:incoming>Flow_1u5wzp2</bpmn:incoming><bpmn:outgoing>Flow_1uu33o9</bpmn:outgoing></bpmn:serviceTask><bpmn:sequenceFlow id="Flow_1uu33o9" sourceRef="Activity_0roflre" targetRef="Activity_0qme0ka" /><bpmn:sequenceFlow id="Flow_1ingrqu" sourceRef="Activity_0qme0ka" targetRef="Event_0zqsue4" /><bpmn:sequenceFlow id="Flow_1r2h58q" sourceRef="Activity_0a824wv" targetRef="Activity_1ioqudu" /><bpmn:sequenceFlow id="Flow_0wtm8tq" name="Не заполнен номер договора в карточке ФЛ" sourceRef="Gateway_0741lfn" targetRef="Activity_08g1rg6"><bpmn:conditionExpression xsi:type="bpmn:tFormalExpression">${date_contract == null || date_contract == '' || num_contract == null || num_contract == ""}</bpmn:conditionExpression></bpmn:sequenceFlow><bpmn:serviceTask id="Activity_08g1rg6" name="Ищем подключение договора"><bpmn:extensionElements><camunda:properties><camunda:property name="isEzdocServiceTask" value="true" /><camunda:property name="ezdocServiceTaskType" value="request" /><camunda:property name="requestType" value="GENERIC" /></camunda:properties><camunda:connector><camunda:inputOutput><camunda:inputParameter name="headers"><camunda:map><camunda:entry key="Accept">*/*</camunda:entry><camunda:entry key="Content-Type">application/json</camunda:entry></camunda:map></camunda:inputParameter><camunda:inputParameter name="url">${ezdocUrl}/api/camunda/common/executeRequest</camunda:inputParameter><camunda:inputParameter name="method">POST</camunda:inputParameter><camunda:inputParameter name="payload">{ 	"find": "book", 	
"filter": 
{
"activityStatus": "ACTIVE", 
"templatePrimaryId": "625411bfd012533b51cfec42", 
"attributes.cifID": "${CIF}"
},
"projection": { 		"_id": 1, "attributes.date_contract": 1, "attributes.num_contract":1 	}
}</camunda:inputParameter><camunda:outputParameter name="agr_refid"><camunda:script scriptFormat="javascript">try {
JSON.parse(response).cursor.firstBatch[0]._id
}
catch (e)
{
"0"
}</camunda:script></camunda:outputParameter><camunda:outputParameter name="isEmptyAgr"><camunda:script scriptFormat="javascript">S(response)
.prop("cursor")
.prop("firstBatch").elements().isEmpty()</camunda:script></camunda:outputParameter><camunda:outputParameter name="date_contract"><camunda:script scriptFormat="javascript">try {

JSON.parse(response).cursor.firstBatch[0].attributes.date_contract

}

catch (e)

{

""

}</camunda:script></camunda:outputParameter><camunda:outputParameter name="num_contract"><camunda:script scriptFormat="javascript">try {

JSON.parse(response).cursor.firstBatch[0].attributes.num_contract

}

catch (e)

{

""

}</camunda:script></camunda:outputParameter></camunda:inputOutput><camunda:connectorId>http-connector</camunda:connectorId></camunda:connector></bpmn:extensionElements><bpmn:incoming>Flow_0wtm8tq</bpmn:incoming><bpmn:outgoing>Flow_1twzvby</bpmn:outgoing></bpmn:serviceTask><bpmn:exclusiveGateway id="Gateway_0ogh2rb" default="Flow_017wng7"><bpmn:incoming>Flow_0cie6ym</bpmn:incoming><bpmn:outgoing>Flow_0ochgeq</bpmn:outgoing><bpmn:outgoing>Flow_017wng7</bpmn:outgoing></bpmn:exclusiveGateway><bpmn:sequenceFlow id="Flow_1twzvby" sourceRef="Activity_08g1rg6" targetRef="Gateway_02bv1e0" /><bpmn:sequenceFlow id="Flow_0ochgeq" sourceRef="Gateway_0ogh2rb" targetRef="Activity_0a824wv"><bpmn:conditionExpression xsi:type="bpmn:tFormalExpression">${date_contract == null || date_contract == '' || num_contract == null || num_contract == ""}</bpmn:conditionExpression></bpmn:sequenceFlow><bpmn:sequenceFlow id="Flow_017wng7" sourceRef="Gateway_0ogh2rb" targetRef="Activity_052kjbn" /><bpmn:serviceTask id="Activity_052kjbn" name="Устанавливаем значение параметров (дата и время договора)"><bpmn:extensionElements><camunda:properties><camunda:property name="isEzdocServiceTask" value="true" /><camunda:property name="ezdocServiceTaskType" value="request" /><camunda:property name="requestType" value="GENERIC" /></camunda:properties><camunda:connector><camunda:inputOutput><camunda:inputParameter name="headers"><camunda:map><camunda:entry key="Accept">*/*</camunda:entry><camunda:entry key="Content-Type">application/json</camunda:entry></camunda:map></camunda:inputParameter><camunda:inputParameter name="url">${ezdocUrl}/api/camunda/instance/book/${instanceId}/setAttributes?esWaitUntil=true</camunda:inputParameter><camunda:inputParameter name="method">POST</camunda:inputParameter><camunda:inputParameter name="payload"><camunda:script scriptFormat="javascript">S("{}")
.prop("date_contract", date_contract)
.prop("num_contract", num_contract)
.toString()</camunda:script></camunda:inputParameter></camunda:inputOutput><camunda:connectorId>http-connector</camunda:connectorId></camunda:connector></bpmn:extensionElements><bpmn:incoming>Flow_017wng7</bpmn:incoming><bpmn:incoming>Flow_1cagmnf</bpmn:incoming><bpmn:outgoing>Flow_1s43g4n</bpmn:outgoing></bpmn:serviceTask><bpmn:sequenceFlow id="Flow_1s43g4n" sourceRef="Activity_052kjbn" targetRef="Activity_08jdouv" /><bpmn:exclusiveGateway id="Gateway_02bv1e0" default="Flow_0cie6ym"><bpmn:incoming>Flow_1twzvby</bpmn:incoming><bpmn:outgoing>Flow_0cie6ym</bpmn:outgoing><bpmn:outgoing>Flow_17j4r8b</bpmn:outgoing></bpmn:exclusiveGateway><bpmn:sequenceFlow id="Flow_0cie6ym" sourceRef="Gateway_02bv1e0" targetRef="Gateway_0ogh2rb" /><bpmn:sequenceFlow id="Flow_17j4r8b" sourceRef="Gateway_02bv1e0" targetRef="Activity_0a824wv"><bpmn:conditionExpression xsi:type="bpmn:tFormalExpression">${isEmptyAgr == true}</bpmn:conditionExpression></bpmn:sequenceFlow><bpmn:userTask id="Activity_02w0ta4" name="Продолжить" camunda:candidateGroups="jira-users, cb_backoffice"><bpmn:extensionElements><camunda:properties><camunda:property name="isEzdocTask" value="true" /><camunda:property name="ezdocTaskType" value="buttons" /></camunda:properties><camunda:taskListener event="create"><camunda:script scriptFormat="javascript">try {
              var formData = task.execution.processEngineServices.formService.getTaskFormData(task.id);
              var data = {};
              data.taskId = task.id;
              data.templateId = templateId;
              data.formKey = formData.formKey;
              var formFields = [];
              formData.formFields.forEach(function (a) {formFields.push(a.id)});
              data.formFields = formFields;

              httpPost(ezdocUrl + "/api/camunda/common/taskNotify?type=" + type + "&amp;instanceId=" + instanceId, JSON.stringify(data));
              }
              catch(error) {}

              /*************
              UTILITY FUNCTIONS
              *************/
              function httpPost(e,t,n){n=n||"application/json;charset=UTF-8";var a=new java.net.URL(e).openConnection();return a.requestMethod="POST",a.setRequestProperty("Content-Type",n),a.setRequestProperty("Accept-Charset", "UTF-8"),a.doOutput=!0,write(a.outputStream,t),asResponse(a)}function asResponse(e){return{data:read(e.inputStream),statusCode:e.responseCode}}function write(e,t){var n=new java.io.DataOutputStream(e);n.writeChars(t),n.flush(),n.close()}function read(e){for(var t,n=new java.io.BufferedReader(new java.io.InputStreamReader(e)),a=new java.lang.StringBuffer;null!=(t=n.readLine());)a.append(t);return n.close(),a.toString()}</camunda:script></camunda:taskListener><camunda:formData><camunda:formField id="{&#34;id&#34;: &#34;Prodolg&#34;, &#34;label&#34;: &#34;Продолжить&#34;, &#34;type&#34;:&#34;simple&#34;}" type="string" /><camunda:formField id="ezdocObjectUrl" type="string" /><camunda:formField id="ezdocObjectEditorUrl" type="string" /></camunda:formData></bpmn:extensionElements></bpmn:userTask><bpmn:sequenceFlow id="Flow_1cagmnf" sourceRef="Gateway_0741lfn" targetRef="Activity_052kjbn" /><bpmn:serviceTask id="Activity_0z96jix" name="апдейтим клиента"><bpmn:extensionElements><camunda:connector><camunda:inputOutput><camunda:inputParameter name="url">${ezdocUrl}/api/integration/queue/send/BOOK/by/${instanceId}/to/INDIVIDUAL</camunda:inputParameter><camunda:inputParameter name="method">POST</camunda:inputParameter><camunda:inputParameter name="headers"><camunda:map><camunda:entry key="Accept">*/*</camunda:entry><camunda:entry key="Content-Type">application/json</camunda:entry></camunda:map></camunda:inputParameter><camunda:inputParameter name="payload"><camunda:script scriptFormat="javascript">S("{}")
.prop("date_contract", date_contract)
.prop("num_contract", num_contract)
.toString()</camunda:script></camunda:inputParameter></camunda:inputOutput><camunda:connectorId>http-connector</camunda:connectorId></camunda:connector></bpmn:extensionElements><bpmn:incoming>Flow_03w6pmh</bpmn:incoming><bpmn:outgoing>Flow_17b7rep</bpmn:outgoing></bpmn:serviceTask><bpmn:sequenceFlow id="Flow_17b7rep" sourceRef="Activity_0z96jix" targetRef="Activity_1qzjugx" /><bpmn:serviceTask id="Activity_0098u0b" name="Загрузка из коннекта"><bpmn:extensionElements><camunda:properties><camunda:property name="isEzdocServiceTask" value="true" /><camunda:property name="ezdocServiceTaskType" value="request" /><camunda:property name="requestType" value="GENERIC" /></camunda:properties><camunda:connector><camunda:inputOutput><camunda:inputParameter name="headers"><camunda:map><camunda:entry key="Accept">*/*</camunda:entry><camunda:entry key="Content-Type">application/json</camunda:entry><camunda:entry key="Authorization">Basic ${Authorization}</camunda:entry></camunda:map></camunda:inputParameter><camunda:inputParameter name="url">${connectUrl}/api/v1/tasks/TransferClientRMQ/command-executor?cmd=SendCifid</camunda:inputParameter><camunda:inputParameter name="method">POST</camunda:inputParameter><camunda:inputParameter name="payload">{
"cifID": "${CIF}"
}</camunda:inputParameter><camunda:outputParameter name="r_response">${response}</camunda:outputParameter><camunda:outputParameter name="IsSuccess"><camunda:script scriptFormat="javascript">try {
JSON.parse(response).success
}
catch (e)
{
false
}</camunda:script></camunda:outputParameter></camunda:inputOutput><camunda:connectorId>http-connector</camunda:connectorId></camunda:connector></bpmn:extensionElements><bpmn:incoming>Flow_075v9ga</bpmn:incoming><bpmn:outgoing>Flow_03llxxq</bpmn:outgoing></bpmn:serviceTask><bpmn:sequenceFlow id="Flow_03llxxq" sourceRef="Activity_0098u0b" targetRef="Gateway_1lygg0k" /><bpmn:exclusiveGateway id="Gateway_1lygg0k" default="Flow_0ndx1bh"><bpmn:incoming>Flow_03llxxq</bpmn:incoming><bpmn:outgoing>Flow_0ndx1bh</bpmn:outgoing><bpmn:outgoing>Flow_0vvxx4v</bpmn:outgoing></bpmn:exclusiveGateway><bpmn:sequenceFlow id="Flow_0ndx1bh" name="Не загружено" sourceRef="Gateway_1lygg0k" targetRef="Activity_1mjr46s" /><bpmn:serviceTask id="Activity_1qxko1a" name="Ищем клиентский портфель"><bpmn:extensionElements><camunda:properties><camunda:property name="isEzdocServiceTask" value="true" /><camunda:property name="ezdocServiceTaskType" value="request" /><camunda:property name="requestType" value="GENERIC" /></camunda:properties><camunda:connector><camunda:inputOutput><camunda:inputParameter name="headers"><camunda:map><camunda:entry key="Accept">*/*</camunda:entry><camunda:entry key="Content-Type">application/json</camunda:entry></camunda:map></camunda:inputParameter><camunda:inputParameter name="url">${ezdocUrl}/api/camunda/common/executeRequest</camunda:inputParameter><camunda:inputParameter name="method">POST</camunda:inputParameter><camunda:inputParameter name="payload">{ 	"find": "book", 	
"filter": 
{
"activityStatus": "ACTIVE", 
"templatePrimaryId": "6167d4df7ef9df0776685460", 
"attributes.brokerageAccountID": "${brokerageAccountID}",
"attributes.cifID": "${CIF}"
},
"projection": { 		"_id": 1 	}
}</camunda:inputParameter><camunda:outputParameter name="Portfolio_refid"><camunda:script scriptFormat="javascript">try {
JSON.parse(response).cursor.firstBatch[0]._id
}
catch (e)
{
"0"
}</camunda:script></camunda:outputParameter><camunda:outputParameter name="isEmptyPortf"><camunda:script scriptFormat="javascript">S(response)
.prop("cursor")
.prop("firstBatch").elements().isEmpty()</camunda:script></camunda:outputParameter></camunda:inputOutput><camunda:connectorId>http-connector</camunda:connectorId></camunda:connector></bpmn:extensionElements><bpmn:incoming>Flow_0vvxx4v</bpmn:incoming><bpmn:outgoing>Flow_07ax021</bpmn:outgoing></bpmn:serviceTask><bpmn:exclusiveGateway id="Gateway_1riqey3" default="Flow_1xwkqvn"><bpmn:incoming>Flow_07ax021</bpmn:incoming><bpmn:outgoing>Flow_1xwkqvn</bpmn:outgoing><bpmn:outgoing>Flow_17gh0x8</bpmn:outgoing></bpmn:exclusiveGateway><bpmn:sequenceFlow id="Flow_07ax021" sourceRef="Activity_1qxko1a" targetRef="Gateway_1riqey3" /><bpmn:sequenceFlow id="Flow_0vvxx4v" name="Загружено" sourceRef="Gateway_1lygg0k" targetRef="Activity_1qxko1a"><bpmn:conditionExpression xsi:type="bpmn:tFormalExpression">${IsSuccess == true}</bpmn:conditionExpression></bpmn:sequenceFlow><bpmn:sequenceFlow id="Flow_1xwkqvn" name="Портфель найден после загрузки" sourceRef="Gateway_1riqey3" targetRef="Activity_1wfpugf" /><bpmn:sequenceFlow id="Flow_17gh0x8" name="Не найден портфель" sourceRef="Gateway_1riqey3" targetRef="Activity_1mjr46s"><bpmn:conditionExpression xsi:type="bpmn:tFormalExpression">${isEmptyPortf == true}</bpmn:conditionExpression></bpmn:sequenceFlow><bpmn:scriptTask id="Activity_1fibfpu" name="Формирование ответа" scriptFormat="javascript" camunda:resultVariable="Q_Result"><bpmn:incoming>Flow_073vw9e</bpmn:incoming><bpmn:outgoing>Flow_0l1msdm</bpmn:outgoing><bpmn:script>var q = new Object();
q.message = "Не найден клиент " + CIF;
q.status = "ERROR";
JSON.stringify(q);</bpmn:script></bpmn:scriptTask><bpmn:sequenceFlow id="Flow_0l1msdm" sourceRef="Activity_1fibfpu" targetRef="Activity_0mn355m" /><bpmn:scriptTask id="Activity_1ioqudu" name="Формирование ответа" scriptFormat="javascript" camunda:resultVariable="Q_Result"><bpmn:incoming>Flow_1r2h58q</bpmn:incoming><bpmn:outgoing>Flow_1u5wzp2</bpmn:outgoing><bpmn:script>var q = new Object();
q.message = "Нет подключенного договора";
q.status = "ERROR";
JSON.stringify(q);</bpmn:script></bpmn:scriptTask><bpmn:sequenceFlow id="Flow_1u5wzp2" sourceRef="Activity_1ioqudu" targetRef="Activity_0roflre" /><bpmn:scriptTask id="Activity_0p2rd71" name="Формирование ответа" scriptFormat="javascript" camunda:resultVariable="Q_Result"><bpmn:incoming>Flow_12b9dh0</bpmn:incoming><bpmn:outgoing>Flow_18klgis</bpmn:outgoing><bpmn:script>var q = new Object();
q.message = "Не найден клиентский портфель " + brokerageAccountID;
q.status = "ERROR";
JSON.stringify(q);</bpmn:script></bpmn:scriptTask><bpmn:sequenceFlow id="Flow_18klgis" sourceRef="Activity_0p2rd71" targetRef="Activity_0fyvm6x" /><bpmn:scriptTask id="Activity_0lik84h" name="Формирование ответа" scriptFormat="javascript" camunda:resultVariable="Q_Result"><bpmn:incoming>Flow_0rhrob7</bpmn:incoming><bpmn:outgoing>Flow_0tsnb5y</bpmn:outgoing><bpmn:script>var q = new Object();
q.message = "Не найден список этапов в клиентском портфеле " + brokerageAccountID;
q.status = "ERROR";
JSON.stringify(q);</bpmn:script></bpmn:scriptTask><bpmn:sequenceFlow id="Flow_0tsnb5y" sourceRef="Activity_0lik84h" targetRef="Activity_1a2yrap" /><bpmn:scriptTask id="Activity_0x92fnj" name="Формирование ответа" scriptFormat="javascript" camunda:resultVariable="Q_Result"><bpmn:incoming>Flow_1buxbit</bpmn:incoming><bpmn:outgoing>Flow_0hoftp4</bpmn:outgoing><bpmn:script>var q = new Object();
q.message = "Не пройдено риск-профилирование по клиенту " + CIF;
q.status = "ERROR";
JSON.stringify(q);</bpmn:script></bpmn:scriptTask><bpmn:sequenceFlow id="Flow_0hoftp4" sourceRef="Activity_0x92fnj" targetRef="Activity_026riex" /><bpmn:scriptTask id="Activity_0n3hzb9" name="Формирование ответа" scriptFormat="javascript" camunda:resultVariable="Q_Result"><bpmn:incoming>Flow_0nbwbqo</bpmn:incoming><bpmn:outgoing>Flow_0bfnahk</bpmn:outgoing><bpmn:script>var q = new Object();
q.message = "Услуга ранее была подключена";
q.status = "ERROR";
JSON.stringify(q);</bpmn:script></bpmn:scriptTask><bpmn:sequenceFlow id="Flow_0bfnahk" sourceRef="Activity_0n3hzb9" targetRef="Activity_1s57wdl" /><bpmn:scriptTask id="Activity_131qv8p" name="переменная" scriptFormat="javascript"><bpmn:incoming>Flow_06sa7q7</bpmn:incoming><bpmn:outgoing>Flow_1cjlsqv</bpmn:outgoing><bpmn:script>execution.setVariable("connectUrl", (java.lang.System).getenv("connectUrl"))</bpmn:script></bpmn:scriptTask><bpmn:scriptTask id="Activity_11g05ia" name="Формирование ответа" scriptFormat="javascript" camunda:resultVariable="Q_Result"><bpmn:incoming>Flow_0i0vkl4</bpmn:incoming><bpmn:outgoing>Flow_1qji0wp</bpmn:outgoing><bpmn:script>var q = new Object();
q.status = "SUCCESS";
JSON.stringify(q);</bpmn:script></bpmn:scriptTask><bpmn:sequenceFlow id="Flow_1qji0wp" sourceRef="Activity_11g05ia" targetRef="Activity_0eir13n" /><bpmn:userTask id="Activity_0oxf5j6" name="Продолжить" camunda:candidateGroups="jira-users, cb_backoffice"><bpmn:extensionElements><camunda:properties><camunda:property name="isEzdocTask" value="true" /><camunda:property name="ezdocTaskType" value="buttons" /></camunda:properties><camunda:taskListener event="create"><camunda:script scriptFormat="javascript">try {
              var formData = task.execution.processEngineServices.formService.getTaskFormData(task.id);
              var data = {};
              data.taskId = task.id;
              data.templateId = templateId;
              data.formKey = formData.formKey;
              var formFields = [];
              formData.formFields.forEach(function (a) {formFields.push(a.id)});
              data.formFields = formFields;

              httpPost(ezdocUrl + "/api/camunda/common/taskNotify?type=" + type + "&amp;instanceId=" + instanceId, JSON.stringify(data));
              }
              catch(error) {}

              /*************
              UTILITY FUNCTIONS
              *************/
              function httpPost(e,t,n){n=n||"application/json;charset=UTF-8";var a=new java.net.URL(e).openConnection();return a.requestMethod="POST",a.setRequestProperty("Content-Type",n),a.setRequestProperty("Accept-Charset", "UTF-8"),a.doOutput=!0,write(a.outputStream,t),asResponse(a)}function asResponse(e){return{data:read(e.inputStream),statusCode:e.responseCode}}function write(e,t){var n=new java.io.DataOutputStream(e);n.writeChars(t),n.flush(),n.close()}function read(e){for(var t,n=new java.io.BufferedReader(new java.io.InputStreamReader(e)),a=new java.lang.StringBuffer;null!=(t=n.readLine());)a.append(t);return n.close(),a.toString()}</camunda:script></camunda:taskListener><camunda:formData><camunda:formField id="{&#34;id&#34;: &#34;Prodolg&#34;, &#34;label&#34;: &#34;Продолжить&#34;, &#34;type&#34;:&#34;simple&#34;}" type="string" /><camunda:formField id="ezdocObjectUrl" type="string" /><camunda:formField id="ezdocObjectEditorUrl" type="string" /></camunda:formData></bpmn:extensionElements></bpmn:userTask><bpmn:sequenceFlow id="Flow_12b9dh0" sourceRef="Activity_08factb" targetRef="Activity_0p2rd71" /><bpmn:sequenceFlow id="Flow_1cjlsqv" sourceRef="Activity_131qv8p" targetRef="Activity_1tenab0" /><bpmn:sequenceFlow id="Flow_093o21i" sourceRef="Gateway_12znkgj" targetRef="Activity_1mfxf7u" /><bpmn:exclusiveGateway id="Gateway_12znkgj" default="Flow_093o21i"><bpmn:incoming>Flow_196f9ic</bpmn:incoming><bpmn:outgoing>Flow_093o21i</bpmn:outgoing><bpmn:outgoing>Flow_1o6dpit</bpmn:outgoing></bpmn:exclusiveGateway><bpmn:serviceTask id="Activity_0hbc0i1" name="Статус: Не найден clientCode  в клиентском портфеле"><bpmn:extensionElements><camunda:connector><camunda:inputOutput><camunda:inputParameter name="url">${ezdocUrl}/api/camunda/instance/book/saveLabel/${instanceId}?label=Не+найден+clientCode+в+клиентском+портфеле</camunda:inputParameter><camunda:inputParameter name="method">POST</camunda:inputParameter><camunda:inputParameter name="headers"><camunda:map><camunda:entry key="Accept">*/*</camunda:entry></camunda:map></camunda:inputParameter></camunda:inputOutput><camunda:connectorId>http-connector</camunda:connectorId></camunda:connector></bpmn:extensionElements><bpmn:incoming>Flow_0vqg1mn</bpmn:incoming><bpmn:outgoing>Flow_1r9ixbw</bpmn:outgoing></bpmn:serviceTask><bpmn:endEvent id="Event_1bf1ba7"><bpmn:incoming>Flow_0g08vg5</bpmn:incoming></bpmn:endEvent><bpmn:serviceTask id="Activity_0qwcfxo" name="Устанавливаем значение параметров"><bpmn:extensionElements><camunda:properties><camunda:property name="isEzdocServiceTask" value="true" /><camunda:property name="ezdocServiceTaskType" value="request" /><camunda:property name="requestType" value="GENERIC" /></camunda:properties><camunda:connector><camunda:inputOutput><camunda:inputParameter name="headers"><camunda:map><camunda:entry key="Accept">*/*</camunda:entry><camunda:entry key="Content-Type">application/json</camunda:entry></camunda:map></camunda:inputParameter><camunda:inputParameter name="url">${ezdocUrl}/api/camunda/instance/book/${instanceId}/setAttributes</camunda:inputParameter><camunda:inputParameter name="method">POST</camunda:inputParameter><camunda:inputParameter name="payload"><camunda:script scriptFormat="javascript">S("{}")
.prop("Message", "Не найден clientCode в клиентском портфеле")
.toString()</camunda:script></camunda:inputParameter></camunda:inputOutput><camunda:connectorId>http-connector</camunda:connectorId></camunda:connector></bpmn:extensionElements><bpmn:incoming>Flow_1o6dpit</bpmn:incoming><bpmn:outgoing>Flow_0vqg1mn</bpmn:outgoing></bpmn:serviceTask><bpmn:serviceTask id="Activity_0mllv4y" name="Сообщаем об окончании процесса" camunda:asyncAfter="true"><bpmn:extensionElements><camunda:connector><camunda:inputOutput><camunda:inputParameter name="url">${ezdocUrl}/api/camunda/instance/book/processCompleted/${instanceId}</camunda:inputParameter><camunda:inputParameter name="method">POST</camunda:inputParameter><camunda:inputParameter name="headers"><camunda:map><camunda:entry key="Accept">*/*</camunda:entry></camunda:map></camunda:inputParameter></camunda:inputOutput><camunda:connectorId>http-connector</camunda:connectorId></camunda:connector></bpmn:extensionElements><bpmn:incoming>Flow_0vqs8mz</bpmn:incoming><bpmn:outgoing>Flow_0g08vg5</bpmn:outgoing></bpmn:serviceTask><bpmn:scriptTask id="Activity_0x8747s" name="Формирование ответа" scriptFormat="javascript" camunda:resultVariable="Q_Result"><bpmn:incoming>Flow_1r9ixbw</bpmn:incoming><bpmn:outgoing>Flow_0vqs8mz</bpmn:outgoing><bpmn:script>var q = new Object();
q.message = "Не найден clientCode в клиентском портфеле " + brokerageAccountID;
q.status = "ERROR";
JSON.stringify(q);</bpmn:script></bpmn:scriptTask><bpmn:sequenceFlow id="Flow_0vqg1mn" sourceRef="Activity_0qwcfxo" targetRef="Activity_0hbc0i1" /><bpmn:sequenceFlow id="Flow_1r9ixbw" sourceRef="Activity_0hbc0i1" targetRef="Activity_0x8747s" /><bpmn:sequenceFlow id="Flow_0g08vg5" sourceRef="Activity_0mllv4y" targetRef="Event_1bf1ba7" /><bpmn:sequenceFlow id="Flow_0vqs8mz" sourceRef="Activity_0x8747s" targetRef="Activity_0mllv4y" /><bpmn:sequenceFlow id="Flow_1o6dpit" sourceRef="Gateway_12znkgj" targetRef="Activity_0qwcfxo"><bpmn:conditionExpression xsi:type="bpmn:tFormalExpression">${clientCode == null}</bpmn:conditionExpression></bpmn:sequenceFlow><bpmn:scriptTask id="Activity_1tenab0" name="переменная для авторизации" scriptFormat="javascript"><bpmn:incoming>Flow_1cjlsqv</bpmn:incoming><bpmn:outgoing>Flow_075v9ga</bpmn:outgoing><bpmn:script>execution.setVariable("Authorization", (java.lang.System).getenv("Authorization"))</bpmn:script></bpmn:scriptTask><bpmn:sequenceFlow id="Flow_075v9ga" sourceRef="Activity_1tenab0" targetRef="Activity_0098u0b" /></bpmn:process><bpmn:signal id="Signal_0zwvnaz" name="bookUpdateReceive${instanceId}" /><bpmndi:BPMNDiagram id="BPMNDiagram_1"><bpmndi:BPMNPlane id="BPMNPlane_1" bpmnElement="TEMPLATE_INSTANCE_PROCESS_enablingAccount_08b1d1c5-2983-4ace-9e84-e62d23e1956b"><bpmndi:BPMNEdge id="Flow_075v9ga_di" bpmnElement="Flow_075v9ga"><di:waypoint x="1490" y="400" /><di:waypoint x="1490" y="490" /></bpmndi:BPMNEdge><bpmndi:BPMNEdge id="Flow_1o6dpit_di" bpmnElement="Flow_1o6dpit"><di:waypoint x="2030" y="145" /><di:waypoint x="2030" y="200" /></bpmndi:BPMNEdge><bpmndi:BPMNEdge id="Flow_0vqs8mz_di" bpmnElement="Flow_0vqs8mz"><di:waypoint x="2030" y="520" /><di:waypoint x="2030" y="600" /></bpmndi:BPMNEdge><bpmndi:BPMNEdge id="Flow_0g08vg5_di" bpmnElement="Flow_0g08vg5"><di:waypoint x="2030" y="680" /><di:waypoint x="2030" y="722" /></bpmndi:BPMNEdge><bpmndi:BPMNEdge id="Flow_1r9ixbw_di" bpmnElement="Flow_1r9ixbw"><di:waypoint x="2030" y="400" /><di:waypoint x="2030" y="440" /></bpmndi:BPMNEdge><bpmndi:BPMNEdge id="Flow_0vqg1mn_di" bpmnElement="Flow_0vqg1mn"><di:waypoint x="2030" y="280" /><di:waypoint x="2030" y="320" /></bpmndi:BPMNEdge><bpmndi:BPMNEdge id="Flow_093o21i_di" bpmnElement="Flow_093o21i"><di:waypoint x="2055" y="120" /><di:waypoint x="2090" y="120" /></bpmndi:BPMNEdge><bpmndi:BPMNEdge id="Flow_1cjlsqv_di" bpmnElement="Flow_1cjlsqv"><di:waypoint x="1490" y="280" /><di:waypoint x="1490" y="320" /></bpmndi:BPMNEdge><bpmndi:BPMNEdge id="Flow_12b9dh0_di" bpmnElement="Flow_12b9dh0"><di:waypoint x="1490" y="1060" /><di:waypoint x="1490" y="1110" /></bpmndi:BPMNEdge><bpmndi:BPMNEdge id="Flow_1qji0wp_di" bpmnElement="Flow_1qji0wp"><di:waypoint x="4100" y="120" /><di:waypoint x="4150" y="120" /></bpmndi:BPMNEdge><bpmndi:BPMNEdge id="Flow_0bfnahk_di" bpmnElement="Flow_0bfnahk"><di:waypoint x="2470" y="510" /><di:waypoint x="2470" y="770" /></bpmndi:BPMNEdge><bpmndi:BPMNEdge id="Flow_0hoftp4_di" bpmnElement="Flow_0hoftp4"><di:waypoint x="2270" y="520" /><di:waypoint x="2270" y="560" /></bpmndi:BPMNEdge><bpmndi:BPMNEdge id="Flow_0tsnb5y_di" bpmnElement="Flow_0tsnb5y"><di:waypoint x="1880" y="520" /><di:waypoint x="1880" y="600" /></bpmndi:BPMNEdge><bpmndi:BPMNEdge id="Flow_18klgis_di" bpmnElement="Flow_18klgis"><di:waypoint x="1490" y="1190" /><di:waypoint x="1490" y="1280" /></bpmndi:BPMNEdge><bpmndi:BPMNEdge id="Flow_1u5wzp2_di" bpmnElement="Flow_1u5wzp2"><di:waypoint x="1170" y="530" /><di:waypoint x="1170" y="620" /></bpmndi:BPMNEdge><bpmndi:BPMNEdge id="Flow_0l1msdm_di" bpmnElement="Flow_0l1msdm"><di:waypoint x="730" y="380" /><di:waypoint x="730" y="400" /></bpmndi:BPMNEdge><bpmndi:BPMNEdge id="Flow_17gh0x8_di" bpmnElement="Flow_17gh0x8"><di:waypoint x="1760" y="685" /><di:waypoint x="1760" y="900" /><di:waypoint x="1540" y="900" /><bpmndi:BPMNLabel><dc:Bounds x="1692" y="856" width="55" height="27" /></bpmndi:BPMNLabel></bpmndi:BPMNEdge><bpmndi:BPMNEdge id="Flow_1xwkqvn_di" bpmnElement="Flow_1xwkqvn"><di:waypoint x="1760" y="635" /><di:waypoint x="1760" y="160" /><bpmndi:BPMNLabel><dc:Bounds x="1685" y="389" width="71" height="40" /></bpmndi:BPMNLabel></bpmndi:BPMNEdge><bpmndi:BPMNEdge id="Flow_0vvxx4v_di" bpmnElement="Flow_0vvxx4v"><di:waypoint x="1515" y="660" /><di:waypoint x="1570" y="660" /><bpmndi:BPMNLabel><dc:Bounds x="1512" y="633" width="55" height="14" /></bpmndi:BPMNLabel></bpmndi:BPMNEdge><bpmndi:BPMNEdge id="Flow_07ax021_di" bpmnElement="Flow_07ax021"><di:waypoint x="1670" y="660" /><di:waypoint x="1735" y="660" /></bpmndi:BPMNEdge><bpmndi:BPMNEdge id="Flow_0ndx1bh_di" bpmnElement="Flow_0ndx1bh"><di:waypoint x="1490" y="685" /><di:waypoint x="1490" y="860" /><bpmndi:BPMNLabel><dc:Bounds x="1470" y="773" width="70" height="14" /></bpmndi:BPMNLabel></bpmndi:BPMNEdge><bpmndi:BPMNEdge id="Flow_03llxxq_di" bpmnElement="Flow_03llxxq"><di:waypoint x="1490" y="570" /><di:waypoint x="1490" y="635" /></bpmndi:BPMNEdge><bpmndi:BPMNEdge id="Flow_17b7rep_di" bpmnElement="Flow_17b7rep"><di:waypoint x="3640" y="120" /><di:waypoint x="3690" y="120" /></bpmndi:BPMNEdge><bpmndi:BPMNEdge id="Flow_1cagmnf_di" bpmnElement="Flow_1cagmnf"><di:waypoint x="935" y="120" /><di:waypoint x="1120" y="120" /></bpmndi:BPMNEdge><bpmndi:BPMNEdge id="Flow_17j4r8b_di" bpmnElement="Flow_17j4r8b"><di:waypoint x="1030" y="265" /><di:waypoint x="1030" y="360" /><di:waypoint x="1120" y="360" /></bpmndi:BPMNEdge><bpmndi:BPMNEdge id="Flow_0cie6ym_di" bpmnElement="Flow_0cie6ym"><di:waypoint x="1055" y="240" /><di:waypoint x="1145" y="240" /></bpmndi:BPMNEdge><bpmndi:BPMNEdge id="Flow_1s43g4n_di" bpmnElement="Flow_1s43g4n"><di:waypoint x="1220" y="120" /><di:waypoint x="1320" y="120" /></bpmndi:BPMNEdge><bpmndi:BPMNEdge id="Flow_017wng7_di" bpmnElement="Flow_017wng7"><di:waypoint x="1170" y="215" /><di:waypoint x="1170" y="160" /></bpmndi:BPMNEdge><bpmndi:BPMNEdge id="Flow_0ochgeq_di" bpmnElement="Flow_0ochgeq"><di:waypoint x="1170" y="265" /><di:waypoint x="1170" y="320" /></bpmndi:BPMNEdge><bpmndi:BPMNEdge id="Flow_1twzvby_di" bpmnElement="Flow_1twzvby"><di:waypoint x="960" y="240" /><di:waypoint x="1005" y="240" /></bpmndi:BPMNEdge><bpmndi:BPMNEdge id="Flow_0wtm8tq_di" bpmnElement="Flow_0wtm8tq"><di:waypoint x="910" y="145" /><di:waypoint x="910" y="200" /><bpmndi:BPMNLabel><dc:Bounds x="909" y="150" width="82" height="40" /></bpmndi:BPMNLabel></bpmndi:BPMNEdge><bpmndi:BPMNEdge id="Flow_1r2h58q_di" bpmnElement="Flow_1r2h58q"><di:waypoint x="1170" y="400" /><di:waypoint x="1170" y="450" /></bpmndi:BPMNEdge><bpmndi:BPMNEdge id="Flow_1ingrqu_di" bpmnElement="Flow_1ingrqu"><di:waypoint x="1170" y="820" /><di:waypoint x="1170" y="862" /></bpmndi:BPMNEdge><bpmndi:BPMNEdge id="Flow_1uu33o9_di" bpmnElement="Flow_1uu33o9"><di:waypoint x="1170" y="700" /><di:waypoint x="1170" y="740" /></bpmndi:BPMNEdge><bpmndi:BPMNEdge id="Flow_1uqylzo_di" bpmnElement="Flow_1uqylzo"><di:waypoint x="755" y="120" /><di:waypoint x="885" y="120" /></bpmndi:BPMNEdge><bpmndi:BPMNEdge id="Flow_0t4255l_di" bpmnElement="Flow_0t4255l"><di:waypoint x="490" y="120" /><di:waypoint x="520" y="120" /></bpmndi:BPMNEdge><bpmndi:BPMNEdge id="Flow_0rwrk3c_di" bpmnElement="Flow_0rwrk3c"><di:waypoint x="730" y="580" /><di:waypoint x="730" y="622" /></bpmndi:BPMNEdge><bpmndi:BPMNEdge id="Flow_1jw0p2g_di" bpmnElement="Flow_1jw0p2g"><di:waypoint x="730" y="480" /><di:waypoint x="730" y="500" /></bpmndi:BPMNEdge><bpmndi:BPMNEdge id="Flow_073vw9e_di" bpmnElement="Flow_073vw9e"><di:waypoint x="730" y="280" /><di:waypoint x="730" y="300" /></bpmndi:BPMNEdge><bpmndi:BPMNEdge id="Flow_1gfw6vl_di" bpmnElement="Flow_1gfw6vl"><di:waypoint x="730" y="145" /><di:waypoint x="730" y="200" /><bpmndi:BPMNLabel><dc:Bounds x="742" y="156" width="55" height="27" /></bpmndi:BPMNLabel></bpmndi:BPMNEdge><bpmndi:BPMNEdge id="Flow_0b5e4bd_di" bpmnElement="Flow_0b5e4bd"><di:waypoint x="620" y="120" /><di:waypoint x="705" y="120" /></bpmndi:BPMNEdge><bpmndi:BPMNEdge id="Flow_07zf7yf_di" bpmnElement="Flow_07zf7yf"><di:waypoint x="2270" y="145" /><di:waypoint x="2270" y="200" /><bpmndi:BPMNLabel><dc:Bounds x="2285" y="170" width="70" height="14" /></bpmndi:BPMNLabel></bpmndi:BPMNEdge><bpmndi:BPMNEdge id="Flow_0j3fnpv_di" bpmnElement="Flow_0j3fnpv"><di:waypoint x="2270" y="640" /><di:waypoint x="2270" y="682" /></bpmndi:BPMNEdge><bpmndi:BPMNEdge id="Flow_1buxbit_di" bpmnElement="Flow_1buxbit"><di:waypoint x="2270" y="400" /><di:waypoint x="2270" y="440" /></bpmndi:BPMNEdge><bpmndi:BPMNEdge id="Flow_0rxrjdp_di" bpmnElement="Flow_0rxrjdp"><di:waypoint x="2270" y="280" /><di:waypoint x="2270" y="320" /></bpmndi:BPMNEdge><bpmndi:BPMNEdge id="Flow_0hedayr_di" bpmnElement="Flow_0hedayr"><di:waypoint x="2295" y="120" /><di:waypoint x="2445" y="120" /></bpmndi:BPMNEdge><bpmndi:BPMNEdge id="Flow_11q0rn1_di" bpmnElement="Flow_11q0rn1"><di:waypoint x="350" y="120" /><di:waypoint x="390" y="120" /></bpmndi:BPMNEdge><bpmndi:BPMNEdge id="Flow_0i0vkl4_di" bpmnElement="Flow_0i0vkl4"><di:waypoint x="3940" y="120" /><di:waypoint x="4000" y="120" /></bpmndi:BPMNEdge><bpmndi:BPMNEdge id="Flow_17a5k4x_di" bpmnElement="Flow_17a5k4x"><di:waypoint x="2190" y="120" /><di:waypoint x="2245" y="120" /></bpmndi:BPMNEdge><bpmndi:BPMNEdge id="Flow_10xo2s5_di" bpmnElement="Flow_10xo2s5"><di:waypoint x="1880" y="145" /><di:waypoint x="1880" y="200" /><bpmndi:BPMNLabel><dc:Bounds x="1814" y="163" width="71" height="27" /></bpmndi:BPMNLabel></bpmndi:BPMNEdge><bpmndi:BPMNEdge id="Flow_1dgg3a8_di" bpmnElement="Flow_1dgg3a8"><di:waypoint x="1880" y="680" /><di:waypoint x="1880" y="722" /></bpmndi:BPMNEdge><bpmndi:BPMNEdge id="Flow_0rhrob7_di" bpmnElement="Flow_0rhrob7"><di:waypoint x="1880" y="400" /><di:waypoint x="1880" y="440" /></bpmndi:BPMNEdge><bpmndi:BPMNEdge id="Flow_065ob8i_di" bpmnElement="Flow_065ob8i"><di:waypoint x="1880" y="280" /><di:waypoint x="1880" y="320" /></bpmndi:BPMNEdge><bpmndi:BPMNEdge id="Flow_196f9ic_di" bpmnElement="Flow_196f9ic"><di:waypoint x="1905" y="120" /><di:waypoint x="2005" y="120" /></bpmndi:BPMNEdge><bpmndi:BPMNEdge id="Flow_02wig0e_di" bpmnElement="Flow_02wig0e"><di:waypoint x="2470" y="145" /><di:waypoint x="2470" y="200" /><bpmndi:BPMNLabel><dc:Bounds x="2487" y="170" width="66" height="14" /></bpmndi:BPMNLabel></bpmndi:BPMNEdge><bpmndi:BPMNEdge id="Flow_0hu2vww_di" bpmnElement="Flow_0hu2vww"><di:waypoint x="2470" y="850" /><di:waypoint x="2470" y="922" /></bpmndi:BPMNEdge><bpmndi:BPMNEdge id="Flow_0nbwbqo_di" bpmnElement="Flow_0nbwbqo"><di:waypoint x="2470" y="400" /><di:waypoint x="2470" y="430" /></bpmndi:BPMNEdge><bpmndi:BPMNEdge id="Flow_057sqy4_di" bpmnElement="Flow_057sqy4"><di:waypoint x="2470" y="280" /><di:waypoint x="2470" y="320" /></bpmndi:BPMNEdge><bpmndi:BPMNEdge id="Flow_0szg7pi_di" bpmnElement="Flow_0szg7pi"><di:waypoint x="1490" y="1360" /><di:waypoint x="1490" y="1412" /></bpmndi:BPMNEdge><bpmndi:BPMNEdge id="Flow_1a2g4c7_di" bpmnElement="Flow_1a2g4c7"><di:waypoint x="1490" y="940" /><di:waypoint x="1490" y="980" /></bpmndi:BPMNEdge><bpmndi:BPMNEdge id="Flow_06sa7q7_di" bpmnElement="Flow_06sa7q7"><di:waypoint x="1490" y="145" /><di:waypoint x="1490" y="200" /><bpmndi:BPMNLabel><dc:Bounds x="1492" y="159" width="55" height="27" /></bpmndi:BPMNLabel></bpmndi:BPMNEdge><bpmndi:BPMNEdge id="Flow_04meod7_di" bpmnElement="Flow_04meod7"><di:waypoint x="2820" y="120" /><di:waypoint x="2890" y="120" /></bpmndi:BPMNEdge><bpmndi:BPMNEdge id="Flow_0swut6m_di" bpmnElement="Flow_0swut6m"><di:waypoint x="2495" y="120" /><di:waypoint x="2570" y="120" /></bpmndi:BPMNEdge><bpmndi:BPMNEdge id="Flow_10zjoi8_di" bpmnElement="Flow_10zjoi8"><di:waypoint x="4250" y="120" /><di:waypoint x="4302" y="120" /></bpmndi:BPMNEdge><bpmndi:BPMNEdge id="Flow_17r224g_di" bpmnElement="Flow_17r224g"><di:waypoint x="3790" y="120" /><di:waypoint x="3840" y="120" /></bpmndi:BPMNEdge><bpmndi:BPMNEdge id="Flow_03w6pmh_di" bpmnElement="Flow_03w6pmh"><di:waypoint x="3450" y="120" /><di:waypoint x="3540" y="120" /></bpmndi:BPMNEdge><bpmndi:BPMNEdge id="Flow_00zlj53_di" bpmnElement="Flow_00zlj53"><di:waypoint x="2670" y="120" /><di:waypoint x="2720" y="120" /></bpmndi:BPMNEdge><bpmndi:BPMNEdge id="Flow_0bj1465_di" bpmnElement="Flow_0bj1465"><di:waypoint x="3130" y="145" /><di:waypoint x="3130" y="260" /><di:waypoint x="3200" y="260" /></bpmndi:BPMNEdge><bpmndi:BPMNEdge id="Flow_0aqrffm_di" bpmnElement="Flow_0aqrffm"><di:waypoint x="2990" y="120" /><di:waypoint x="3105" y="120" /></bpmndi:BPMNEdge><bpmndi:BPMNEdge id="Flow_1trtmgk_di" bpmnElement="Flow_1trtmgk"><di:waypoint x="3300" y="120" /><di:waypoint x="3350" y="120" /></bpmndi:BPMNEdge><bpmndi:BPMNEdge id="Flow_0b7o2rd_di" bpmnElement="Flow_0b7o2rd"><di:waypoint x="3250" y="220" /><di:waypoint x="3250" y="160" /></bpmndi:BPMNEdge><bpmndi:BPMNEdge id="Flow_1bz70bg_di" bpmnElement="Flow_1bz70bg"><di:waypoint x="3155" y="120" /><di:waypoint x="3200" y="120" /></bpmndi:BPMNEdge><bpmndi:BPMNEdge id="Flow_1bfstw1_di" bpmnElement="Flow_1bfstw1"><di:waypoint x="1810" y="120" /><di:waypoint x="1855" y="120" /></bpmndi:BPMNEdge><bpmndi:BPMNEdge id="Flow_1fuhu56_di" bpmnElement="Flow_1fuhu56"><di:waypoint x="188" y="120" /><di:waypoint x="250" y="120" /></bpmndi:BPMNEdge><bpmndi:BPMNEdge id="Flow_13jr3ef_di" bpmnElement="Flow_13jr3ef"><di:waypoint x="1515" y="120" /><di:waypoint x="1710" y="120" /></bpmndi:BPMNEdge><bpmndi:BPMNEdge id="Flow_1yf8jcb_di" bpmnElement="Flow_1yf8jcb"><di:waypoint x="1420" y="120" /><di:waypoint x="1465" y="120" /></bpmndi:BPMNEdge><bpmndi:BPMNShape id="_BPMNShape_StartEvent_2" bpmnElement="StartEvent_1"><dc:Bounds x="152" y="102" width="36" height="36" /></bpmndi:BPMNShape><bpmndi:BPMNShape id="Activity_0sqnh1c_di" bpmnElement="Activity_0sqnh1c"><dc:Bounds x="390" y="80" width="100" height="80" /></bpmndi:BPMNShape><bpmndi:BPMNShape id="Activity_08jdouv_di" bpmnElement="Activity_08jdouv"><dc:Bounds x="1320" y="80" width="100" height="80" /></bpmndi:BPMNShape><bpmndi:BPMNShape id="Gateway_1irgztq_di" bpmnElement="Gateway_1irgztq" isMarkerVisible="true"><dc:Bounds x="1465" y="95" width="50" height="50" /></bpmndi:BPMNShape><bpmndi:BPMNShape id="Activity_1wfpugf_di" bpmnElement="Activity_1wfpugf"><dc:Bounds x="1710" y="80" width="100" height="80" /></bpmndi:BPMNShape><bpmndi:BPMNShape id="Activity_15tjqx0_di" bpmnElement="Activity_15tjqx0"><dc:Bounds x="3200" y="80" width="100" height="80" /></bpmndi:BPMNShape><bpmndi:BPMNShape id="Activity_0rxw1ho_di" bpmnElement="Activity_0rxw1ho"><dc:Bounds x="3350" y="80" width="100" height="80" /></bpmndi:BPMNShape><bpmndi:BPMNShape id="Activity_1839i3u_di" bpmnElement="Activity_1839i3u"><dc:Bounds x="2890" y="80" width="100" height="80" /></bpmndi:BPMNShape><bpmndi:BPMNShape id="Gateway_18sbfc0_di" bpmnElement="Gateway_18sbfc0" isMarkerVisible="true"><dc:Bounds x="3105" y="95" width="50" height="50" /></bpmndi:BPMNShape><bpmndi:BPMNShape id="Activity_0p5mh2m_di" bpmnElement="Activity_0p5mh2m"><dc:Bounds x="3200" y="220" width="100" height="80" /></bpmndi:BPMNShape><bpmndi:BPMNShape id="Activity_1qzjugx_di" bpmnElement="Activity_1qzjugx" bioc:stroke="rgb(142, 36, 170)" bioc:fill="rgb(225, 190, 231)"><dc:Bounds x="3690" y="80" width="100" height="80" /></bpmndi:BPMNShape><bpmndi:BPMNShape id="Activity_1cjrfpn_di" bpmnElement="Activity_1cjrfpn"><dc:Bounds x="2570" y="80" width="100" height="80" /></bpmndi:BPMNShape><bpmndi:BPMNShape id="Activity_0eir13n_di" bpmnElement="Activity_0eir13n"><dc:Bounds x="4150" y="80" width="100" height="80" /></bpmndi:BPMNShape><bpmndi:BPMNShape id="Event_0rtuz4z_di" bpmnElement="Event_0rtuz4z"><dc:Bounds x="4302" y="102" width="36" height="36" /></bpmndi:BPMNShape><bpmndi:BPMNShape id="Gateway_010ppfy_di" bpmnElement="Gateway_010ppfy" isMarkerVisible="true"><dc:Bounds x="2445" y="95" width="50" height="50" /></bpmndi:BPMNShape><bpmndi:BPMNShape id="Activity_16kibf9_di" bpmnElement="Activity_16kibf9"><dc:Bounds x="2720" y="80" width="100" height="80" /></bpmndi:BPMNShape><bpmndi:BPMNShape id="Activity_08factb_di" bpmnElement="Activity_08factb"><dc:Bounds x="1440" y="980" width="100" height="80" /></bpmndi:BPMNShape><bpmndi:BPMNShape id="Event_0v40lyu_di" bpmnElement="Event_0v40lyu"><dc:Bounds x="1472" y="1412" width="36" height="36" /></bpmndi:BPMNShape><bpmndi:BPMNShape id="Activity_1mjr46s_di" bpmnElement="Activity_1mjr46s"><dc:Bounds x="1440" y="860" width="100" height="80" /></bpmndi:BPMNShape><bpmndi:BPMNShape id="Activity_0fyvm6x_di" bpmnElement="Activity_0fyvm6x"><dc:Bounds x="1440" y="1280" width="100" height="80" /></bpmndi:BPMNShape><bpmndi:BPMNShape id="Activity_0v831cg_di" bpmnElement="Activity_0v831cg"><dc:Bounds x="2420" y="320" width="100" height="80" /></bpmndi:BPMNShape><bpmndi:BPMNShape id="Event_0w2j8nd_di" bpmnElement="Event_0w2j8nd"><dc:Bounds x="2452" y="922" width="36" height="36" /></bpmndi:BPMNShape><bpmndi:BPMNShape id="Activity_0kwpg98_di" bpmnElement="Activity_0kwpg98"><dc:Bounds x="2420" y="200" width="100" height="80" /></bpmndi:BPMNShape><bpmndi:BPMNShape id="Activity_1s57wdl_di" bpmnElement="Activity_1s57wdl"><dc:Bounds x="2420" y="770" width="100" height="80" /></bpmndi:BPMNShape><bpmndi:BPMNShape id="Gateway_03dq40m_di" bpmnElement="Gateway_03dq40m" isMarkerVisible="true"><dc:Bounds x="1855" y="95" width="50" height="50" /></bpmndi:BPMNShape><bpmndi:BPMNShape id="Activity_0tqs7br_di" bpmnElement="Activity_0tqs7br"><dc:Bounds x="1830" y="320" width="100" height="80" /></bpmndi:BPMNShape><bpmndi:BPMNShape id="Event_1l5ghhr_di" bpmnElement="Event_1l5ghhr"><dc:Bounds x="1862" y="722" width="36" height="36" /></bpmndi:BPMNShape><bpmndi:BPMNShape id="Activity_1r70rkw_di" bpmnElement="Activity_1r70rkw"><dc:Bounds x="1830" y="200" width="100" height="80" /></bpmndi:BPMNShape><bpmndi:BPMNShape id="Activity_1a2yrap_di" bpmnElement="Activity_1a2yrap"><dc:Bounds x="1830" y="600" width="100" height="80" /></bpmndi:BPMNShape><bpmndi:BPMNShape id="Activity_1mfxf7u_di" bpmnElement="Activity_1mfxf7u"><dc:Bounds x="2090" y="80" width="100" height="80" /></bpmndi:BPMNShape><bpmndi:BPMNShape id="Activity_04e1yma_di" bpmnElement="Activity_04e1yma"><dc:Bounds x="3840" y="80" width="100" height="80" /></bpmndi:BPMNShape><bpmndi:BPMNShape id="Activity_1xdcgfq_di" bpmnElement="Activity_1xdcgfq"><dc:Bounds x="250" y="80" width="100" height="80" /></bpmndi:BPMNShape><bpmndi:BPMNShape id="Gateway_1x0ggt7_di" bpmnElement="Gateway_1x0ggt7" isMarkerVisible="true"><dc:Bounds x="2245" y="95" width="50" height="50" /></bpmndi:BPMNShape><bpmndi:BPMNShape id="Activity_0tcpisn_di" bpmnElement="Activity_0tcpisn"><dc:Bounds x="2220" y="200" width="100" height="80" /></bpmndi:BPMNShape><bpmndi:BPMNShape id="Activity_0863e20_di" bpmnElement="Activity_0863e20"><dc:Bounds x="2220" y="320" width="100" height="80" /></bpmndi:BPMNShape><bpmndi:BPMNShape id="Activity_026riex_di" bpmnElement="Activity_026riex"><dc:Bounds x="2220" y="560" width="100" height="80" /></bpmndi:BPMNShape><bpmndi:BPMNShape id="Event_0dcqvpn_di" bpmnElement="Event_0dcqvpn"><dc:Bounds x="2252" y="682" width="36" height="36" /></bpmndi:BPMNShape><bpmndi:BPMNShape id="Activity_06r7jiu_di" bpmnElement="Activity_06r7jiu"><dc:Bounds x="520" y="80" width="100" height="80" /></bpmndi:BPMNShape><bpmndi:BPMNShape id="Gateway_0dg4rlu_di" bpmnElement="Gateway_0dg4rlu" isMarkerVisible="true"><dc:Bounds x="705" y="95" width="50" height="50" /></bpmndi:BPMNShape><bpmndi:BPMNShape id="Activity_12w1g3x_di" bpmnElement="Activity_12w1g3x"><dc:Bounds x="680" y="200" width="100" height="80" /></bpmndi:BPMNShape><bpmndi:BPMNShape id="Activity_0mn355m_di" bpmnElement="Activity_0mn355m"><dc:Bounds x="680" y="400" width="100" height="80" /></bpmndi:BPMNShape><bpmndi:BPMNShape id="Activity_1hl3l31_di" bpmnElement="Activity_1hl3l31"><dc:Bounds x="680" y="500" width="100" height="80" /></bpmndi:BPMNShape><bpmndi:BPMNShape id="Event_1i0hj0d_di" bpmnElement="Event_1i0hj0d"><dc:Bounds x="712" y="622" width="36" height="36" /></bpmndi:BPMNShape><bpmndi:BPMNShape id="Gateway_0741lfn_di" bpmnElement="Gateway_0741lfn" isMarkerVisible="true"><dc:Bounds x="885" y="95" width="50" height="50" /></bpmndi:BPMNShape><bpmndi:BPMNShape id="Activity_0qme0ka_di" bpmnElement="Activity_0qme0ka"><dc:Bounds x="1120" y="740" width="100" height="80" /></bpmndi:BPMNShape><bpmndi:BPMNShape id="Event_0zqsue4_di" bpmnElement="Event_0zqsue4"><dc:Bounds x="1152" y="862" width="36" height="36" /></bpmndi:BPMNShape><bpmndi:BPMNShape id="Activity_0a824wv_di" bpmnElement="Activity_0a824wv"><dc:Bounds x="1120" y="320" width="100" height="80" /></bpmndi:BPMNShape><bpmndi:BPMNShape id="Activity_0roflre_di" bpmnElement="Activity_0roflre"><dc:Bounds x="1120" y="620" width="100" height="80" /></bpmndi:BPMNShape><bpmndi:BPMNShape id="Activity_08g1rg6_di" bpmnElement="Activity_08g1rg6"><dc:Bounds x="860" y="200" width="100" height="80" /></bpmndi:BPMNShape><bpmndi:BPMNShape id="Gateway_0ogh2rb_di" bpmnElement="Gateway_0ogh2rb" isMarkerVisible="true"><dc:Bounds x="1145" y="215" width="50" height="50" /></bpmndi:BPMNShape><bpmndi:BPMNShape id="Activity_052kjbn_di" bpmnElement="Activity_052kjbn"><dc:Bounds x="1120" y="80" width="100" height="80" /></bpmndi:BPMNShape><bpmndi:BPMNShape id="Gateway_02bv1e0_di" bpmnElement="Gateway_02bv1e0" isMarkerVisible="true"><dc:Bounds x="1005" y="215" width="50" height="50" /></bpmndi:BPMNShape><bpmndi:BPMNShape id="Activity_02w0ta4_di" bpmnElement="Activity_02w0ta4" bioc:stroke="rgb(67, 160, 71)" bioc:fill="rgb(200, 230, 201)"><dc:Bounds x="1730" y="940" width="100" height="80" /></bpmndi:BPMNShape><bpmndi:BPMNShape id="Activity_0z96jix_di" bpmnElement="Activity_0z96jix" bioc:stroke="rgb(142, 36, 170)" bioc:fill="rgb(225, 190, 231)"><dc:Bounds x="3540" y="80" width="100" height="80" /></bpmndi:BPMNShape><bpmndi:BPMNShape id="Activity_0098u0b_di" bpmnElement="Activity_0098u0b" bioc:stroke="rgb(229, 57, 53)" bioc:fill="rgb(255, 205, 210)"><dc:Bounds x="1440" y="490" width="100" height="80" /></bpmndi:BPMNShape><bpmndi:BPMNShape id="Gateway_1lygg0k_di" bpmnElement="Gateway_1lygg0k" isMarkerVisible="true"><dc:Bounds x="1465" y="635" width="50" height="50" /></bpmndi:BPMNShape><bpmndi:BPMNShape id="Activity_1qxko1a_di" bpmnElement="Activity_1qxko1a"><dc:Bounds x="1570" y="620" width="100" height="80" /></bpmndi:BPMNShape><bpmndi:BPMNShape id="Gateway_1riqey3_di" bpmnElement="Gateway_1riqey3" isMarkerVisible="true"><dc:Bounds x="1735" y="635" width="50" height="50" /></bpmndi:BPMNShape><bpmndi:BPMNShape id="Activity_1fibfpu_di" bpmnElement="Activity_1fibfpu"><dc:Bounds x="680" y="300" width="100" height="80" /></bpmndi:BPMNShape><bpmndi:BPMNShape id="Activity_1ioqudu_di" bpmnElement="Activity_1ioqudu"><dc:Bounds x="1120" y="450" width="100" height="80" /></bpmndi:BPMNShape><bpmndi:BPMNShape id="Activity_0p2rd71_di" bpmnElement="Activity_0p2rd71"><dc:Bounds x="1440" y="1110" width="100" height="80" /></bpmndi:BPMNShape><bpmndi:BPMNShape id="Activity_0lik84h_di" bpmnElement="Activity_0lik84h"><dc:Bounds x="1830" y="440" width="100" height="80" /></bpmndi:BPMNShape><bpmndi:BPMNShape id="Activity_0x92fnj_di" bpmnElement="Activity_0x92fnj"><dc:Bounds x="2220" y="440" width="100" height="80" /></bpmndi:BPMNShape><bpmndi:BPMNShape id="Activity_0n3hzb9_di" bpmnElement="Activity_0n3hzb9"><dc:Bounds x="2420" y="430" width="100" height="80" /></bpmndi:BPMNShape><bpmndi:BPMNShape id="Activity_131qv8p_di" bpmnElement="Activity_131qv8p" bioc:stroke="rgb(229, 57, 53)" bioc:fill="rgb(255, 205, 210)"><dc:Bounds x="1440" y="200" width="100" height="80" /></bpmndi:BPMNShape><bpmndi:BPMNShape id="Activity_11g05ia_di" bpmnElement="Activity_11g05ia"><dc:Bounds x="4000" y="80" width="100" height="80" /></bpmndi:BPMNShape><bpmndi:BPMNShape id="Activity_0oxf5j6_di" bpmnElement="Activity_0oxf5j6" bioc:stroke="rgb(67, 160, 71)" bioc:fill="rgb(200, 230, 201)"><dc:Bounds x="2670" y="620" width="100" height="80" /></bpmndi:BPMNShape><bpmndi:BPMNShape id="Gateway_0393efy_di" bpmnElement="Gateway_12znkgj" isMarkerVisible="true"><dc:Bounds x="2005" y="95" width="50" height="50" /></bpmndi:BPMNShape><bpmndi:BPMNShape id="Activity_0hbc0i1_di" bpmnElement="Activity_0hbc0i1"><dc:Bounds x="1980" y="320" width="100" height="80" /></bpmndi:BPMNShape><bpmndi:BPMNShape id="Event_1bf1ba7_di" bpmnElement="Event_1bf1ba7"><dc:Bounds x="2012" y="722" width="36" height="36" /></bpmndi:BPMNShape><bpmndi:BPMNShape id="Activity_0qwcfxo_di" bpmnElement="Activity_0qwcfxo"><dc:Bounds x="1980" y="200" width="100" height="80" /></bpmndi:BPMNShape><bpmndi:BPMNShape id="Activity_0mllv4y_di" bpmnElement="Activity_0mllv4y"><dc:Bounds x="1980" y="600" width="100" height="80" /></bpmndi:BPMNShape><bpmndi:BPMNShape id="Activity_0x8747s_di" bpmnElement="Activity_0x8747s"><dc:Bounds x="1980" y="440" width="100" height="80" /></bpmndi:BPMNShape><bpmndi:BPMNShape id="Activity_1tenab0_di" bpmnElement="Activity_1tenab0" bioc:stroke="rgb(229, 57, 53)" bioc:fill="rgb(255, 205, 210)"><dc:Bounds x="1440" y="320" width="100" height="80" /></bpmndi:BPMNShape></bpmndi:BPMNPlane></bpmndi:BPMNDiagram></bpmn:definitions>