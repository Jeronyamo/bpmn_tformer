<?xml version="1.0" encoding="UTF-8"?>
<bpmn:definitions xmlns:bpmn="http://www.omg.org/spec/BPMN/20100524/MODEL" xmlns:bpmndi="http://www.omg.org/spec/BPMN/20100524/DI" xmlns:camunda="http://camunda.org/schema/1.0/bpmn" xmlns:dc="http://www.omg.org/spec/DD/20100524/DC" xmlns:di="http://www.omg.org/spec/DD/20100524/DI" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:bioc="http://bpmn.io/schema/bpmn/biocolor/1.0" id="Definitions_1" targetNamespace="http://bpmn.io/schema/bpmn" exporter="Camunda Modeler" exporterVersion="4.8.1"><bpmn:process id="TEMPLATE_INSTANCE_PROCESS_hlk_app_sms_59354641-a121-4bd0-a570-54efa91bb4ec" name="SMS оповещение.Подключение клиента" isExecutable="true"><bpmn:documentation /><bpmn:startEvent id="StartEvent_1"><bpmn:outgoing>SequenceFlow_0or7jn6</bpmn:outgoing></bpmn:startEvent><bpmn:endEvent id="EndEvent_0djl7a3"><bpmn:incoming>SequenceFlow_143ap96</bpmn:incoming></bpmn:endEvent><bpmn:userTask id="Task_0micukk" name="Заполнение заявки на добавление SMS услуги" camunda:formKey="FILL" camunda:candidateGroups="cb_directordp, cb_clientmanager, cb_accessadmin, cb_backoffice, jira-users"><bpmn:extensionElements><camunda:properties><camunda:property name="isEzdocTask" value="true" /><camunda:property name="ezdocTaskType" value="fillverify" /></camunda:properties><camunda:formData><camunda:formField id="ezdocObjectUrl" type="string" /><camunda:formField id="ezdocObjectEditorUrl" type="string" /><camunda:formField id="hlk_client_app" label="Клиент" type="string" /><camunda:formField id="hlk_mobile_phone" label="Мобильный телефон" type="string" /></camunda:formData><camunda:taskListener event="create"><camunda:script scriptFormat="javascript">try {
              var formData = task.execution.processEngineServices.formService.getTaskFormData(task.id);
              var data = {};
              data.taskId = task.id;
data.templateId = templateId;
data.formKey = formData.formKey;
              var formFields = [];
              formData.formFields.forEach(function (a) {formFields.push(a.id)});
              data.formFields = formFields;

              httpPost(ezdocUrl + "/api/camunda/common/taskNotify?type=" + type + "&amp;instanceId=" + instanceId, JSON.stringify(data));
              }
              catch(error) {}

              /*************
              UTILITY FUNCTIONS
              *************/
              function httpPost(e,t,n){n=n||"application/json;charset=UTF-8";var a=new java.net.URL(e).openConnection();return a.requestMethod="POST",a.setRequestProperty("Content-Type",n),a.setRequestProperty("Accept-Charset", "UTF-8"),a.doOutput=!0,write(a.outputStream,t),asResponse(a)}function asResponse(e){return{data:read(e.inputStream),statusCode:e.responseCode}}function write(e,t){var n=new java.io.DataOutputStream(e);n.writeChars(t),n.flush(),n.close()}function read(e){for(var t,n=new java.io.BufferedReader(new java.io.InputStreamReader(e)),a=new java.lang.StringBuffer;null!=(t=n.readLine());)a.append(t);return n.close(),a.toString()}</camunda:script></camunda:taskListener></bpmn:extensionElements><bpmn:incoming>SequenceFlow_1elj596</bpmn:incoming><bpmn:incoming>SequenceFlow_045y2r2</bpmn:incoming><bpmn:incoming>Flow_0ognha1</bpmn:incoming><bpmn:incoming>Flow_1wlvudv</bpmn:incoming><bpmn:outgoing>SequenceFlow_1xbx4u7</bpmn:outgoing></bpmn:userTask><bpmn:sequenceFlow id="SequenceFlow_0or7jn6" sourceRef="StartEvent_1" targetRef="Activity_12gmm1b" /><bpmn:serviceTask id="ServiceTask_18devms" name="Установка статуса &#34;Заполнение заявки&#34;"><bpmn:extensionElements><camunda:properties><camunda:property name="isEzdocServiceTask" value="true" /><camunda:property name="ezdocServiceTaskType" value="request" /><camunda:property name="requestType" value="GENERIC" /></camunda:properties><camunda:connector><camunda:inputOutput><camunda:inputParameter name="headers"><camunda:map><camunda:entry key="Accept">*/*</camunda:entry><camunda:entry key="Content-Type">application/json</camunda:entry></camunda:map></camunda:inputParameter><camunda:inputParameter name="url">${ezdocUrl}/api/camunda/instance/book/saveLabel/${instanceId}?label=Заполнение+заявки</camunda:inputParameter><camunda:inputParameter name="method">POST</camunda:inputParameter></camunda:inputOutput><camunda:connectorId>http-connector</camunda:connectorId></camunda:connector></bpmn:extensionElements><bpmn:incoming>SequenceFlow_0bwyp8d</bpmn:incoming><bpmn:incoming>SequenceFlow_0huja8w</bpmn:incoming><bpmn:incoming>SequenceFlow_1gvxnaj</bpmn:incoming><bpmn:outgoing>SequenceFlow_0z4k2fn</bpmn:outgoing></bpmn:serviceTask><bpmn:sequenceFlow id="SequenceFlow_0z4k2fn" sourceRef="ServiceTask_18devms" targetRef="Gateway_06idv35" /><bpmn:serviceTask id="ServiceTask_0q99htm" name="Установка статуса &#34;Зарегистрирована&#34;"><bpmn:extensionElements><camunda:properties><camunda:property name="isEzdocServiceTask" value="true" /><camunda:property name="ezdocServiceTaskType" value="request" /><camunda:property name="requestType" value="GENERIC" /></camunda:properties><camunda:connector><camunda:inputOutput><camunda:inputParameter name="headers"><camunda:map><camunda:entry key="Accept">*/*</camunda:entry><camunda:entry key="Content-Type">application/json</camunda:entry></camunda:map></camunda:inputParameter><camunda:inputParameter name="url">${ezdocUrl}/api/camunda/instance/book/saveLabel/${instanceId}?label=Зарегистрирована</camunda:inputParameter><camunda:inputParameter name="method">POST</camunda:inputParameter></camunda:inputOutput><camunda:connectorId>http-connector</camunda:connectorId></camunda:connector></bpmn:extensionElements><bpmn:incoming>SequenceFlow_1ct54zw</bpmn:incoming><bpmn:outgoing>SequenceFlow_027horx</bpmn:outgoing></bpmn:serviceTask><bpmn:sequenceFlow id="SequenceFlow_027horx" sourceRef="ServiceTask_0q99htm" targetRef="Gateway_1cm5ela" /><bpmn:serviceTask id="ServiceTask_13962ax" name="Установка статуса &#34;Исполнена&#34;"><bpmn:extensionElements><camunda:properties><camunda:property name="isEzdocServiceTask" value="true" /><camunda:property name="ezdocServiceTaskType" value="request" /><camunda:property name="requestType" value="GENERIC" /></camunda:properties><camunda:connector><camunda:inputOutput><camunda:inputParameter name="headers"><camunda:map><camunda:entry key="Accept">*/*</camunda:entry><camunda:entry key="Content-Type">application/json</camunda:entry></camunda:map></camunda:inputParameter><camunda:inputParameter name="url">${ezdocUrl}/api/camunda/instance/book/saveLabel/${instanceId}?label=Исполнена</camunda:inputParameter><camunda:inputParameter name="method">POST</camunda:inputParameter></camunda:inputOutput><camunda:connectorId>http-connector</camunda:connectorId></camunda:connector></bpmn:extensionElements><bpmn:incoming>SequenceFlow_1bt4gnv</bpmn:incoming><bpmn:outgoing>SequenceFlow_1upfqqp</bpmn:outgoing></bpmn:serviceTask><bpmn:sequenceFlow id="SequenceFlow_0bwyp8d" sourceRef="UserTask_16hqj3x" targetRef="ServiceTask_18devms"><bpmn:conditionExpression xsi:type="bpmn:tFormalExpression">${buttonId == 'retry'}</bpmn:conditionExpression></bpmn:sequenceFlow><bpmn:sequenceFlow id="SequenceFlow_16ybaca" sourceRef="UserTask_16hqj3x" targetRef="ServiceTask_1rbdr90"><bpmn:conditionExpression xsi:type="bpmn:tFormalExpression">${buttonId == 'cancel'}</bpmn:conditionExpression></bpmn:sequenceFlow><bpmn:serviceTask id="ServiceTask_1rbdr90" name="Установка статуса &#34;Отказано в подтверждении&#34;"><bpmn:extensionElements><camunda:properties><camunda:property name="isEzdocServiceTask" value="true" /><camunda:property name="ezdocServiceTaskType" value="request" /><camunda:property name="requestType" value="GENERIC" /></camunda:properties><camunda:connector><camunda:inputOutput><camunda:inputParameter name="headers"><camunda:map><camunda:entry key="Accept">*/*</camunda:entry><camunda:entry key="Content-Type">application/json</camunda:entry></camunda:map></camunda:inputParameter><camunda:inputParameter name="url">${ezdocUrl}/api/camunda/instance/book/saveLabel/${instanceId}?label=Отказано+в+подтверждении</camunda:inputParameter><camunda:inputParameter name="method">POST</camunda:inputParameter></camunda:inputOutput><camunda:connectorId>http-connector</camunda:connectorId></camunda:connector></bpmn:extensionElements><bpmn:incoming>SequenceFlow_16ybaca</bpmn:incoming><bpmn:outgoing>SequenceFlow_07tm4dw</bpmn:outgoing></bpmn:serviceTask><bpmn:sequenceFlow id="SequenceFlow_07tm4dw" sourceRef="ServiceTask_1rbdr90" targetRef="Activity_0f5n612" /><bpmn:userTask id="UserTask_16hqj3x" name="Подтверждение заявки добавление SMS услуги" camunda:candidateGroups="cb_headmiddleofice, cb_managermiddleoffice, cb_backoffice, jira-users"><bpmn:extensionElements><camunda:properties><camunda:property name="isEzdocTask" value="true" /><camunda:property name="ezdocTaskType" value="buttons" /></camunda:properties><camunda:taskListener event="create"><camunda:script scriptFormat="javascript">try {
              var formData = task.execution.processEngineServices.formService.getTaskFormData(task.id);
              var data = {};
              data.taskId = task.id;
              data.templateId = templateId;
              data.formKey = formData.formKey;
              var formFields = [];
              formData.formFields.forEach(function (a) {formFields.push(a.id)});
              data.formFields = formFields;

              httpPost(ezdocUrl + "/api/camunda/common/taskNotify?type=" + type + "&amp;instanceId=" + instanceId, JSON.stringify(data));
              }
              catch(error) {}

              /*************
              UTILITY FUNCTIONS
              *************/
              function httpPost(e,t,n){n=n||"application/json;charset=UTF-8";var a=new java.net.URL(e).openConnection();return a.requestMethod="POST",a.setRequestProperty("Content-Type",n),a.setRequestProperty("Accept-Charset", "UTF-8"),a.doOutput=!0,write(a.outputStream,t),asResponse(a)}function asResponse(e){return{data:read(e.inputStream),statusCode:e.responseCode}}function write(e,t){var n=new java.io.DataOutputStream(e);n.writeChars(t),n.flush(),n.close()}function read(e){for(var t,n=new java.io.BufferedReader(new java.io.InputStreamReader(e)),a=new java.lang.StringBuffer;null!=(t=n.readLine());)a.append(t);return n.close(),a.toString()}</camunda:script></camunda:taskListener><camunda:formData><camunda:formField id="{&#34;id&#34;:&#34;confirm&#34;,&#34;label&#34;:&#34;Подтвердить&#34;,&#34;type&#34;:&#34;simple&#34;}" type="string" /><camunda:formField id="{&#34;id&#34;:&#34;retry&#34;,&#34;label&#34;:&#34;Повторное заполнение&#34;,&#34;type&#34;:&#34;simple&#34;}" type="string" /><camunda:formField id="{&#34;id&#34;: &#34;cancel&#34;, &#34;label&#34;: &#34;Отказать в подтверждении&#34;, &#34;type&#34;:&#34;fillingParam&#34;,&#34;params&#34;: [ {&#34;name&#34;: &#34;hlk_reason_close&#34;, &#34;label&#34;: &#34;Причина отказа&#34;, &#34;type&#34;: &#34;string&#34;}  ]}" type="string" /><camunda:formField id="{&#34;id&#34;:&#34;arhiv&#34;,&#34;label&#34;:&#34;Архивировать&#34;,&#34;type&#34;:&#34;simple&#34;}" type="string" /></camunda:formData></bpmn:extensionElements><bpmn:incoming>Flow_1nghlbi</bpmn:incoming><bpmn:outgoing>SequenceFlow_16ybaca</bpmn:outgoing><bpmn:outgoing>SequenceFlow_0bwyp8d</bpmn:outgoing><bpmn:outgoing>SequenceFlow_0vt3e4g</bpmn:outgoing><bpmn:outgoing>SequenceFlow_0g8n1yz</bpmn:outgoing></bpmn:userTask><bpmn:serviceTask id="ServiceTask_1x5cn3m" name="Получение данных по договору"><bpmn:extensionElements><camunda:properties><camunda:property name="isEzdocServiceTask" value="true" /><camunda:property name="ezdocServiceTaskType" value="request" /><camunda:property name="requestType" value="GENERIC" /></camunda:properties><camunda:connector><camunda:inputOutput><camunda:inputParameter name="headers"><camunda:map><camunda:entry key="Accept">*/*</camunda:entry><camunda:entry key="Content-Type">application/json</camunda:entry></camunda:map></camunda:inputParameter><camunda:inputParameter name="url">${ezdocUrl}/api/camunda/common/executeRequest</camunda:inputParameter><camunda:inputParameter name="method">POST</camunda:inputParameter><camunda:inputParameter name="payload">{
    "find": "book",
    "filter": {
        "templatePrimaryId": "5e2ea8e551915100088d013a",
        "attributes.hlk_client_FL.primaryId": "${hlk_client_app}",
        "activityStatus": "ACTIVE"
    },
    "projection": {
        "attributes.hlk_need_sms_confirm": 1,
        "attributes.hlk_sms_auth_phone": 1,
        "_id": 1
    }
}</camunda:inputParameter><camunda:outputParameter name="found"><camunda:script scriptFormat="javascript">!!JSON.parse(response).cursor.firstBatch.length</camunda:script></camunda:outputParameter><camunda:outputParameter name="sms_active"><camunda:script scriptFormat="javascript">try{
JSON.parse(response).cursor.firstBatch[0].attributes.hlk_need_sms_confirm;
} catch(e) {
false;
}</camunda:script></camunda:outputParameter><camunda:outputParameter name="sms_number"><camunda:script scriptFormat="javascript">try{
JSON.parse(response).cursor.firstBatch[0].attributes.hlk_sms_auth_phone;
} catch(e) {
"";
}</camunda:script></camunda:outputParameter><camunda:outputParameter name="contract_id"><camunda:script scriptFormat="javascript">try{
JSON.parse(response).cursor.firstBatch[0]._id;
} catch(e) {
"";
}</camunda:script></camunda:outputParameter></camunda:inputOutput><camunda:connectorId>http-connector</camunda:connectorId></camunda:connector></bpmn:extensionElements><bpmn:incoming>SequenceFlow_1fv11n2</bpmn:incoming><bpmn:outgoing>SequenceFlow_14euv6x</bpmn:outgoing></bpmn:serviceTask><bpmn:sequenceFlow id="SequenceFlow_14euv6x" sourceRef="ServiceTask_1x5cn3m" targetRef="Gateway_0gdhp0j" /><bpmn:sequenceFlow id="SequenceFlow_1smnx1p" sourceRef="Gateway_0gdhp0j" targetRef="ExclusiveGateway_03wwych" /><bpmn:exclusiveGateway id="Gateway_0gdhp0j" default="SequenceFlow_1smnx1p"><bpmn:incoming>SequenceFlow_14euv6x</bpmn:incoming><bpmn:outgoing>SequenceFlow_1smnx1p</bpmn:outgoing><bpmn:outgoing>SequenceFlow_06tf44m</bpmn:outgoing></bpmn:exclusiveGateway><bpmn:serviceTask id="ServiceTask_0mv5mtb" name="Получение поля &#34;Клиент&#34;"><bpmn:extensionElements><camunda:properties><camunda:property name="isEzdocServiceTask" value="true" /><camunda:property name="ezdocServiceTaskType" value="request" /><camunda:property name="requestType" value="GENERIC" /></camunda:properties><camunda:connector><camunda:inputOutput><camunda:inputParameter name="headers"><camunda:map><camunda:entry key="Accept">*/*</camunda:entry><camunda:entry key="Content-Type">application/json</camunda:entry></camunda:map></camunda:inputParameter><camunda:inputParameter name="url">${ezdocUrl}/api/camunda/instance/book/${instanceId}/getAttribute/hlk_client_app</camunda:inputParameter><camunda:inputParameter name="method">GET</camunda:inputParameter><camunda:outputParameter name="hlk_client_app">${response}</camunda:outputParameter></camunda:inputOutput><camunda:connectorId>http-connector</camunda:connectorId></camunda:connector></bpmn:extensionElements><bpmn:incoming>SequenceFlow_1grph0u</bpmn:incoming><bpmn:outgoing>SequenceFlow_1f3shw6</bpmn:outgoing></bpmn:serviceTask><bpmn:serviceTask id="ServiceTask_18c9j99" name="Установка статуса &#34;Заявка отменена: Договор не найден&#34;"><bpmn:extensionElements><camunda:properties><camunda:property name="isEzdocServiceTask" value="true" /><camunda:property name="ezdocServiceTaskType" value="request" /><camunda:property name="requestType" value="GENERIC" /></camunda:properties><camunda:connector><camunda:inputOutput><camunda:inputParameter name="headers"><camunda:map><camunda:entry key="Accept">*/*</camunda:entry><camunda:entry key="Content-Type">application/json</camunda:entry></camunda:map></camunda:inputParameter><camunda:inputParameter name="url">${ezdocUrl}/api/camunda/instance/book/saveLabel/${instanceId}?label=Заявка+отменена:+Договор+не+найден</camunda:inputParameter><camunda:inputParameter name="method">POST</camunda:inputParameter></camunda:inputOutput><camunda:connectorId>http-connector</camunda:connectorId></camunda:connector></bpmn:extensionElements><bpmn:incoming>SequenceFlow_06tf44m</bpmn:incoming><bpmn:outgoing>SequenceFlow_0i5xnfx</bpmn:outgoing></bpmn:serviceTask><bpmn:sequenceFlow id="SequenceFlow_0i5xnfx" sourceRef="ServiceTask_18c9j99" targetRef="Gateway_0dx88ba" /><bpmn:sequenceFlow id="SequenceFlow_06tf44m" sourceRef="Gateway_0gdhp0j" targetRef="ServiceTask_18c9j99"><bpmn:conditionExpression xsi:type="bpmn:tFormalExpression">${!found}</bpmn:conditionExpression></bpmn:sequenceFlow><bpmn:exclusiveGateway id="ExclusiveGateway_03wwych" default="SequenceFlow_0hp4saz"><bpmn:incoming>SequenceFlow_1smnx1p</bpmn:incoming><bpmn:outgoing>SequenceFlow_1ct54zw</bpmn:outgoing><bpmn:outgoing>SequenceFlow_0hp4saz</bpmn:outgoing></bpmn:exclusiveGateway><bpmn:sequenceFlow id="SequenceFlow_1ct54zw" sourceRef="ExclusiveGateway_03wwych" targetRef="ServiceTask_0q99htm"><bpmn:conditionExpression xsi:type="bpmn:tFormalExpression">${sms_active == 'false'}</bpmn:conditionExpression></bpmn:sequenceFlow><bpmn:exclusiveGateway id="ExclusiveGateway_0hywdw9" default="SequenceFlow_12t9lfd"><bpmn:incoming>SequenceFlow_0hp4saz</bpmn:incoming><bpmn:outgoing>SequenceFlow_1528m8b</bpmn:outgoing><bpmn:outgoing>SequenceFlow_12t9lfd</bpmn:outgoing></bpmn:exclusiveGateway><bpmn:sequenceFlow id="SequenceFlow_0hp4saz" sourceRef="ExclusiveGateway_03wwych" targetRef="ExclusiveGateway_0hywdw9" /><bpmn:serviceTask id="ServiceTask_1nf3wv7" name="Установка статуса &#34;Услуга уже подключена&#34;"><bpmn:extensionElements><camunda:properties><camunda:property name="isEzdocServiceTask" value="true" /><camunda:property name="ezdocServiceTaskType" value="request" /><camunda:property name="requestType" value="GENERIC" /></camunda:properties><camunda:connector><camunda:inputOutput><camunda:inputParameter name="headers"><camunda:map><camunda:entry key="Accept">*/*</camunda:entry><camunda:entry key="Content-Type">application/json</camunda:entry></camunda:map></camunda:inputParameter><camunda:inputParameter name="url">${ezdocUrl}/api/camunda/instance/book/saveLabel/${instanceId}?label=Услуга+уже+подключена</camunda:inputParameter><camunda:inputParameter name="method">POST</camunda:inputParameter></camunda:inputOutput><camunda:connectorId>http-connector</camunda:connectorId></camunda:connector></bpmn:extensionElements><bpmn:incoming>SequenceFlow_1528m8b</bpmn:incoming><bpmn:outgoing>SequenceFlow_0eu4rlp</bpmn:outgoing></bpmn:serviceTask><bpmn:sequenceFlow id="SequenceFlow_1528m8b" sourceRef="ExclusiveGateway_0hywdw9" targetRef="ServiceTask_1nf3wv7"><bpmn:conditionExpression xsi:type="bpmn:tFormalExpression">${sms_number == hlk_mobile_phone}</bpmn:conditionExpression></bpmn:sequenceFlow><bpmn:endEvent id="EndEvent_12iswgs"><bpmn:incoming>SequenceFlow_1ijz7f3</bpmn:incoming></bpmn:endEvent><bpmn:serviceTask id="ServiceTask_0ik9lqw" name="Создание заявки на изменение номера"><bpmn:extensionElements><camunda:properties><camunda:property name="isEzdocServiceTask" value="true" /><camunda:property name="ezdocServiceTaskType" value="request" /><camunda:property name="requestType" value="GENERIC" /></camunda:properties><camunda:connector><camunda:inputOutput><camunda:inputParameter name="headers"><camunda:map><camunda:entry key="Accept">*/*</camunda:entry><camunda:entry key="Content-Type">application/json</camunda:entry></camunda:map></camunda:inputParameter><camunda:inputParameter name="url">${ezdocUrl}/api/camunda/instance/book/sendInstanceTo/BOOK/${instanceId}</camunda:inputParameter><camunda:inputParameter name="method">POST</camunda:inputParameter><camunda:inputParameter name="payload"><camunda:script scriptFormat="javascript">S("{}")
.prop("hlk_temp_type" , "Смена телефона")
.prop("hlk_NewPhone" , hlk_mobile_phone)
.prop("hlk_sms_doc_app" , hlk_app_id)
.toString()</camunda:script></camunda:inputParameter></camunda:inputOutput><camunda:connectorId>http-connector</camunda:connectorId></camunda:connector></bpmn:extensionElements><bpmn:incoming>SequenceFlow_172apj3</bpmn:incoming><bpmn:outgoing>SequenceFlow_0ufzbsc</bpmn:outgoing></bpmn:serviceTask><bpmn:sequenceFlow id="SequenceFlow_12t9lfd" sourceRef="ExclusiveGateway_0hywdw9" targetRef="ServiceTask_1766vpt" /><bpmn:endEvent id="EndEvent_0bqdc1y"><bpmn:incoming>SequenceFlow_0ufzbsc</bpmn:incoming></bpmn:endEvent><bpmn:sequenceFlow id="SequenceFlow_0vt3e4g" sourceRef="UserTask_16hqj3x" targetRef="ServiceTask_05lrfm8"><bpmn:conditionExpression xsi:type="bpmn:tFormalExpression">${buttonId == 'confirm'}</bpmn:conditionExpression></bpmn:sequenceFlow><bpmn:serviceTask id="ServiceTask_06mylwm" name="Получение поля &#34;телефон&#34;"><bpmn:extensionElements><camunda:properties><camunda:property name="isEzdocServiceTask" value="true" /><camunda:property name="ezdocServiceTaskType" value="request" /><camunda:property name="requestType" value="GENERIC" /></camunda:properties><camunda:connector><camunda:inputOutput><camunda:inputParameter name="headers"><camunda:map><camunda:entry key="Accept">*/*</camunda:entry><camunda:entry key="Content-Type">application/json</camunda:entry></camunda:map></camunda:inputParameter><camunda:inputParameter name="url">${ezdocUrl}/api/camunda/instance/book/${instanceId}/getAttribute/hlk_mobile_phone</camunda:inputParameter><camunda:inputParameter name="method">GET</camunda:inputParameter><camunda:outputParameter name="hlk_mobile_phone">${response}</camunda:outputParameter></camunda:inputOutput><camunda:connectorId>http-connector</camunda:connectorId></camunda:connector></bpmn:extensionElements><bpmn:incoming>SequenceFlow_01ycytw</bpmn:incoming><bpmn:outgoing>SequenceFlow_1fv11n2</bpmn:outgoing></bpmn:serviceTask><bpmn:sequenceFlow id="SequenceFlow_1fv11n2" sourceRef="ServiceTask_06mylwm" targetRef="ServiceTask_1x5cn3m" /><bpmn:serviceTask id="ServiceTask_03blio5" name="Обновление договора"><bpmn:extensionElements><camunda:properties><camunda:property name="isEzdocServiceTask" value="true" /><camunda:property name="ezdocServiceTaskType" value="request" /><camunda:property name="requestType" value="GENERIC" /></camunda:properties><camunda:connector><camunda:inputOutput><camunda:inputParameter name="headers"><camunda:map><camunda:entry key="Accept">*/*</camunda:entry><camunda:entry key="Content-Type">application/json</camunda:entry></camunda:map></camunda:inputParameter><camunda:inputParameter name="url">${ezdocUrl}/api/camunda/instance/book/${contract_id}/setAttributes</camunda:inputParameter><camunda:inputParameter name="method">POST</camunda:inputParameter><camunda:inputParameter name="payload"><camunda:script scriptFormat="javascript">S("{}")
.prop("hlk_need_sms_confirm",true)
.prop("hlk_sms_auth_phone",hlk_mobile_phone)
.prop("hlk_Web_Login" , hlk_mobile_phone)
.toString()</camunda:script></camunda:inputParameter></camunda:inputOutput><camunda:connectorId>http-connector</camunda:connectorId></camunda:connector></bpmn:extensionElements><bpmn:incoming>SequenceFlow_03cb6tu</bpmn:incoming><bpmn:outgoing>SequenceFlow_1teh9g9</bpmn:outgoing></bpmn:serviceTask><bpmn:sequenceFlow id="SequenceFlow_1teh9g9" sourceRef="ServiceTask_03blio5" targetRef="ServiceTask_1sq5tgf" /><bpmn:serviceTask id="ServiceTask_1frt25a" name="Установка статуса &#34;Создана заявка на изменение номера&#34;"><bpmn:extensionElements><camunda:properties><camunda:property name="isEzdocServiceTask" value="true" /><camunda:property name="ezdocServiceTaskType" value="request" /><camunda:property name="requestType" value="GENERIC" /></camunda:properties><camunda:connector><camunda:inputOutput><camunda:inputParameter name="headers"><camunda:map><camunda:entry key="Accept">*/*</camunda:entry><camunda:entry key="Content-Type">application/json</camunda:entry></camunda:map></camunda:inputParameter><camunda:inputParameter name="url">${ezdocUrl}/api/camunda/instance/book/saveLabel/${instanceId}?label=Создана+заявка+на+изменение+номера</camunda:inputParameter><camunda:inputParameter name="method">POST</camunda:inputParameter></camunda:inputOutput><camunda:connectorId>http-connector</camunda:connectorId></camunda:connector></bpmn:extensionElements><bpmn:incoming>SequenceFlow_0t947ik</bpmn:incoming><bpmn:outgoing>SequenceFlow_172apj3</bpmn:outgoing></bpmn:serviceTask><bpmn:sequenceFlow id="SequenceFlow_0ufzbsc" sourceRef="ServiceTask_0ik9lqw" targetRef="EndEvent_0bqdc1y" /><bpmn:serviceTask id="ServiceTask_1bxuff1" name="Получение поля &#34;ID заявки&#34;"><bpmn:extensionElements><camunda:properties><camunda:property name="isEzdocServiceTask" value="true" /><camunda:property name="ezdocServiceTaskType" value="request" /><camunda:property name="requestType" value="GENERIC" /></camunda:properties><camunda:connector><camunda:inputOutput><camunda:inputParameter name="headers"><camunda:map><camunda:entry key="Accept">*/*</camunda:entry><camunda:entry key="Content-Type">application/json</camunda:entry></camunda:map></camunda:inputParameter><camunda:inputParameter name="url">${ezdocUrl}/api/camunda/instance/book/${instanceId}/getAttribute/hlk_app_id</camunda:inputParameter><camunda:inputParameter name="method">GET</camunda:inputParameter><camunda:outputParameter name="hlk_app_id">${response}</camunda:outputParameter></camunda:inputOutput><camunda:connectorId>http-connector</camunda:connectorId></camunda:connector></bpmn:extensionElements><bpmn:incoming>SequenceFlow_12gzo7h</bpmn:incoming><bpmn:outgoing>SequenceFlow_01ycytw</bpmn:outgoing></bpmn:serviceTask><bpmn:sequenceFlow id="SequenceFlow_01ycytw" sourceRef="ServiceTask_1bxuff1" targetRef="ServiceTask_06mylwm" /><bpmn:sequenceFlow id="SequenceFlow_172apj3" sourceRef="ServiceTask_1frt25a" targetRef="ServiceTask_0ik9lqw" /><bpmn:serviceTask id="ServiceTask_0b2tg5h" name="Достаем primaryId заявки"><bpmn:extensionElements><camunda:properties><camunda:property name="isEzdocServiceTask" value="true" /><camunda:property name="ezdocServiceTaskType" value="request" /><camunda:property name="requestType" value="GENERIC" /></camunda:properties><camunda:connector><camunda:inputOutput><camunda:inputParameter name="headers"><camunda:map><camunda:entry key="Accept">*/*</camunda:entry><camunda:entry key="Content-Type">application/json</camunda:entry></camunda:map></camunda:inputParameter><camunda:inputParameter name="url">${ezdocUrl}/api/camunda/common/executeRequest</camunda:inputParameter><camunda:inputParameter name="method">POST</camunda:inputParameter><camunda:inputParameter name="payload">{
	"find": "book",
	"filter": {
		"_id": ObjectId("${instanceId}")
	},
	"projection": {
		"primaryId": 1
	}
}</camunda:inputParameter><camunda:outputParameter name="primaryId"><camunda:script scriptFormat="javascript">JSON.parse(response).cursor.firstBatch[0].primaryId</camunda:script></camunda:outputParameter></camunda:inputOutput><camunda:connectorId>http-connector</camunda:connectorId></camunda:connector></bpmn:extensionElements><bpmn:incoming>Flow_0xmgo8t</bpmn:incoming><bpmn:outgoing>SequenceFlow_0b1i2al</bpmn:outgoing></bpmn:serviceTask><bpmn:sequenceFlow id="SequenceFlow_0b1i2al" sourceRef="ServiceTask_0b2tg5h" targetRef="ServiceTask_1ylueft" /><bpmn:serviceTask id="ServiceTask_1ylueft" name="Записываем в объект"><bpmn:extensionElements><camunda:properties><camunda:property name="isEzdocServiceTask" value="true" /><camunda:property name="ezdocServiceTaskType" value="request" /><camunda:property name="requestType" value="GENERIC" /></camunda:properties><camunda:connector><camunda:inputOutput><camunda:inputParameter name="headers"><camunda:map><camunda:entry key="Accept">*/*</camunda:entry><camunda:entry key="Content-Type">application/json</camunda:entry></camunda:map></camunda:inputParameter><camunda:inputParameter name="url">${ezdocUrl}/api/camunda/instance/book/${instanceId}/setAttribute/hlk_app_id?incrementVersion=true&amp;value=${primaryId}</camunda:inputParameter><camunda:inputParameter name="method">POST</camunda:inputParameter></camunda:inputOutput><camunda:connectorId>http-connector</camunda:connectorId></camunda:connector></bpmn:extensionElements><bpmn:incoming>SequenceFlow_0b1i2al</bpmn:incoming><bpmn:outgoing>SequenceFlow_0huja8w</bpmn:outgoing></bpmn:serviceTask><bpmn:sequenceFlow id="SequenceFlow_0huja8w" sourceRef="ServiceTask_1ylueft" targetRef="ServiceTask_18devms" /><bpmn:serviceTask id="ServiceTask_02aiuue" name="Проверка на дубли заявки"><bpmn:extensionElements><camunda:properties><camunda:property name="isEzdocServiceTask" value="true" /><camunda:property name="ezdocServiceTaskType" value="request" /><camunda:property name="requestType" value="GENERIC" /></camunda:properties><camunda:connector><camunda:inputOutput><camunda:inputParameter name="headers"><camunda:map><camunda:entry key="Accept">*/*</camunda:entry><camunda:entry key="Content-Type">application/json</camunda:entry></camunda:map></camunda:inputParameter><camunda:inputParameter name="url">${ezdocUrl}/api/camunda/common/executeRequest</camunda:inputParameter><camunda:inputParameter name="method">POST</camunda:inputParameter><camunda:inputParameter name="payload">{ 	"find": "book", 	"filter": { 		"templatePrimaryId": "5e5bf730e03dd80007c05255", 		"attributes.hlk_client_app.primaryId": "${hlk_client_app}",  "labelStatus" : "Зарегистрирована","_id": { "$ne": ObjectId("${instanceId}") }}, 	"projection": { 		"_id": 1 	} }</camunda:inputParameter><camunda:outputParameter name="found"><camunda:script scriptFormat="javascript">!!JSON.parse(response).cursor.firstBatch.length</camunda:script></camunda:outputParameter></camunda:inputOutput><camunda:connectorId>http-connector</camunda:connectorId></camunda:connector></bpmn:extensionElements><bpmn:incoming>SequenceFlow_1f3shw6</bpmn:incoming><bpmn:outgoing>SequenceFlow_1mhud6q</bpmn:outgoing></bpmn:serviceTask><bpmn:sequenceFlow id="SequenceFlow_1mhud6q" sourceRef="ServiceTask_02aiuue" targetRef="ExclusiveGateway_06k3ccs" /><bpmn:sequenceFlow id="SequenceFlow_1f3shw6" sourceRef="ServiceTask_0mv5mtb" targetRef="ServiceTask_02aiuue" /><bpmn:exclusiveGateway id="ExclusiveGateway_06k3ccs" default="SequenceFlow_0uzjdgr"><bpmn:incoming>SequenceFlow_1mhud6q</bpmn:incoming><bpmn:outgoing>SequenceFlow_0uzjdgr</bpmn:outgoing><bpmn:outgoing>SequenceFlow_0ls7zf0</bpmn:outgoing></bpmn:exclusiveGateway><bpmn:sequenceFlow id="SequenceFlow_0uzjdgr" sourceRef="ExclusiveGateway_06k3ccs" targetRef="ServiceTask_0pwhj6s" /><bpmn:serviceTask id="ServiceTask_1az9npp" name="Установка статуса &#34;Дублирующая заявка&#34;"><bpmn:extensionElements><camunda:properties><camunda:property name="isEzdocServiceTask" value="true" /><camunda:property name="ezdocServiceTaskType" value="request" /><camunda:property name="requestType" value="GENERIC" /></camunda:properties><camunda:connector><camunda:inputOutput><camunda:inputParameter name="headers"><camunda:map><camunda:entry key="Accept">*/*</camunda:entry><camunda:entry key="Content-Type">application/json</camunda:entry></camunda:map></camunda:inputParameter><camunda:inputParameter name="url">${ezdocUrl}/api/camunda/instance/book/saveLabel/${instanceId}?label=Дублирующая+заявка</camunda:inputParameter><camunda:inputParameter name="method">POST</camunda:inputParameter></camunda:inputOutput><camunda:connectorId>http-connector</camunda:connectorId></camunda:connector></bpmn:extensionElements><bpmn:incoming>SequenceFlow_0ls7zf0</bpmn:incoming><bpmn:outgoing>SequenceFlow_04159u3</bpmn:outgoing></bpmn:serviceTask><bpmn:endEvent id="EndEvent_1qxd8op"><bpmn:incoming>SequenceFlow_0p4qmyb</bpmn:incoming></bpmn:endEvent><bpmn:sequenceFlow id="SequenceFlow_1o51rfv" sourceRef="ServiceTask_0qu1p49" targetRef="IntermediateCatchEvent_0xow9i1" /><bpmn:sequenceFlow id="SequenceFlow_0ls7zf0" sourceRef="ExclusiveGateway_06k3ccs" targetRef="ServiceTask_1az9npp"><bpmn:conditionExpression xsi:type="bpmn:tFormalExpression">${found == true}</bpmn:conditionExpression></bpmn:sequenceFlow><bpmn:sequenceFlow id="SequenceFlow_1bt4gnv" sourceRef="ServiceTask_05lrfm8" targetRef="ServiceTask_13962ax" /><bpmn:callActivity id="ServiceTask_05lrfm8" name="Генерация формы подтверждения" calledElement="FormADDSMSConfirmation"><bpmn:extensionElements><camunda:in variables="all" /><camunda:out variables="all" /><camunda:in sourceExpression="${ezdocUrl}" target="ezdocUrl" /></bpmn:extensionElements><bpmn:incoming>SequenceFlow_0vt3e4g</bpmn:incoming><bpmn:incoming>Flow_11ldmrx</bpmn:incoming><bpmn:outgoing>SequenceFlow_1bt4gnv</bpmn:outgoing></bpmn:callActivity><bpmn:serviceTask id="ServiceTask_1o16y0f" name="Проставление в ФЛ статуса подключения к SMS"><bpmn:extensionElements><camunda:properties><camunda:property name="isEzdocServiceTask" value="true" /><camunda:property name="ezdocServiceTaskType" value="request" /><camunda:property name="requestType" value="GENERIC" /></camunda:properties><camunda:connector><camunda:inputOutput><camunda:inputParameter name="headers"><camunda:map><camunda:entry key="Accept">*/*</camunda:entry><camunda:entry key="Content-Type">application/json</camunda:entry></camunda:map></camunda:inputParameter><camunda:inputParameter name="url">${ezdocUrl}/api/camunda/instance/individual/${referenceId1}/setAttributes?incrementVersion=false</camunda:inputParameter><camunda:inputParameter name="method">POST</camunda:inputParameter><camunda:inputParameter name="payload"><camunda:script scriptFormat="javascript">S("{}")
.prop("hlk_need_sms_confirm", true)
.prop("hlk_terminal_active", true)
.toString()</camunda:script></camunda:inputParameter><camunda:outputParameter name="rrr">${response}</camunda:outputParameter></camunda:inputOutput><camunda:connectorId>http-connector</camunda:connectorId></camunda:connector></bpmn:extensionElements><bpmn:incoming>SequenceFlow_1txbxst</bpmn:incoming><bpmn:outgoing>SequenceFlow_0ux8ato</bpmn:outgoing></bpmn:serviceTask><bpmn:sequenceFlow id="SequenceFlow_0ux8ato" sourceRef="ServiceTask_1o16y0f" targetRef="ServiceTask_0gne7iq" /><bpmn:serviceTask id="ServiceTask_0v5wugs" name="Получаем инстанс айди выбранного клиента"><bpmn:extensionElements><camunda:connector><camunda:inputOutput><camunda:inputParameter name="url">${ezdocUrl}/api/camunda/instance/book/${instanceId}/getRefId/hlk_client_app</camunda:inputParameter><camunda:inputParameter name="method">GET</camunda:inputParameter><camunda:inputParameter name="headers"><camunda:map><camunda:entry key="Accept">*/*</camunda:entry></camunda:map></camunda:inputParameter><camunda:outputParameter name="referenceId1">${response}</camunda:outputParameter></camunda:inputOutput><camunda:connectorId>http-connector</camunda:connectorId></camunda:connector></bpmn:extensionElements><bpmn:incoming>SequenceFlow_0mt0zl9</bpmn:incoming><bpmn:outgoing>SequenceFlow_1txbxst</bpmn:outgoing></bpmn:serviceTask><bpmn:sequenceFlow id="SequenceFlow_1txbxst" sourceRef="ServiceTask_0v5wugs" targetRef="ServiceTask_1o16y0f" /><bpmn:serviceTask id="ServiceTask_13qjwj0" name="Получаем мобильный телефон"><bpmn:extensionElements><camunda:properties><camunda:property name="isEzdocServiceTask" value="true" /><camunda:property name="ezdocServiceTaskType" value="request" /><camunda:property name="requestType" value="GENERIC" /></camunda:properties><camunda:connector><camunda:inputOutput><camunda:inputParameter name="headers"><camunda:map><camunda:entry key="Accept">*/*</camunda:entry><camunda:entry key="Content-Type">application/json</camunda:entry></camunda:map></camunda:inputParameter><camunda:inputParameter name="url">${ezdocUrl}/api/camunda/instance/book/${instanceId}/getAttributes?systemName=hlk_mobile_phone</camunda:inputParameter><camunda:inputParameter name="method">GET</camunda:inputParameter><camunda:outputParameter name="attributes">${response}</camunda:outputParameter></camunda:inputOutput><camunda:connectorId>http-connector</camunda:connectorId></camunda:connector></bpmn:extensionElements><bpmn:incoming>SequenceFlow_1xbx4u7</bpmn:incoming><bpmn:outgoing>SequenceFlow_04gbdac</bpmn:outgoing></bpmn:serviceTask><bpmn:sequenceFlow id="SequenceFlow_1xbx4u7" sourceRef="Task_0micukk" targetRef="ServiceTask_13qjwj0" /><bpmn:scriptTask id="ScriptTask_0oxouxy" name="Проверяем правильность заполнения" scriptFormat="javascript" camunda:resultVariable="validationErrors"><bpmn:incoming>SequenceFlow_04gbdac</bpmn:incoming><bpmn:outgoing>SequenceFlow_1dm8vr6</bpmn:outgoing><bpmn:script>var attrs = JSON.parse(attributes);
var errors = {};
var mobile_phone_prefix = [700, 701, 702, 703, 704, 705, 706, 707, 708, 709, 747, 750, 751, 760, 761, 762, 763, 764, 771, 775, 776, 777, 778];

//Сами проверки

var flag = 0; 
for (var i = 0; i &lt; mobile_phone_prefix.length; i++) {
  if ( mobile_phone_prefix[i] == attrs.hlk_mobile_phone.substring(1,4)) {
	flag=1;
	continue;
  }
} 

if (!flag) {
    errors.hlk_mobile_phone = {
        verified: false,
        decision: 'Код мобильного телефона не соответствует справочнику допустимых кодов'
    };
} else {
    errors.hlk_mobile_phone = {
        verified: true
    }
}
JSON.stringify(errors);</bpmn:script></bpmn:scriptTask><bpmn:serviceTask id="ServiceTask_05u400x" name="Записываем результат валидации"><bpmn:extensionElements><camunda:properties><camunda:property name="isEzdocServiceTask" value="true" /><camunda:property name="ezdocServiceTaskType" value="request" /><camunda:property name="requestType" value="GENERIC" /></camunda:properties><camunda:connector><camunda:inputOutput><camunda:inputParameter name="headers"><camunda:map><camunda:entry key="Accept">*/*</camunda:entry><camunda:entry key="Content-Type">application/json</camunda:entry></camunda:map></camunda:inputParameter><camunda:inputParameter name="method">POST</camunda:inputParameter><camunda:inputParameter name="url">${ezdocUrl}/api/camunda/instance/book/verification/${instanceId}</camunda:inputParameter><camunda:inputParameter name="payload">${validationErrors}</camunda:inputParameter></camunda:inputOutput><camunda:connectorId>http-connector</camunda:connectorId></camunda:connector></bpmn:extensionElements><bpmn:incoming>SequenceFlow_1dm8vr6</bpmn:incoming><bpmn:outgoing>SequenceFlow_0bdhcc4</bpmn:outgoing></bpmn:serviceTask><bpmn:sequenceFlow id="SequenceFlow_1dm8vr6" sourceRef="ScriptTask_0oxouxy" targetRef="ServiceTask_05u400x" /><bpmn:sequenceFlow id="SequenceFlow_04gbdac" sourceRef="ServiceTask_13qjwj0" targetRef="ScriptTask_0oxouxy" /><bpmn:exclusiveGateway id="ExclusiveGateway_0g6drww" default="SequenceFlow_1elj596"><bpmn:incoming>SequenceFlow_0bdhcc4</bpmn:incoming><bpmn:outgoing>SequenceFlow_1grph0u</bpmn:outgoing><bpmn:outgoing>SequenceFlow_1elj596</bpmn:outgoing></bpmn:exclusiveGateway><bpmn:sequenceFlow id="SequenceFlow_1grph0u" sourceRef="ExclusiveGateway_0g6drww" targetRef="ServiceTask_0mv5mtb"><bpmn:conditionExpression xsi:type="bpmn:tFormalExpression" language="javascript">var verified =true;
var v = JSON.parse(validationErrors);
for (key in v) {
    verified = verified &amp;&amp; v[key].verified; 
}
verified;</bpmn:conditionExpression></bpmn:sequenceFlow><bpmn:sequenceFlow id="SequenceFlow_0bdhcc4" sourceRef="ServiceTask_05u400x" targetRef="ExclusiveGateway_0g6drww" /><bpmn:sequenceFlow id="SequenceFlow_1elj596" sourceRef="ExclusiveGateway_0g6drww" targetRef="Task_0micukk" /><bpmn:serviceTask id="ServiceTask_1sq5tgf" name="Повышаем версию договора"><bpmn:extensionElements><camunda:properties><camunda:property name="isEzdocServiceTask" value="true" /><camunda:property name="ezdocServiceTaskType" value="request" /><camunda:property name="requestType" value="GENERIC" /></camunda:properties><camunda:connector><camunda:inputOutput><camunda:inputParameter name="headers"><camunda:map><camunda:entry key="Accept">*/*</camunda:entry><camunda:entry key="Content-Type">application/json</camunda:entry></camunda:map></camunda:inputParameter><camunda:inputParameter name="url">${ezdocUrl}/api/camunda/instance/book/processCompleted/${contract_id}</camunda:inputParameter><camunda:inputParameter name="method">POST</camunda:inputParameter></camunda:inputOutput><camunda:connectorId>http-connector</camunda:connectorId></camunda:connector></bpmn:extensionElements><bpmn:incoming>SequenceFlow_1teh9g9</bpmn:incoming><bpmn:outgoing>SequenceFlow_08dy311</bpmn:outgoing></bpmn:serviceTask><bpmn:sequenceFlow id="SequenceFlow_08dy311" sourceRef="ServiceTask_1sq5tgf" targetRef="ScriptTask_0sj004j" /><bpmn:serviceTask id="ServiceTask_0vimz4i" name="Проверка на уникальность номера телефона"><bpmn:extensionElements><camunda:properties><camunda:property name="isEzdocServiceTask" value="true" /><camunda:property name="ezdocServiceTaskType" value="request" /><camunda:property name="requestType" value="GENERIC" /></camunda:properties><camunda:connector><camunda:inputOutput><camunda:inputParameter name="headers"><camunda:map><camunda:entry key="Accept">*/*</camunda:entry><camunda:entry key="Content-Type">application/json</camunda:entry></camunda:map></camunda:inputParameter><camunda:inputParameter name="url">${ezdocUrl}/api/camunda/common/executeRequest</camunda:inputParameter><camunda:inputParameter name="method">POST</camunda:inputParameter><camunda:inputParameter name="payload">{ 	"find": "book", 	"filter": 
{
 "$or": 
[		
{
"templatePrimaryId": "5e5bf730e03dd80007c05255", 		
"attributes.hlk_mobile_phone": "${hlk_mobile_phone}",  
"labelStatus" : "Зарегистрирована",
"_id": { "$ne": ObjectId("${instanceId}") }
}, 	
{
"templatePrimaryId": "5e5bf74ee03dd80007c05269", 		
"attributes.hlk_mobile_phone": "${hlk_mobile_phone}",  
"labelStatus" : "Зарегистрирована",
"_id": { "$ne": ObjectId("${instanceId}") }
}, 	
{
"templatePrimaryId": "5e2ea8e551915100088d013a", 		
"attributes.hlk_sms_auth_phone": "${hlk_mobile_phone}",  
"status" : "VERIFICATED",
"_id": { "$ne": ObjectId("${instanceId}") }
}
]
},
"projection": { 		"_id": 1 	}
}</camunda:inputParameter><camunda:outputParameter name="found"><camunda:script scriptFormat="javascript">!!JSON.parse(response).cursor.firstBatch.length</camunda:script></camunda:outputParameter></camunda:inputOutput><camunda:connectorId>http-connector</camunda:connectorId></camunda:connector></bpmn:extensionElements><bpmn:incoming>SequenceFlow_0zgi4li</bpmn:incoming><bpmn:outgoing>SequenceFlow_1gcorlu</bpmn:outgoing></bpmn:serviceTask><bpmn:sequenceFlow id="SequenceFlow_1gcorlu" sourceRef="ServiceTask_0vimz4i" targetRef="ExclusiveGateway_0pp5mrd" /><bpmn:exclusiveGateway id="ExclusiveGateway_0pp5mrd" default="SequenceFlow_12gzo7h"><bpmn:incoming>SequenceFlow_1gcorlu</bpmn:incoming><bpmn:outgoing>SequenceFlow_12gzo7h</bpmn:outgoing><bpmn:outgoing>SequenceFlow_17etoss</bpmn:outgoing></bpmn:exclusiveGateway><bpmn:sequenceFlow id="SequenceFlow_12gzo7h" sourceRef="ExclusiveGateway_0pp5mrd" targetRef="ServiceTask_1bxuff1" /><bpmn:serviceTask id="ServiceTask_1uliioi" name="Установка статуса &#34;Мобильный номер не уникален&#34;"><bpmn:extensionElements><camunda:properties><camunda:property name="isEzdocServiceTask" value="true" /><camunda:property name="ezdocServiceTaskType" value="request" /><camunda:property name="requestType" value="GENERIC" /></camunda:properties><camunda:connector><camunda:inputOutput><camunda:inputParameter name="headers"><camunda:map><camunda:entry key="Accept">*/*</camunda:entry><camunda:entry key="Content-Type">application/json</camunda:entry></camunda:map></camunda:inputParameter><camunda:inputParameter name="url">${ezdocUrl}/api/camunda/instance/book/saveLabel/${instanceId}?label=Мобильный+номер+не+уникален</camunda:inputParameter><camunda:inputParameter name="method">POST</camunda:inputParameter></camunda:inputOutput><camunda:connectorId>http-connector</camunda:connectorId></camunda:connector></bpmn:extensionElements><bpmn:incoming>SequenceFlow_17etoss</bpmn:incoming><bpmn:outgoing>SequenceFlow_00ne59m</bpmn:outgoing></bpmn:serviceTask><bpmn:sequenceFlow id="SequenceFlow_17etoss" sourceRef="ExclusiveGateway_0pp5mrd" targetRef="ServiceTask_1uliioi"><bpmn:conditionExpression xsi:type="bpmn:tFormalExpression">${found == true}</bpmn:conditionExpression></bpmn:sequenceFlow><bpmn:serviceTask id="ServiceTask_1766vpt" name="Установка статуса &#34;Клиенту уже подключена услуга SMS-подтверждения. Создать заявку на изменение?&#34;"><bpmn:extensionElements><camunda:properties><camunda:property name="isEzdocServiceTask" value="true" /><camunda:property name="ezdocServiceTaskType" value="request" /><camunda:property name="requestType" value="GENERIC" /></camunda:properties><camunda:connector><camunda:inputOutput><camunda:inputParameter name="headers"><camunda:map><camunda:entry key="Accept">*/*</camunda:entry><camunda:entry key="Content-Type">application/json</camunda:entry></camunda:map></camunda:inputParameter><camunda:inputParameter name="url">${ezdocUrl}/api/camunda/instance/book/saveLabel/${instanceId}?label=Клиенту+уже+подключена+услуга+SMS-подтверждения.+Создать+заявку+на+изменение?</camunda:inputParameter><camunda:inputParameter name="method">POST</camunda:inputParameter></camunda:inputOutput><camunda:connectorId>http-connector</camunda:connectorId></camunda:connector></bpmn:extensionElements><bpmn:incoming>SequenceFlow_12t9lfd</bpmn:incoming><bpmn:outgoing>SequenceFlow_11eszkm</bpmn:outgoing></bpmn:serviceTask><bpmn:sequenceFlow id="SequenceFlow_11eszkm" sourceRef="ServiceTask_1766vpt" targetRef="UserTask_1d9hm1w" /><bpmn:userTask id="UserTask_1d9hm1w" name="Подтверждение заявки добавление SMS услуги" camunda:candidateGroups="cb_headmiddleofice, cb_managermiddleoffice, cb_backoffice, jira-users"><bpmn:extensionElements><camunda:properties><camunda:property name="isEzdocTask" value="true" /><camunda:property name="ezdocTaskType" value="buttons" /></camunda:properties><camunda:taskListener event="create"><camunda:script scriptFormat="javascript">try {
              var formData = task.execution.processEngineServices.formService.getTaskFormData(task.id);
              var data = {};
              data.taskId = task.id;
              data.templateId = templateId;
              data.formKey = formData.formKey;
              var formFields = [];
              formData.formFields.forEach(function (a) {formFields.push(a.id)});
              data.formFields = formFields;

              httpPost(ezdocUrl + "/api/camunda/common/taskNotify?type=" + type + "&amp;instanceId=" + instanceId, JSON.stringify(data));
              }
              catch(error) {}

              /*************
              UTILITY FUNCTIONS
              *************/
              function httpPost(e,t,n){n=n||"application/json;charset=UTF-8";var a=new java.net.URL(e).openConnection();return a.requestMethod="POST",a.setRequestProperty("Content-Type",n),a.setRequestProperty("Accept-Charset", "UTF-8"),a.doOutput=!0,write(a.outputStream,t),asResponse(a)}function asResponse(e){return{data:read(e.inputStream),statusCode:e.responseCode}}function write(e,t){var n=new java.io.DataOutputStream(e);n.writeChars(t),n.flush(),n.close()}function read(e){for(var t,n=new java.io.BufferedReader(new java.io.InputStreamReader(e)),a=new java.lang.StringBuffer;null!=(t=n.readLine());)a.append(t);return n.close(),a.toString()}</camunda:script></camunda:taskListener><camunda:formData><camunda:formField id="{&#34;id&#34;:&#34;edit&#34;,&#34;label&#34;:&#34;Создать заявку на изменение номера&#34;,&#34;type&#34;:&#34;simple&#34;}" type="string" /><camunda:formField id="{&#34;id&#34;:&#34;retry&#34;,&#34;label&#34;:&#34;Повторное заполнение&#34;,&#34;type&#34;:&#34;simple&#34;}" type="string" /><camunda:formField id="{&#34;id&#34;:&#34;cancel&#34;,&#34;label&#34;:&#34;Отменить заявку&#34;,&#34;type&#34;:&#34;simple&#34;}" type="string" /></camunda:formData></bpmn:extensionElements><bpmn:incoming>SequenceFlow_11eszkm</bpmn:incoming><bpmn:outgoing>SequenceFlow_0t947ik</bpmn:outgoing><bpmn:outgoing>SequenceFlow_045y2r2</bpmn:outgoing><bpmn:outgoing>SequenceFlow_0lnhfak</bpmn:outgoing></bpmn:userTask><bpmn:sequenceFlow id="SequenceFlow_0t947ik" sourceRef="UserTask_1d9hm1w" targetRef="ServiceTask_1frt25a"><bpmn:conditionExpression xsi:type="bpmn:tFormalExpression">${buttonId == 'edit'}</bpmn:conditionExpression></bpmn:sequenceFlow><bpmn:sequenceFlow id="SequenceFlow_045y2r2" sourceRef="UserTask_1d9hm1w" targetRef="Task_0micukk"><bpmn:conditionExpression xsi:type="bpmn:tFormalExpression">${buttonId == 'retry'}</bpmn:conditionExpression></bpmn:sequenceFlow><bpmn:serviceTask id="ServiceTask_10itkun" name="Повышение версии"><bpmn:extensionElements><camunda:properties><camunda:property name="isEzdocServiceTask" value="true" /><camunda:property name="ezdocServiceTaskType" value="request" /><camunda:property name="requestType" value="GENERIC" /></camunda:properties><camunda:connector><camunda:inputOutput><camunda:inputParameter name="headers"><camunda:map><camunda:entry key="Accept">*/*</camunda:entry><camunda:entry key="Content-Type">application/json</camunda:entry></camunda:map></camunda:inputParameter><camunda:inputParameter name="url">${ezdocUrl}/api/camunda/instance/book/processCompleted/${instanceId}</camunda:inputParameter><camunda:inputParameter name="method">POST</camunda:inputParameter></camunda:inputOutput><camunda:connectorId>http-connector</camunda:connectorId></camunda:connector></bpmn:extensionElements></bpmn:serviceTask><bpmn:serviceTask id="ServiceTask_0tqevuh" name="Повышение версии"><bpmn:extensionElements><camunda:properties><camunda:property name="isEzdocServiceTask" value="true" /><camunda:property name="ezdocServiceTaskType" value="request" /><camunda:property name="requestType" value="GENERIC" /></camunda:properties><camunda:connector><camunda:inputOutput><camunda:inputParameter name="headers"><camunda:map><camunda:entry key="Accept">*/*</camunda:entry><camunda:entry key="Content-Type">application/json</camunda:entry></camunda:map></camunda:inputParameter><camunda:inputParameter name="url">${ezdocUrl}/api/camunda/instance/book/processCompleted/${instanceId}</camunda:inputParameter><camunda:inputParameter name="method">POST</camunda:inputParameter></camunda:inputOutput><camunda:connectorId>http-connector</camunda:connectorId></camunda:connector></bpmn:extensionElements></bpmn:serviceTask><bpmn:serviceTask id="ServiceTask_0pwhj6s" name="Получаем мобильный телефон"><bpmn:extensionElements><camunda:properties><camunda:property name="isEzdocServiceTask" value="true" /><camunda:property name="ezdocServiceTaskType" value="request" /><camunda:property name="requestType" value="GENERIC" /></camunda:properties><camunda:connector><camunda:inputOutput><camunda:inputParameter name="headers"><camunda:map><camunda:entry key="Accept">*/*</camunda:entry><camunda:entry key="Content-Type">application/json</camunda:entry></camunda:map></camunda:inputParameter><camunda:inputParameter name="url">${ezdocUrl}/api/camunda/instance/book/${instanceId}/getAttribute/hlk_mobile_phone</camunda:inputParameter><camunda:inputParameter name="method">GET</camunda:inputParameter><camunda:outputParameter name="hlk_mobile_phone">${response}</camunda:outputParameter></camunda:inputOutput><camunda:connectorId>http-connector</camunda:connectorId></camunda:connector></bpmn:extensionElements><bpmn:incoming>SequenceFlow_0uzjdgr</bpmn:incoming><bpmn:incoming>Flow_03mb09o</bpmn:incoming><bpmn:outgoing>SequenceFlow_0zgi4li</bpmn:outgoing></bpmn:serviceTask><bpmn:sequenceFlow id="SequenceFlow_0zgi4li" sourceRef="ServiceTask_0pwhj6s" targetRef="ServiceTask_0vimz4i" /><bpmn:serviceTask id="ServiceTask_1q4lky6" name="Установка статуса &#34;Заявка отклонена&#34;"><bpmn:extensionElements><camunda:properties><camunda:property name="isEzdocServiceTask" value="true" /><camunda:property name="ezdocServiceTaskType" value="request" /><camunda:property name="requestType" value="GENERIC" /></camunda:properties><camunda:connector><camunda:inputOutput><camunda:inputParameter name="headers"><camunda:map><camunda:entry key="Accept">*/*</camunda:entry><camunda:entry key="Content-Type">application/json</camunda:entry></camunda:map></camunda:inputParameter><camunda:inputParameter name="url">${ezdocUrl}/api/camunda/instance/book/saveLabel/${instanceId}?label=Заявка+отменена</camunda:inputParameter><camunda:inputParameter name="method">POST</camunda:inputParameter></camunda:inputOutput><camunda:connectorId>http-connector</camunda:connectorId></camunda:connector></bpmn:extensionElements><bpmn:incoming>SequenceFlow_0lnhfak</bpmn:incoming><bpmn:outgoing>SequenceFlow_01pm3mo</bpmn:outgoing></bpmn:serviceTask><bpmn:sequenceFlow id="SequenceFlow_0lnhfak" sourceRef="UserTask_1d9hm1w" targetRef="ServiceTask_1q4lky6"><bpmn:conditionExpression xsi:type="bpmn:tFormalExpression">${buttonId == 'cancel'}</bpmn:conditionExpression></bpmn:sequenceFlow><bpmn:userTask id="UserTask_1ndz30w" name="Подтверждение заявки добавление SMS услуги" camunda:candidateGroups="cb_headmiddleofice, cb_managermiddleoffice, cb_backoffice, jira-users"><bpmn:extensionElements><camunda:properties><camunda:property name="isEzdocTask" value="true" /><camunda:property name="ezdocTaskType" value="buttons" /></camunda:properties><camunda:taskListener event="create"><camunda:script scriptFormat="javascript">try {
              var formData = task.execution.processEngineServices.formService.getTaskFormData(task.id);
              var data = {};
              data.taskId = task.id;
              data.templateId = templateId;
              data.formKey = formData.formKey;
              var formFields = [];
              formData.formFields.forEach(function (a) {formFields.push(a.id)});
              data.formFields = formFields;

              httpPost(ezdocUrl + "/api/camunda/common/taskNotify?type=" + type + "&amp;instanceId=" + instanceId, JSON.stringify(data));
              }
              catch(error) {}

              /*************
              UTILITY FUNCTIONS
              *************/
              function httpPost(e,t,n){n=n||"application/json;charset=UTF-8";var a=new java.net.URL(e).openConnection();return a.requestMethod="POST",a.setRequestProperty("Content-Type",n),a.setRequestProperty("Accept-Charset", "UTF-8"),a.doOutput=!0,write(a.outputStream,t),asResponse(a)}function asResponse(e){return{data:read(e.inputStream),statusCode:e.responseCode}}function write(e,t){var n=new java.io.DataOutputStream(e);n.writeChars(t),n.flush(),n.close()}function read(e){for(var t,n=new java.io.BufferedReader(new java.io.InputStreamReader(e)),a=new java.lang.StringBuffer;null!=(t=n.readLine());)a.append(t);return n.close(),a.toString()}</camunda:script></camunda:taskListener><camunda:formData><camunda:formField id="{&#34;id&#34;:&#34;retry&#34;,&#34;label&#34;:&#34;Повторное заполнение&#34;,&#34;type&#34;:&#34;simple&#34;}" type="string" /><camunda:formField id="{&#34;id&#34;:&#34;cancel&#34;,&#34;label&#34;:&#34;Отменить заявку&#34;,&#34;type&#34;:&#34;simple&#34;}" type="string" /></camunda:formData></bpmn:extensionElements><bpmn:incoming>Flow_1pu94n9</bpmn:incoming><bpmn:outgoing>SequenceFlow_0shw5yd</bpmn:outgoing><bpmn:outgoing>SequenceFlow_1gvxnaj</bpmn:outgoing></bpmn:userTask><bpmn:serviceTask id="ServiceTask_15s6o4b" name="Установка статуса &#34;Заявка отклонена&#34;"><bpmn:extensionElements><camunda:properties><camunda:property name="isEzdocServiceTask" value="true" /><camunda:property name="ezdocServiceTaskType" value="request" /><camunda:property name="requestType" value="GENERIC" /></camunda:properties><camunda:connector><camunda:inputOutput><camunda:inputParameter name="headers"><camunda:map><camunda:entry key="Accept">*/*</camunda:entry><camunda:entry key="Content-Type">application/json</camunda:entry></camunda:map></camunda:inputParameter><camunda:inputParameter name="url">${ezdocUrl}/api/camunda/instance/book/saveLabel/${instanceId}?label=Заявка+отменена</camunda:inputParameter><camunda:inputParameter name="method">POST</camunda:inputParameter></camunda:inputOutput><camunda:connectorId>http-connector</camunda:connectorId></camunda:connector></bpmn:extensionElements><bpmn:incoming>SequenceFlow_0shw5yd</bpmn:incoming><bpmn:outgoing>SequenceFlow_0v0nibf</bpmn:outgoing></bpmn:serviceTask><bpmn:endEvent id="EndEvent_0nvke4f"><bpmn:incoming>SequenceFlow_1gcfak6</bpmn:incoming></bpmn:endEvent><bpmn:sequenceFlow id="SequenceFlow_0shw5yd" sourceRef="UserTask_1ndz30w" targetRef="ServiceTask_15s6o4b"><bpmn:conditionExpression xsi:type="bpmn:tFormalExpression">${buttonId == 'cancel'}</bpmn:conditionExpression></bpmn:sequenceFlow><bpmn:sequenceFlow id="SequenceFlow_0v0nibf" sourceRef="ServiceTask_15s6o4b" targetRef="UserTask_00zq93g" /><bpmn:sequenceFlow id="SequenceFlow_00ne59m" sourceRef="ServiceTask_1uliioi" targetRef="Gateway_0q58c4k" /><bpmn:sequenceFlow id="SequenceFlow_1gvxnaj" sourceRef="UserTask_1ndz30w" targetRef="ServiceTask_18devms"><bpmn:conditionExpression xsi:type="bpmn:tFormalExpression">${buttonId == 'retry'}</bpmn:conditionExpression></bpmn:sequenceFlow><bpmn:serviceTask id="ServiceTask_0u57waj" name="Записываем в объект причину отказа"><bpmn:extensionElements><camunda:connector><camunda:inputOutput><camunda:inputParameter name="url">${ezdocUrl}/api/camunda/instance/book/${instanceId}/setAttribute/hlk_app_reason_close?incrementVersion=true&amp;value=${hlk_reason_close.replace(" ","+")}</camunda:inputParameter><camunda:inputParameter name="method">POST</camunda:inputParameter><camunda:inputParameter name="headers"><camunda:map><camunda:entry key="Accept">*/*</camunda:entry></camunda:map></camunda:inputParameter></camunda:inputOutput><camunda:connectorId>http-connector</camunda:connectorId></camunda:connector></bpmn:extensionElements><bpmn:incoming>Flow_0e80d73</bpmn:incoming><bpmn:outgoing>SequenceFlow_09ihm5h</bpmn:outgoing></bpmn:serviceTask><bpmn:sequenceFlow id="SequenceFlow_09ihm5h" sourceRef="ServiceTask_0u57waj" targetRef="UserTask_1rjmihl" /><bpmn:serviceTask id="ServiceTask_0qu1p49" name="Архивация"><bpmn:extensionElements><camunda:properties><camunda:property name="isEzdocServiceTask" value="true" /><camunda:property name="ezdocServiceTaskType" value="request" /><camunda:property name="requestType" value="GENERIC" /></camunda:properties><camunda:connector><camunda:inputOutput><camunda:inputParameter name="headers"><camunda:map><camunda:entry key="Accept">*/*</camunda:entry><camunda:entry key="Content-Type">application/json</camunda:entry></camunda:map></camunda:inputParameter><camunda:inputParameter name="url">${ezdocUrl}/api/camunda/instance/book/${instanceId}/archive</camunda:inputParameter><camunda:inputParameter name="method">POST</camunda:inputParameter></camunda:inputOutput><camunda:connectorId>http-connector</camunda:connectorId></camunda:connector></bpmn:extensionElements><bpmn:incoming>SequenceFlow_0yxwm19</bpmn:incoming><bpmn:outgoing>SequenceFlow_1o51rfv</bpmn:outgoing></bpmn:serviceTask><bpmn:userTask id="UserTask_0flnlk6" name="Кнопка &#34;Архивировать&#34;" camunda:candidateGroups="cb_headmiddleofice, cb_managermiddleoffice, cb_accessadmin, cb_backoffice, jira-users"><bpmn:extensionElements><camunda:properties><camunda:property name="isEzdocTask" value="true" /><camunda:property name="ezdocTaskType" value="buttons" /></camunda:properties><camunda:taskListener event="create"><camunda:script scriptFormat="javascript">try {
              var formData = task.execution.processEngineServices.formService.getTaskFormData(task.id);
              var data = {};
              data.taskId = task.id;
              data.templateId = templateId;
              data.formKey = formData.formKey;
              var formFields = [];
              formData.formFields.forEach(function (a) {formFields.push(a.id)});
              data.formFields = formFields;

              httpPost(ezdocUrl + "/api/camunda/common/taskNotify?type=" + type + "&amp;instanceId=" + instanceId, JSON.stringify(data));
              }
              catch(error) {}

              /*************
              UTILITY FUNCTIONS
              *************/
              function httpPost(e,t,n){n=n||"application/json;charset=UTF-8";var a=new java.net.URL(e).openConnection();return a.requestMethod="POST",a.setRequestProperty("Content-Type",n),a.setRequestProperty("Accept-Charset", "UTF-8"),a.doOutput=!0,write(a.outputStream,t),asResponse(a)}function asResponse(e){return{data:read(e.inputStream),statusCode:e.responseCode}}function write(e,t){var n=new java.io.DataOutputStream(e);n.writeChars(t),n.flush(),n.close()}function read(e){for(var t,n=new java.io.BufferedReader(new java.io.InputStreamReader(e)),a=new java.lang.StringBuffer;null!=(t=n.readLine());)a.append(t);return n.close(),a.toString()}</camunda:script></camunda:taskListener><camunda:formData><camunda:formField id="{&#34;id&#34;:&#34;retry&#34;,&#34;label&#34;:&#34;Архивировать&#34;,&#34;type&#34;:&#34;simple&#34;}" type="string" /></camunda:formData></bpmn:extensionElements><bpmn:incoming>SequenceFlow_04159u3</bpmn:incoming><bpmn:outgoing>SequenceFlow_0yxwm19</bpmn:outgoing></bpmn:userTask><bpmn:sequenceFlow id="SequenceFlow_04159u3" sourceRef="ServiceTask_1az9npp" targetRef="UserTask_0flnlk6" /><bpmn:sequenceFlow id="SequenceFlow_0yxwm19" sourceRef="UserTask_0flnlk6" targetRef="ServiceTask_0qu1p49" /><bpmn:serviceTask id="ServiceTask_09t4e6t" name="Установка статуса &#34;Архив&#34;"><bpmn:extensionElements><camunda:properties><camunda:property name="isEzdocServiceTask" value="true" /><camunda:property name="ezdocServiceTaskType" value="request" /><camunda:property name="requestType" value="GENERIC" /></camunda:properties><camunda:connector><camunda:inputOutput><camunda:inputParameter name="headers"><camunda:map><camunda:entry key="Accept">*/*</camunda:entry><camunda:entry key="Content-Type">application/json</camunda:entry></camunda:map></camunda:inputParameter><camunda:inputParameter name="url">${ezdocUrl}/api/camunda/instance/book/saveLabel/${instanceId}?label=Архив</camunda:inputParameter><camunda:inputParameter name="method">POST</camunda:inputParameter></camunda:inputOutput><camunda:connectorId>http-connector</camunda:connectorId></camunda:connector></bpmn:extensionElements><bpmn:incoming>SequenceFlow_0ye5525</bpmn:incoming><bpmn:outgoing>SequenceFlow_0p4qmyb</bpmn:outgoing></bpmn:serviceTask><bpmn:sequenceFlow id="SequenceFlow_0p4qmyb" sourceRef="ServiceTask_09t4e6t" targetRef="EndEvent_1qxd8op" /><bpmn:userTask id="UserTask_00zq93g" name="Кнопка &#34;Архивировать&#34;" camunda:candidateGroups="cb_headmiddleofice, cb_accessadmin, cb_backoffice, jira-users"><bpmn:extensionElements><camunda:properties><camunda:property name="isEzdocTask" value="true" /><camunda:property name="ezdocTaskType" value="buttons" /></camunda:properties><camunda:taskListener event="create"><camunda:script scriptFormat="javascript">try {
              var formData = task.execution.processEngineServices.formService.getTaskFormData(task.id);
              var data = {};
              data.taskId = task.id;
              data.templateId = templateId;
              data.formKey = formData.formKey;
              var formFields = [];
              formData.formFields.forEach(function (a) {formFields.push(a.id)});
              data.formFields = formFields;

              httpPost(ezdocUrl + "/api/camunda/common/taskNotify?type=" + type + "&amp;instanceId=" + instanceId, JSON.stringify(data));
              }
              catch(error) {}

              /*************
              UTILITY FUNCTIONS
              *************/
              function httpPost(e,t,n){n=n||"application/json;charset=UTF-8";var a=new java.net.URL(e).openConnection();return a.requestMethod="POST",a.setRequestProperty("Content-Type",n),a.setRequestProperty("Accept-Charset", "UTF-8"),a.doOutput=!0,write(a.outputStream,t),asResponse(a)}function asResponse(e){return{data:read(e.inputStream),statusCode:e.responseCode}}function write(e,t){var n=new java.io.DataOutputStream(e);n.writeChars(t),n.flush(),n.close()}function read(e){for(var t,n=new java.io.BufferedReader(new java.io.InputStreamReader(e)),a=new java.lang.StringBuffer;null!=(t=n.readLine());)a.append(t);return n.close(),a.toString()}</camunda:script></camunda:taskListener><camunda:formData><camunda:formField id="{&#34;id&#34;:&#34;retry&#34;,&#34;label&#34;:&#34;Архивировать&#34;,&#34;type&#34;:&#34;simple&#34;}" type="string" /></camunda:formData></bpmn:extensionElements><bpmn:incoming>SequenceFlow_0v0nibf</bpmn:incoming><bpmn:outgoing>SequenceFlow_0mbbyzv</bpmn:outgoing></bpmn:userTask><bpmn:serviceTask id="ServiceTask_1j8iddj" name="Архивация"><bpmn:extensionElements><camunda:properties><camunda:property name="isEzdocServiceTask" value="true" /><camunda:property name="ezdocServiceTaskType" value="request" /><camunda:property name="requestType" value="GENERIC" /></camunda:properties><camunda:connector><camunda:inputOutput><camunda:inputParameter name="headers"><camunda:map><camunda:entry key="Accept">*/*</camunda:entry><camunda:entry key="Content-Type">application/json</camunda:entry></camunda:map></camunda:inputParameter><camunda:inputParameter name="url">${ezdocUrl}/api/camunda/instance/book/${instanceId}/archive</camunda:inputParameter><camunda:inputParameter name="method">POST</camunda:inputParameter></camunda:inputOutput><camunda:connectorId>http-connector</camunda:connectorId></camunda:connector></bpmn:extensionElements><bpmn:incoming>SequenceFlow_0mbbyzv</bpmn:incoming><bpmn:incoming>SequenceFlow_0g8n1yz</bpmn:incoming><bpmn:outgoing>SequenceFlow_1449yad</bpmn:outgoing></bpmn:serviceTask><bpmn:serviceTask id="ServiceTask_0rl1xal" name="Установка статуса &#34;Архив&#34;"><bpmn:extensionElements><camunda:properties><camunda:property name="isEzdocServiceTask" value="true" /><camunda:property name="ezdocServiceTaskType" value="request" /><camunda:property name="requestType" value="GENERIC" /></camunda:properties><camunda:connector><camunda:inputOutput><camunda:inputParameter name="headers"><camunda:map><camunda:entry key="Accept">*/*</camunda:entry><camunda:entry key="Content-Type">application/json</camunda:entry></camunda:map></camunda:inputParameter><camunda:inputParameter name="url">${ezdocUrl}/api/camunda/instance/book/saveLabel/${instanceId}?label=Архив</camunda:inputParameter><camunda:inputParameter name="method">POST</camunda:inputParameter></camunda:inputOutput><camunda:connectorId>http-connector</camunda:connectorId></camunda:connector></bpmn:extensionElements><bpmn:incoming>SequenceFlow_0ofw0we</bpmn:incoming><bpmn:outgoing>SequenceFlow_1gcfak6</bpmn:outgoing></bpmn:serviceTask><bpmn:sequenceFlow id="SequenceFlow_0mbbyzv" sourceRef="UserTask_00zq93g" targetRef="ServiceTask_1j8iddj" /><bpmn:sequenceFlow id="SequenceFlow_1449yad" sourceRef="ServiceTask_1j8iddj" targetRef="IntermediateCatchEvent_1r0ybt7" /><bpmn:sequenceFlow id="SequenceFlow_1gcfak6" sourceRef="ServiceTask_0rl1xal" targetRef="EndEvent_0nvke4f" /><bpmn:userTask id="UserTask_1rjmihl" name="Кнопка &#34;Архивировать&#34;" camunda:candidateGroups="cb_headmiddleofice, cb_accessadmin, cb_backoffice, jira-users"><bpmn:extensionElements><camunda:properties><camunda:property name="isEzdocTask" value="true" /><camunda:property name="ezdocTaskType" value="buttons" /></camunda:properties><camunda:taskListener event="create"><camunda:script scriptFormat="javascript">try {
              var formData = task.execution.processEngineServices.formService.getTaskFormData(task.id);
              var data = {};
              data.taskId = task.id;
              data.templateId = templateId;
              data.formKey = formData.formKey;
              var formFields = [];
              formData.formFields.forEach(function (a) {formFields.push(a.id)});
              data.formFields = formFields;

              httpPost(ezdocUrl + "/api/camunda/common/taskNotify?type=" + type + "&amp;instanceId=" + instanceId, JSON.stringify(data));
              }
              catch(error) {}

              /*************
              UTILITY FUNCTIONS
              *************/
              function httpPost(e,t,n){n=n||"application/json;charset=UTF-8";var a=new java.net.URL(e).openConnection();return a.requestMethod="POST",a.setRequestProperty("Content-Type",n),a.setRequestProperty("Accept-Charset", "UTF-8"),a.doOutput=!0,write(a.outputStream,t),asResponse(a)}function asResponse(e){return{data:read(e.inputStream),statusCode:e.responseCode}}function write(e,t){var n=new java.io.DataOutputStream(e);n.writeChars(t),n.flush(),n.close()}function read(e){for(var t,n=new java.io.BufferedReader(new java.io.InputStreamReader(e)),a=new java.lang.StringBuffer;null!=(t=n.readLine());)a.append(t);return n.close(),a.toString()}</camunda:script></camunda:taskListener><camunda:formData><camunda:formField id="{&#34;id&#34;:&#34;retry&#34;,&#34;label&#34;:&#34;Архивировать&#34;,&#34;type&#34;:&#34;simple&#34;}" type="string" /></camunda:formData></bpmn:extensionElements><bpmn:incoming>SequenceFlow_01pm3mo</bpmn:incoming><bpmn:incoming>SequenceFlow_0eu4rlp</bpmn:incoming><bpmn:incoming>SequenceFlow_09ihm5h</bpmn:incoming><bpmn:outgoing>SequenceFlow_19jhlm1</bpmn:outgoing></bpmn:userTask><bpmn:serviceTask id="ServiceTask_0z2e3v7" name="Архивация"><bpmn:extensionElements><camunda:properties><camunda:property name="isEzdocServiceTask" value="true" /><camunda:property name="ezdocServiceTaskType" value="request" /><camunda:property name="requestType" value="GENERIC" /></camunda:properties><camunda:connector><camunda:inputOutput><camunda:inputParameter name="headers"><camunda:map><camunda:entry key="Accept">*/*</camunda:entry><camunda:entry key="Content-Type">application/json</camunda:entry></camunda:map></camunda:inputParameter><camunda:inputParameter name="url">${ezdocUrl}/api/camunda/instance/book/${instanceId}/archive</camunda:inputParameter><camunda:inputParameter name="method">POST</camunda:inputParameter></camunda:inputOutput><camunda:connectorId>http-connector</camunda:connectorId></camunda:connector></bpmn:extensionElements><bpmn:incoming>SequenceFlow_19jhlm1</bpmn:incoming><bpmn:outgoing>SequenceFlow_0qbyc2x</bpmn:outgoing></bpmn:serviceTask><bpmn:serviceTask id="ServiceTask_0or4j9x" name="Установка статуса &#34;Архив&#34;"><bpmn:extensionElements><camunda:properties><camunda:property name="isEzdocServiceTask" value="true" /><camunda:property name="ezdocServiceTaskType" value="request" /><camunda:property name="requestType" value="GENERIC" /></camunda:properties><camunda:connector><camunda:inputOutput><camunda:inputParameter name="headers"><camunda:map><camunda:entry key="Accept">*/*</camunda:entry><camunda:entry key="Content-Type">application/json</camunda:entry></camunda:map></camunda:inputParameter><camunda:inputParameter name="url">${ezdocUrl}/api/camunda/instance/book/saveLabel/${instanceId}?label=Архив</camunda:inputParameter><camunda:inputParameter name="method">POST</camunda:inputParameter></camunda:inputOutput><camunda:connectorId>http-connector</camunda:connectorId></camunda:connector></bpmn:extensionElements><bpmn:incoming>SequenceFlow_0sp4gdm</bpmn:incoming><bpmn:outgoing>SequenceFlow_1ijz7f3</bpmn:outgoing></bpmn:serviceTask><bpmn:sequenceFlow id="SequenceFlow_19jhlm1" sourceRef="UserTask_1rjmihl" targetRef="ServiceTask_0z2e3v7" /><bpmn:sequenceFlow id="SequenceFlow_0qbyc2x" sourceRef="ServiceTask_0z2e3v7" targetRef="IntermediateCatchEvent_0omv0cn" /><bpmn:sequenceFlow id="SequenceFlow_01pm3mo" sourceRef="ServiceTask_1q4lky6" targetRef="UserTask_1rjmihl" /><bpmn:sequenceFlow id="SequenceFlow_0eu4rlp" sourceRef="ServiceTask_1nf3wv7" targetRef="UserTask_1rjmihl" /><bpmn:sequenceFlow id="SequenceFlow_1ijz7f3" sourceRef="ServiceTask_0or4j9x" targetRef="EndEvent_12iswgs" /><bpmn:sequenceFlow id="SequenceFlow_0g8n1yz" sourceRef="UserTask_16hqj3x" targetRef="ServiceTask_1j8iddj"><bpmn:conditionExpression xsi:type="bpmn:tFormalExpression">${buttonId == 'arhiv'}</bpmn:conditionExpression></bpmn:sequenceFlow><bpmn:intermediateCatchEvent id="IntermediateCatchEvent_0xow9i1"><bpmn:incoming>SequenceFlow_1o51rfv</bpmn:incoming><bpmn:outgoing>SequenceFlow_0ye5525</bpmn:outgoing><bpmn:timerEventDefinition id="TimerEventDefinition_1wqaowd"><bpmn:timeDuration xsi:type="bpmn:tFormalExpression">PT5S</bpmn:timeDuration></bpmn:timerEventDefinition></bpmn:intermediateCatchEvent><bpmn:sequenceFlow id="SequenceFlow_0ye5525" sourceRef="IntermediateCatchEvent_0xow9i1" targetRef="ServiceTask_09t4e6t" /><bpmn:intermediateCatchEvent id="IntermediateCatchEvent_0omv0cn"><bpmn:incoming>SequenceFlow_0qbyc2x</bpmn:incoming><bpmn:outgoing>SequenceFlow_0sp4gdm</bpmn:outgoing><bpmn:timerEventDefinition id="TimerEventDefinition_13a5xjt"><bpmn:timeDuration xsi:type="bpmn:tFormalExpression">PT5S</bpmn:timeDuration></bpmn:timerEventDefinition></bpmn:intermediateCatchEvent><bpmn:sequenceFlow id="SequenceFlow_0sp4gdm" sourceRef="IntermediateCatchEvent_0omv0cn" targetRef="ServiceTask_0or4j9x" /><bpmn:intermediateCatchEvent id="IntermediateCatchEvent_1r0ybt7"><bpmn:incoming>SequenceFlow_1449yad</bpmn:incoming><bpmn:outgoing>SequenceFlow_0ofw0we</bpmn:outgoing><bpmn:timerEventDefinition id="TimerEventDefinition_0bszfah"><bpmn:timeDuration xsi:type="bpmn:tFormalExpression">PT5S</bpmn:timeDuration></bpmn:timerEventDefinition></bpmn:intermediateCatchEvent><bpmn:sequenceFlow id="SequenceFlow_0ofw0we" sourceRef="IntermediateCatchEvent_1r0ybt7" targetRef="ServiceTask_0rl1xal" /><bpmn:serviceTask id="ServiceTask_1g0fkru" name="Создаем учетку"><bpmn:extensionElements><camunda:connector><camunda:inputOutput><camunda:inputParameter name="url">${ezdocUrl}/api/users</camunda:inputParameter><camunda:inputParameter name="method">POST</camunda:inputParameter><camunda:inputParameter name="headers"><camunda:map><camunda:entry key="Accept">*/*</camunda:entry><camunda:entry key="Content-Type">application/json</camunda:entry></camunda:map></camunda:inputParameter><camunda:inputParameter name="payload"><camunda:script scriptFormat="javascript">S("{}")
.prop("login", hlk_mobile_phone)
.prop("firstName", name)
.prop("lastName", lastName)
.prop("fullName", ShortName)
.prop("email", mail ? mail : "null")
.prop("roles", ["Client"])
.prop("type", "LOCAL")
.prop("password", hash)
.prop("hashPassword", true)
.prop("active", true)
.prop("changePassword" , true)
.prop("phone", hlk_mobile_phone)
.prop("state", "ACTIVE")
.prop("createdBy", S("{}")
.prop("collection","individualPerson")
.prop("id", hlk_client_app))
.toString()</camunda:script></camunda:inputParameter></camunda:inputOutput><camunda:connectorId>http-connector</camunda:connectorId></camunda:connector></bpmn:extensionElements><bpmn:incoming>SequenceFlow_1t3trli</bpmn:incoming><bpmn:outgoing>SequenceFlow_0jeuhsd</bpmn:outgoing></bpmn:serviceTask><bpmn:serviceTask id="ServiceTask_1ky2tca" name="генерим учетку"><bpmn:extensionElements><camunda:connector><camunda:inputOutput><camunda:inputParameter name="url">${ezdocUrl}/api/password/generate</camunda:inputParameter><camunda:inputParameter name="method">GET</camunda:inputParameter><camunda:inputParameter name="headers"><camunda:map><camunda:entry key="Accept">*/*</camunda:entry><camunda:entry key="Content-Type">application/json</camunda:entry></camunda:map></camunda:inputParameter><camunda:outputParameter name="password"><camunda:script scriptFormat="javascript">JSON.parse(response).password</camunda:script></camunda:outputParameter><camunda:outputParameter name="hash"><camunda:script scriptFormat="javascript">JSON.parse(response).passowrdHash</camunda:script></camunda:outputParameter></camunda:inputOutput><camunda:connectorId>http-connector</camunda:connectorId></camunda:connector></bpmn:extensionElements><bpmn:incoming>SequenceFlow_11krs1g</bpmn:incoming><bpmn:outgoing>SequenceFlow_1t3trli</bpmn:outgoing></bpmn:serviceTask><bpmn:sequenceFlow id="SequenceFlow_1t3trli" sourceRef="ServiceTask_1ky2tca" targetRef="ServiceTask_1g0fkru" /><bpmn:serviceTask id="ServiceTask_0kljyn1" name="Получаем аттрибуты"><bpmn:extensionElements><camunda:properties><camunda:property name="isEzdocServiceTask" value="true" /><camunda:property name="ezdocServiceTaskType" value="request" /><camunda:property name="requestType" value="GENERIC" /></camunda:properties><camunda:connector><camunda:inputOutput><camunda:inputParameter name="headers"><camunda:map><camunda:entry key="Accept">*/*</camunda:entry><camunda:entry key="Content-Type">application/json</camunda:entry></camunda:map></camunda:inputParameter><camunda:inputParameter name="url">${ezdocUrl}/api/camunda/instance/individual/${referenceId}/getAttributes?systemName=hlk_mobile_phone&amp;systemName=hlk_email&amp;systemName=hlk_firstname&amp;systemName=hlk_lastname&amp;systemName=ShortName&amp;systemName=hlk_partner_id</camunda:inputParameter><camunda:inputParameter name="method">GET</camunda:inputParameter><camunda:outputParameter name="mail"><camunda:script scriptFormat="javascript">try{
JSON.parse(response).hlk_email;
} catch(e) {
false;
}</camunda:script></camunda:outputParameter><camunda:outputParameter name="name"><camunda:script scriptFormat="javascript">try{
JSON.parse(response).hlk_firstname;
} catch(e) {
false;
}</camunda:script></camunda:outputParameter><camunda:outputParameter name="lastName"><camunda:script scriptFormat="javascript">try{
JSON.parse(response).hlk_lastname;
} catch(e) {
false;
}</camunda:script></camunda:outputParameter><camunda:outputParameter name="ShortName"><camunda:script scriptFormat="javascript">try{
JSON.parse(response).ShortName;
} catch(e) {
false;
}</camunda:script></camunda:outputParameter><camunda:outputParameter name="clientPrimaryId"><camunda:script scriptFormat="javascript">try{
JSON.parse(response).hlk_partner_id;
} catch(e) {
false;
}</camunda:script></camunda:outputParameter></camunda:inputOutput><camunda:connectorId>http-connector</camunda:connectorId></camunda:connector></bpmn:extensionElements><bpmn:incoming>SequenceFlow_05tqajp</bpmn:incoming><bpmn:outgoing>SequenceFlow_11krs1g</bpmn:outgoing></bpmn:serviceTask><bpmn:sequenceFlow id="SequenceFlow_11krs1g" sourceRef="ServiceTask_0kljyn1" targetRef="ServiceTask_1ky2tca" /><bpmn:serviceTask id="ServiceTask_0mfco4f" name="Получаем инстанс айди выбранного клиента"><bpmn:extensionElements><camunda:connector><camunda:inputOutput><camunda:inputParameter name="url">${ezdocUrl}/api/camunda/instance/book/${instanceId}/getRefId/hlk_client_app</camunda:inputParameter><camunda:inputParameter name="method">GET</camunda:inputParameter><camunda:inputParameter name="headers"><camunda:map><camunda:entry key="Accept">*/*</camunda:entry></camunda:map></camunda:inputParameter><camunda:outputParameter name="referenceId">${response}</camunda:outputParameter></camunda:inputOutput><camunda:connectorId>http-connector</camunda:connectorId></camunda:connector></bpmn:extensionElements><bpmn:incoming>SequenceFlow_1upfqqp</bpmn:incoming><bpmn:outgoing>SequenceFlow_05tqajp</bpmn:outgoing></bpmn:serviceTask><bpmn:sequenceFlow id="SequenceFlow_1upfqqp" sourceRef="ServiceTask_13962ax" targetRef="ServiceTask_0mfco4f" /><bpmn:sequenceFlow id="SequenceFlow_05tqajp" sourceRef="ServiceTask_0mfco4f" targetRef="ServiceTask_0kljyn1" /><bpmn:serviceTask id="ServiceTask_03opyk2" name="Записываем"><bpmn:extensionElements><camunda:connector><camunda:inputOutput><camunda:inputParameter name="url">${ezdocUrl}/api/camunda/instance/individual/${referenceId}/setAttribute/hlk_pass_hash?incrementVersion=false&amp;value=${hash}</camunda:inputParameter><camunda:inputParameter name="method">POST</camunda:inputParameter><camunda:inputParameter name="headers"><camunda:map><camunda:entry key="Accept">*/*</camunda:entry></camunda:map></camunda:inputParameter></camunda:inputOutput><camunda:connectorId>http-connector</camunda:connectorId></camunda:connector></bpmn:extensionElements><bpmn:incoming>SequenceFlow_0jeuhsd</bpmn:incoming><bpmn:outgoing>SequenceFlow_0pirbie</bpmn:outgoing></bpmn:serviceTask><bpmn:serviceTask id="ServiceTask_0my8nbr" name="Записываем"><bpmn:extensionElements><camunda:connector><camunda:inputOutput><camunda:inputParameter name="url">${ezdocUrl}/api/camunda/instance/individual/${referenceId}/setAttribute/hlk_client_login?incrementVersion=false&amp;value=${hlk_mobile_phone}</camunda:inputParameter><camunda:inputParameter name="method">POST</camunda:inputParameter><camunda:inputParameter name="headers"><camunda:map><camunda:entry key="Accept">*/*</camunda:entry></camunda:map></camunda:inputParameter></camunda:inputOutput><camunda:connectorId>http-connector</camunda:connectorId></camunda:connector></bpmn:extensionElements><bpmn:incoming>SequenceFlow_0pirbie</bpmn:incoming><bpmn:outgoing>SequenceFlow_03cb6tu</bpmn:outgoing></bpmn:serviceTask><bpmn:sequenceFlow id="SequenceFlow_0pirbie" sourceRef="ServiceTask_03opyk2" targetRef="ServiceTask_0my8nbr" /><bpmn:sequenceFlow id="SequenceFlow_03cb6tu" sourceRef="ServiceTask_0my8nbr" targetRef="ServiceTask_03blio5" /><bpmn:exclusiveGateway id="Gateway_06idv35" default="Flow_0ognha1"><bpmn:incoming>SequenceFlow_0z4k2fn</bpmn:incoming><bpmn:outgoing>Flow_0ognha1</bpmn:outgoing><bpmn:outgoing>Flow_02vyuxa</bpmn:outgoing></bpmn:exclusiveGateway><bpmn:sequenceFlow id="Flow_0ognha1" sourceRef="Gateway_06idv35" targetRef="Task_0micukk" /><bpmn:sequenceFlow id="Flow_02vyuxa" name="МП" sourceRef="Gateway_06idv35" targetRef="Activity_0em0qo1"><bpmn:conditionExpression xsi:type="bpmn:tFormalExpression">${source  == "Мобильное приложение"}</bpmn:conditionExpression></bpmn:sequenceFlow><bpmn:exclusiveGateway id="Gateway_0q58c4k" default="Flow_1pu94n9"><bpmn:incoming>SequenceFlow_00ne59m</bpmn:incoming><bpmn:outgoing>Flow_1pu94n9</bpmn:outgoing><bpmn:outgoing>Flow_104ac5z</bpmn:outgoing></bpmn:exclusiveGateway><bpmn:sequenceFlow id="Flow_1pu94n9" sourceRef="Gateway_0q58c4k" targetRef="UserTask_1ndz30w" /><bpmn:serviceTask id="Activity_0f82yz0" name="Установка статуса &#34;Заявка отклонена&#34;"><bpmn:extensionElements><camunda:properties><camunda:property name="isEzdocServiceTask" value="true" /><camunda:property name="ezdocServiceTaskType" value="request" /><camunda:property name="requestType" value="GENERIC" /></camunda:properties><camunda:connector><camunda:inputOutput><camunda:inputParameter name="headers"><camunda:map><camunda:entry key="Accept">*/*</camunda:entry><camunda:entry key="Content-Type">application/json</camunda:entry></camunda:map></camunda:inputParameter><camunda:inputParameter name="url">${ezdocUrl}/api/camunda/instance/book/saveLabel/${instanceId}?label=Заявка+отменена</camunda:inputParameter><camunda:inputParameter name="method">POST</camunda:inputParameter></camunda:inputOutput><camunda:connectorId>http-connector</camunda:connectorId></camunda:connector></bpmn:extensionElements><bpmn:incoming>Flow_104ac5z</bpmn:incoming><bpmn:outgoing>Flow_13rlps8</bpmn:outgoing></bpmn:serviceTask><bpmn:sequenceFlow id="Flow_104ac5z" name="МП" sourceRef="Gateway_0q58c4k" targetRef="Activity_0f82yz0"><bpmn:conditionExpression xsi:type="bpmn:tFormalExpression">${source  == "Мобильное приложение"}</bpmn:conditionExpression></bpmn:sequenceFlow><bpmn:endEvent id="Event_0y07o51"><bpmn:incoming>Flow_13rlps8</bpmn:incoming></bpmn:endEvent><bpmn:sequenceFlow id="Flow_13rlps8" sourceRef="Activity_0f82yz0" targetRef="Event_0y07o51" /><bpmn:exclusiveGateway id="Gateway_0dx88ba" default="Flow_1wlvudv"><bpmn:incoming>SequenceFlow_0i5xnfx</bpmn:incoming><bpmn:outgoing>Flow_1wlvudv</bpmn:outgoing><bpmn:outgoing>Flow_1h734j8</bpmn:outgoing></bpmn:exclusiveGateway><bpmn:sequenceFlow id="Flow_1wlvudv" sourceRef="Gateway_0dx88ba" targetRef="Task_0micukk" /><bpmn:endEvent id="Event_0d62ib1"><bpmn:incoming>Flow_1h734j8</bpmn:incoming></bpmn:endEvent><bpmn:sequenceFlow id="Flow_1h734j8" name="МП" sourceRef="Gateway_0dx88ba" targetRef="Event_0d62ib1"><bpmn:conditionExpression xsi:type="bpmn:tFormalExpression">${source  == "Мобильное приложение"}</bpmn:conditionExpression></bpmn:sequenceFlow><bpmn:exclusiveGateway id="Gateway_1cm5ela" default="Flow_1nghlbi"><bpmn:incoming>SequenceFlow_027horx</bpmn:incoming><bpmn:outgoing>Flow_1nghlbi</bpmn:outgoing><bpmn:outgoing>Flow_11ldmrx</bpmn:outgoing></bpmn:exclusiveGateway><bpmn:sequenceFlow id="Flow_1nghlbi" sourceRef="Gateway_1cm5ela" targetRef="UserTask_16hqj3x" /><bpmn:sequenceFlow id="Flow_11ldmrx" name="МП" sourceRef="Gateway_1cm5ela" targetRef="ServiceTask_05lrfm8"><bpmn:conditionExpression xsi:type="bpmn:tFormalExpression">${source  == "Мобильное приложение"}</bpmn:conditionExpression></bpmn:sequenceFlow><bpmn:serviceTask id="Activity_12gmm1b" name="определяем источник"><bpmn:extensionElements><camunda:connector><camunda:inputOutput><camunda:inputParameter name="url">${ezdocUrl}/api/camunda/instance/book/${instanceId}/getAttribute/hlk_source_doc</camunda:inputParameter><camunda:inputParameter name="headers"><camunda:map><camunda:entry key="Accept">*/*</camunda:entry></camunda:map></camunda:inputParameter><camunda:inputParameter name="method">GET</camunda:inputParameter><camunda:outputParameter name="source">${response}</camunda:outputParameter></camunda:inputOutput><camunda:connectorId>http-connector</camunda:connectorId></camunda:connector></bpmn:extensionElements><bpmn:incoming>SequenceFlow_0or7jn6</bpmn:incoming><bpmn:outgoing>Flow_0xmgo8t</bpmn:outgoing></bpmn:serviceTask><bpmn:sequenceFlow id="Flow_0xmgo8t" sourceRef="Activity_12gmm1b" targetRef="ServiceTask_0b2tg5h" /><bpmn:serviceTask id="Activity_0em0qo1" name="Получение поля &#34;Клиент&#34;"><bpmn:extensionElements><camunda:properties><camunda:property name="isEzdocServiceTask" value="true" /><camunda:property name="ezdocServiceTaskType" value="request" /><camunda:property name="requestType" value="GENERIC" /></camunda:properties><camunda:connector><camunda:inputOutput><camunda:inputParameter name="headers"><camunda:map><camunda:entry key="Accept">*/*</camunda:entry><camunda:entry key="Content-Type">application/json</camunda:entry></camunda:map></camunda:inputParameter><camunda:inputParameter name="url">${ezdocUrl}/api/camunda/instance/book/${instanceId}/getAttribute/hlk_client_app</camunda:inputParameter><camunda:inputParameter name="method">GET</camunda:inputParameter><camunda:outputParameter name="hlk_client_app">${response}</camunda:outputParameter></camunda:inputOutput><camunda:connectorId>http-connector</camunda:connectorId></camunda:connector></bpmn:extensionElements><bpmn:incoming>Flow_02vyuxa</bpmn:incoming><bpmn:outgoing>Flow_03mb09o</bpmn:outgoing></bpmn:serviceTask><bpmn:sequenceFlow id="Flow_03mb09o" sourceRef="Activity_0em0qo1" targetRef="ServiceTask_0pwhj6s" /><bpmn:sequenceFlow id="SequenceFlow_0jeuhsd" sourceRef="ServiceTask_1g0fkru" targetRef="ServiceTask_03opyk2" /><bpmn:scriptTask id="ScriptTask_0sj004j" scriptFormat="javascript"><bpmn:incoming>SequenceFlow_08dy311</bpmn:incoming><bpmn:outgoing>SequenceFlow_097focr</bpmn:outgoing><bpmn:script>function sleep(ms) {
ms += new Date().getTime();
while (new Date() &lt; ms){}
} 

sleep(5000)</bpmn:script></bpmn:scriptTask><bpmn:sequenceFlow id="SequenceFlow_097focr" sourceRef="ScriptTask_0sj004j" targetRef="ServiceTask_01y3qlq" /><bpmn:serviceTask id="ServiceTask_0gne7iq" name="Сброс в ФЛ признака отправки в фокус и терминал"><bpmn:extensionElements><camunda:properties><camunda:property name="isEzdocServiceTask" value="true" /><camunda:property name="ezdocServiceTaskType" value="request" /><camunda:property name="requestType" value="GENERIC" /></camunda:properties><camunda:connector><camunda:inputOutput><camunda:inputParameter name="headers"><camunda:map><camunda:entry key="Accept">*/*</camunda:entry><camunda:entry key="Content-Type">application/json</camunda:entry></camunda:map></camunda:inputParameter><camunda:inputParameter name="url">${ezdocUrl}/api/camunda/instance/individual/${referenceId1}/setAttributes?incrementVersion=false</camunda:inputParameter><camunda:inputParameter name="method">POST</camunda:inputParameter><camunda:inputParameter name="payload"><camunda:script scriptFormat="javascript">S("{}")
.prop("export_terminal", false)
.prop("export_focus", false)
.toString()</camunda:script></camunda:inputParameter><camunda:outputParameter name="rrr">${response}</camunda:outputParameter></camunda:inputOutput><camunda:connectorId>http-connector</camunda:connectorId></camunda:connector></bpmn:extensionElements><bpmn:incoming>SequenceFlow_0ux8ato</bpmn:incoming><bpmn:outgoing>SequenceFlow_143ap96</bpmn:outgoing></bpmn:serviceTask><bpmn:sequenceFlow id="SequenceFlow_143ap96" sourceRef="ServiceTask_0gne7iq" targetRef="EndEvent_0djl7a3" /><bpmn:serviceTask id="ServiceTask_01y3qlq" name="Сброс в ФЛ признака отправки в фокус и терминал"><bpmn:extensionElements><camunda:properties><camunda:property name="isEzdocServiceTask" value="true" /><camunda:property name="ezdocServiceTaskType" value="request" /><camunda:property name="requestType" value="GENERIC" /></camunda:properties><camunda:connector><camunda:inputOutput><camunda:inputParameter name="headers"><camunda:map><camunda:entry key="Accept">*/*</camunda:entry><camunda:entry key="Content-Type">application/json</camunda:entry></camunda:map></camunda:inputParameter><camunda:inputParameter name="url">${ezdocUrl}/api/camunda/instance/book/${contract_id}/setAttributes?incrementVersion=false</camunda:inputParameter><camunda:inputParameter name="method">POST</camunda:inputParameter><camunda:inputParameter name="payload"><camunda:script scriptFormat="javascript">S("{}")
.prop("export_terminal", false)
.toString()</camunda:script></camunda:inputParameter><camunda:outputParameter name="rrr">${response}</camunda:outputParameter></camunda:inputOutput><camunda:connectorId>http-connector</camunda:connectorId></camunda:connector></bpmn:extensionElements><bpmn:incoming>SequenceFlow_097focr</bpmn:incoming><bpmn:outgoing>SequenceFlow_0mt0zl9</bpmn:outgoing></bpmn:serviceTask><bpmn:sequenceFlow id="SequenceFlow_0mt0zl9" sourceRef="ServiceTask_01y3qlq" targetRef="ServiceTask_0v5wugs" /><bpmn:scriptTask id="Activity_0f5n612" name="Декодируем url для отправки причины отклонения" scriptFormat="groovy" camunda:resultVariable="hlk_reason_close"><bpmn:incoming>SequenceFlow_07tm4dw</bpmn:incoming><bpmn:outgoing>Flow_0e80d73</bpmn:outgoing><bpmn:script>import groovy.*

def hlk_reason_close = execution.getVariable("hlk_reason_close")

hlk_reason_return = java.net.URLEncoder.encode(hlk_reason_close, "UTF-8")</bpmn:script></bpmn:scriptTask><bpmn:sequenceFlow id="Flow_0e80d73" sourceRef="Activity_0f5n612" targetRef="ServiceTask_0u57waj" /></bpmn:process><bpmndi:BPMNDiagram id="BPMNDiagram_1"><bpmndi:BPMNPlane id="BPMNPlane_1" bpmnElement="TEMPLATE_INSTANCE_PROCESS_hlk_app_sms_59354641-a121-4bd0-a570-54efa91bb4ec"><bpmndi:BPMNEdge id="Flow_0e80d73_di" bpmnElement="Flow_0e80d73"><di:waypoint x="3264" y="970" /><di:waypoint x="3264" y="1030" /></bpmndi:BPMNEdge><bpmndi:BPMNEdge id="SequenceFlow_0mt0zl9_di" bpmnElement="SequenceFlow_0mt0zl9"><di:waypoint x="5100" y="534" /><di:waypoint x="5154" y="534" /></bpmndi:BPMNEdge><bpmndi:BPMNEdge id="SequenceFlow_143ap96_di" bpmnElement="SequenceFlow_143ap96"><di:waypoint x="5520" y="534" /><di:waypoint x="5562" y="534" /></bpmndi:BPMNEdge><bpmndi:BPMNEdge id="SequenceFlow_097focr_di" bpmnElement="SequenceFlow_097focr"><di:waypoint x="4930" y="534" /><di:waypoint x="5000" y="534" /></bpmndi:BPMNEdge><bpmndi:BPMNEdge id="SequenceFlow_0jeuhsd_di" bpmnElement="SequenceFlow_0jeuhsd"><di:waypoint x="4220" y="534" /><di:waypoint x="4290" y="534" /></bpmndi:BPMNEdge><bpmndi:BPMNEdge id="Flow_03mb09o_di" bpmnElement="Flow_03mb09o"><di:waypoint x="1556" y="450" /><di:waypoint x="1995" y="450" /><di:waypoint x="1995" y="494" /></bpmndi:BPMNEdge><bpmndi:BPMNEdge id="Flow_0xmgo8t_di" bpmnElement="Flow_0xmgo8t"><di:waypoint x="360" y="534" /><di:waypoint x="420" y="534" /></bpmndi:BPMNEdge><bpmndi:BPMNEdge id="Flow_11ldmrx_di" bpmnElement="Flow_11ldmrx"><di:waypoint x="3133" y="559" /><di:waypoint x="3133" y="640" /><di:waypoint x="3413" y="640" /><di:waypoint x="3413" y="574" /><bpmndi:BPMNLabel><dc:Bounds x="3141" y="598" width="18" height="14" /></bpmndi:BPMNLabel></bpmndi:BPMNEdge><bpmndi:BPMNEdge id="Flow_1nghlbi_di" bpmnElement="Flow_1nghlbi"><di:waypoint x="3158" y="534" /><di:waypoint x="3214" y="534" /></bpmndi:BPMNEdge><bpmndi:BPMNEdge id="Flow_1h734j8_di" bpmnElement="Flow_1h734j8"><di:waypoint x="2684" y="718" /><di:waypoint x="2684" y="772" /><bpmndi:BPMNLabel><dc:Bounds x="2690" y="738" width="18" height="14" /></bpmndi:BPMNLabel></bpmndi:BPMNEdge><bpmndi:BPMNEdge id="Flow_1wlvudv_di" bpmnElement="Flow_1wlvudv"><di:waypoint x="2659" y="693" /><di:waypoint x="1027" y="693" /><di:waypoint x="1027" y="574" /></bpmndi:BPMNEdge><bpmndi:BPMNEdge id="Flow_13rlps8_di" bpmnElement="Flow_13rlps8"><di:waypoint x="2350" y="240" /><di:waypoint x="2350" y="188" /></bpmndi:BPMNEdge><bpmndi:BPMNEdge id="Flow_104ac5z_di" bpmnElement="Flow_104ac5z"><di:waypoint x="2350" y="387" /><di:waypoint x="2350" y="320" /><bpmndi:BPMNLabel><dc:Bounds x="2356" y="366" width="18" height="14" /></bpmndi:BPMNLabel></bpmndi:BPMNEdge><bpmndi:BPMNEdge id="Flow_1pu94n9_di" bpmnElement="Flow_1pu94n9"><di:waypoint x="2375" y="412" /><di:waypoint x="2418" y="412" /></bpmndi:BPMNEdge><bpmndi:BPMNEdge id="Flow_02vyuxa_di" bpmnElement="Flow_02vyuxa"><di:waypoint x="900" y="509" /><di:waypoint x="900" y="450" /><di:waypoint x="1456" y="450" /><bpmndi:BPMNLabel><dc:Bounds x="871" y="463" width="18" height="14" /></bpmndi:BPMNLabel></bpmndi:BPMNEdge><bpmndi:BPMNEdge id="Flow_0ognha1_di" bpmnElement="Flow_0ognha1"><di:waypoint x="925" y="534" /><di:waypoint x="977" y="534" /></bpmndi:BPMNEdge><bpmndi:BPMNEdge id="SequenceFlow_03cb6tu_di" bpmnElement="SequenceFlow_03cb6tu"><di:waypoint x="4520" y="534" /><di:waypoint x="4540" y="534" /></bpmndi:BPMNEdge><bpmndi:BPMNEdge id="SequenceFlow_0pirbie_di" bpmnElement="SequenceFlow_0pirbie"><di:waypoint x="4390" y="534" /><di:waypoint x="4420" y="534" /></bpmndi:BPMNEdge><bpmndi:BPMNEdge id="SequenceFlow_05tqajp_di" bpmnElement="SequenceFlow_05tqajp"><di:waypoint x="3720" y="534" /><di:waypoint x="3750" y="534" /></bpmndi:BPMNEdge><bpmndi:BPMNEdge id="SequenceFlow_1upfqqp_di" bpmnElement="SequenceFlow_1upfqqp"><di:waypoint x="3598" y="534" /><di:waypoint x="3620" y="534" /></bpmndi:BPMNEdge><bpmndi:BPMNEdge id="SequenceFlow_11krs1g_di" bpmnElement="SequenceFlow_11krs1g"><di:waypoint x="3850" y="534" /><di:waypoint x="3940" y="534" /></bpmndi:BPMNEdge><bpmndi:BPMNEdge id="SequenceFlow_1t3trli_di" bpmnElement="SequenceFlow_1t3trli"><di:waypoint x="4040" y="534" /><di:waypoint x="4120" y="534" /></bpmndi:BPMNEdge><bpmndi:BPMNEdge id="SequenceFlow_0ofw0we_di" bpmnElement="SequenceFlow_0ofw0we"><di:waypoint x="2976" y="412" /><di:waypoint x="2997" y="412" /></bpmndi:BPMNEdge><bpmndi:BPMNEdge id="SequenceFlow_0sp4gdm_di" bpmnElement="SequenceFlow_0sp4gdm"><di:waypoint x="2702" y="1263" /><di:waypoint x="2745" y="1263" /></bpmndi:BPMNEdge><bpmndi:BPMNEdge id="SequenceFlow_0ye5525_di" bpmnElement="SequenceFlow_0ye5525"><di:waypoint x="1968" y="150" /><di:waypoint x="2006" y="150" /></bpmndi:BPMNEdge><bpmndi:BPMNEdge id="SequenceFlow_0g8n1yz_di" bpmnElement="SequenceFlow_0g8n1yz"><di:waypoint x="3240" y="494" /><di:waypoint x="3240" y="330" /><di:waypoint x="2860" y="330" /><di:waypoint x="2860" y="380" /></bpmndi:BPMNEdge><bpmndi:BPMNEdge id="SequenceFlow_1ijz7f3_di" bpmnElement="SequenceFlow_1ijz7f3"><di:waypoint x="2845" y="1263" /><di:waypoint x="2878" y="1263" /></bpmndi:BPMNEdge><bpmndi:BPMNEdge id="SequenceFlow_0eu4rlp_di" bpmnElement="SequenceFlow_0eu4rlp"><di:waypoint x="2846" y="1043" /><di:waypoint x="2745" y="1043" /><di:waypoint x="2745" y="1148" /><di:waypoint x="2644" y="1148" /></bpmndi:BPMNEdge><bpmndi:BPMNEdge id="SequenceFlow_01pm3mo_di" bpmnElement="SequenceFlow_01pm3mo"><di:waypoint x="2594" y="1077" /><di:waypoint x="2594" y="1108" /></bpmndi:BPMNEdge><bpmndi:BPMNEdge id="SequenceFlow_0qbyc2x_di" bpmnElement="SequenceFlow_0qbyc2x"><di:waypoint x="2644" y="1263" /><di:waypoint x="2666" y="1263" /></bpmndi:BPMNEdge><bpmndi:BPMNEdge id="SequenceFlow_19jhlm1_di" bpmnElement="SequenceFlow_19jhlm1"><di:waypoint x="2594" y="1188" /><di:waypoint x="2594" y="1223" /></bpmndi:BPMNEdge><bpmndi:BPMNEdge id="SequenceFlow_1gcfak6_di" bpmnElement="SequenceFlow_1gcfak6"><di:waypoint x="3097" y="412" /><di:waypoint x="3115" y="412" /></bpmndi:BPMNEdge><bpmndi:BPMNEdge id="SequenceFlow_1449yad_di" bpmnElement="SequenceFlow_1449yad"><di:waypoint x="2910" y="420" /><di:waypoint x="2925" y="420" /><di:waypoint x="2925" y="412" /><di:waypoint x="2940" y="412" /></bpmndi:BPMNEdge><bpmndi:BPMNEdge id="SequenceFlow_0mbbyzv_di" bpmnElement="SequenceFlow_0mbbyzv"><di:waypoint x="2790" y="412" /><di:waypoint x="2800" y="412" /><di:waypoint x="2800" y="420" /><di:waypoint x="2810" y="420" /></bpmndi:BPMNEdge><bpmndi:BPMNEdge id="SequenceFlow_0p4qmyb_di" bpmnElement="SequenceFlow_0p4qmyb"><di:waypoint x="2106" y="150" /><di:waypoint x="2162" y="150" /></bpmndi:BPMNEdge><bpmndi:BPMNEdge id="SequenceFlow_0yxwm19_di" bpmnElement="SequenceFlow_0yxwm19"><di:waypoint x="1843" y="210" /><di:waypoint x="1843" y="190" /></bpmndi:BPMNEdge><bpmndi:BPMNEdge id="SequenceFlow_04159u3_di" bpmnElement="SequenceFlow_04159u3"><di:waypoint x="1843" y="320" /><di:waypoint x="1843" y="290" /></bpmndi:BPMNEdge><bpmndi:BPMNEdge id="SequenceFlow_09ihm5h_di" bpmnElement="SequenceFlow_09ihm5h"><di:waypoint x="3264" y="1110" /><di:waypoint x="3264" y="1161" /><di:waypoint x="2644" y="1161" /></bpmndi:BPMNEdge><bpmndi:BPMNEdge id="SequenceFlow_1gvxnaj_di" bpmnElement="SequenceFlow_1gvxnaj"><di:waypoint x="2468" y="372" /><di:waypoint x="2468" y="90" /><di:waypoint x="780" y="90" /><di:waypoint x="780" y="494" /></bpmndi:BPMNEdge><bpmndi:BPMNEdge id="SequenceFlow_00ne59m_di" bpmnElement="SequenceFlow_00ne59m"><di:waypoint x="2284" y="412" /><di:waypoint x="2325" y="412" /></bpmndi:BPMNEdge><bpmndi:BPMNEdge id="SequenceFlow_0v0nibf_di" bpmnElement="SequenceFlow_0v0nibf"><di:waypoint x="2660" y="412" /><di:waypoint x="2690" y="412" /></bpmndi:BPMNEdge><bpmndi:BPMNEdge id="SequenceFlow_0shw5yd_di" bpmnElement="SequenceFlow_0shw5yd"><di:waypoint x="2518" y="412" /><di:waypoint x="2560" y="412" /></bpmndi:BPMNEdge><bpmndi:BPMNEdge id="SequenceFlow_0lnhfak_di" bpmnElement="SequenceFlow_0lnhfak"><di:waypoint x="2594" y="959" /><di:waypoint x="2594" y="997" /></bpmndi:BPMNEdge><bpmndi:BPMNEdge id="SequenceFlow_0zgi4li_di" bpmnElement="SequenceFlow_0zgi4li"><di:waypoint x="2045" y="534" /><di:waypoint x="2080" y="534" /></bpmndi:BPMNEdge><bpmndi:BPMNEdge id="SequenceFlow_045y2r2_di" bpmnElement="SequenceFlow_045y2r2"><di:waypoint x="2594" y="879" /><di:waypoint x="2594" y="766" /><di:waypoint x="1027" y="766" /><di:waypoint x="1027" y="574" /></bpmndi:BPMNEdge><bpmndi:BPMNEdge id="SequenceFlow_0t947ik_di" bpmnElement="SequenceFlow_0t947ik"><di:waypoint x="2544" y="919" /><di:waypoint x="2515" y="919" /></bpmndi:BPMNEdge><bpmndi:BPMNEdge id="SequenceFlow_11eszkm_di" bpmnElement="SequenceFlow_11eszkm"><di:waypoint x="2669" y="919" /><di:waypoint x="2644" y="919" /></bpmndi:BPMNEdge><bpmndi:BPMNEdge id="SequenceFlow_17etoss_di" bpmnElement="SequenceFlow_17etoss"><di:waypoint x="2234" y="509" /><di:waypoint x="2234" y="452" /></bpmndi:BPMNEdge><bpmndi:BPMNEdge id="SequenceFlow_12gzo7h_di" bpmnElement="SequenceFlow_12gzo7h"><di:waypoint x="2259" y="534" /><di:waypoint x="2415" y="534" /></bpmndi:BPMNEdge><bpmndi:BPMNEdge id="SequenceFlow_1gcorlu_di" bpmnElement="SequenceFlow_1gcorlu"><di:waypoint x="2180" y="534" /><di:waypoint x="2209" y="534" /></bpmndi:BPMNEdge><bpmndi:BPMNEdge id="SequenceFlow_08dy311_di" bpmnElement="SequenceFlow_08dy311"><di:waypoint x="4780" y="534" /><di:waypoint x="4830" y="534" /></bpmndi:BPMNEdge><bpmndi:BPMNEdge id="SequenceFlow_1elj596_di" bpmnElement="SequenceFlow_1elj596"><di:waypoint x="1506" y="559" /><di:waypoint x="1506" y="605" /><di:waypoint x="1050" y="605" /><di:waypoint x="1050" y="574" /></bpmndi:BPMNEdge><bpmndi:BPMNEdge id="SequenceFlow_0bdhcc4_di" bpmnElement="SequenceFlow_0bdhcc4"><di:waypoint x="1465" y="534" /><di:waypoint x="1481" y="534" /></bpmndi:BPMNEdge><bpmndi:BPMNEdge id="SequenceFlow_1grph0u_di" bpmnElement="SequenceFlow_1grph0u"><di:waypoint x="1531" y="534" /><di:waypoint x="1549" y="534" /></bpmndi:BPMNEdge><bpmndi:BPMNEdge id="SequenceFlow_04gbdac_di" bpmnElement="SequenceFlow_04gbdac"><di:waypoint x="1204" y="534" /><di:waypoint x="1235" y="534" /></bpmndi:BPMNEdge><bpmndi:BPMNEdge id="SequenceFlow_1dm8vr6_di" bpmnElement="SequenceFlow_1dm8vr6"><di:waypoint x="1335" y="534" /><di:waypoint x="1365" y="534" /></bpmndi:BPMNEdge><bpmndi:BPMNEdge id="SequenceFlow_1xbx4u7_di" bpmnElement="SequenceFlow_1xbx4u7"><di:waypoint x="1077" y="534" /><di:waypoint x="1104" y="534" /></bpmndi:BPMNEdge><bpmndi:BPMNEdge id="SequenceFlow_1txbxst_di" bpmnElement="SequenceFlow_1txbxst"><di:waypoint x="5254" y="534" /><di:waypoint x="5280" y="534" /></bpmndi:BPMNEdge><bpmndi:BPMNEdge id="SequenceFlow_0ux8ato_di" bpmnElement="SequenceFlow_0ux8ato"><di:waypoint x="5380" y="534" /><di:waypoint x="5420" y="534" /></bpmndi:BPMNEdge><bpmndi:BPMNEdge id="SequenceFlow_1bt4gnv_di" bpmnElement="SequenceFlow_1bt4gnv"><di:waypoint x="3463" y="534" /><di:waypoint x="3498" y="534" /></bpmndi:BPMNEdge><bpmndi:BPMNEdge id="SequenceFlow_0ls7zf0_di" bpmnElement="SequenceFlow_0ls7zf0"><di:waypoint x="1843" y="509" /><di:waypoint x="1843" y="400" /></bpmndi:BPMNEdge><bpmndi:BPMNEdge id="SequenceFlow_1o51rfv_di" bpmnElement="SequenceFlow_1o51rfv"><di:waypoint x="1893" y="150" /><di:waypoint x="1932" y="150" /></bpmndi:BPMNEdge><bpmndi:BPMNEdge id="SequenceFlow_0uzjdgr_di" bpmnElement="SequenceFlow_0uzjdgr"><di:waypoint x="1868" y="534" /><di:waypoint x="1945" y="534" /></bpmndi:BPMNEdge><bpmndi:BPMNEdge id="SequenceFlow_1f3shw6_di" bpmnElement="SequenceFlow_1f3shw6"><di:waypoint x="1649" y="534" /><di:waypoint x="1690" y="534" /></bpmndi:BPMNEdge><bpmndi:BPMNEdge id="SequenceFlow_1mhud6q_di" bpmnElement="SequenceFlow_1mhud6q"><di:waypoint x="1790" y="534" /><di:waypoint x="1818" y="534" /></bpmndi:BPMNEdge><bpmndi:BPMNEdge id="SequenceFlow_0huja8w_di" bpmnElement="SequenceFlow_0huja8w"><di:waypoint x="680" y="534" /><di:waypoint x="730" y="534" /></bpmndi:BPMNEdge><bpmndi:BPMNEdge id="SequenceFlow_0b1i2al_di" bpmnElement="SequenceFlow_0b1i2al"><di:waypoint x="520" y="534" /><di:waypoint x="580" y="534" /></bpmndi:BPMNEdge><bpmndi:BPMNEdge id="SequenceFlow_172apj3_di" bpmnElement="SequenceFlow_172apj3"><di:waypoint x="2415" y="919" /><di:waypoint x="2378" y="919" /></bpmndi:BPMNEdge><bpmndi:BPMNEdge id="SequenceFlow_01ycytw_di" bpmnElement="SequenceFlow_01ycytw"><di:waypoint x="2515" y="534" /><di:waypoint x="2544" y="534" /></bpmndi:BPMNEdge><bpmndi:BPMNEdge id="SequenceFlow_0ufzbsc_di" bpmnElement="SequenceFlow_0ufzbsc"><di:waypoint x="2278" y="919" /><di:waypoint x="2230" y="919" /></bpmndi:BPMNEdge><bpmndi:BPMNEdge id="SequenceFlow_1teh9g9_di" bpmnElement="SequenceFlow_1teh9g9"><di:waypoint x="4640" y="534" /><di:waypoint x="4680" y="534" /></bpmndi:BPMNEdge><bpmndi:BPMNEdge id="SequenceFlow_1fv11n2_di" bpmnElement="SequenceFlow_1fv11n2"><di:waypoint x="2644" y="534" /><di:waypoint x="2669" y="534" /></bpmndi:BPMNEdge><bpmndi:BPMNEdge id="SequenceFlow_0vt3e4g_di" bpmnElement="SequenceFlow_0vt3e4g"><di:waypoint x="3314" y="534" /><di:waypoint x="3363" y="534" /></bpmndi:BPMNEdge><bpmndi:BPMNEdge id="SequenceFlow_12t9lfd_di" bpmnElement="SequenceFlow_12t9lfd"><di:waypoint x="2871" y="919" /><di:waypoint x="2769" y="919" /></bpmndi:BPMNEdge><bpmndi:BPMNEdge id="SequenceFlow_1528m8b_di" bpmnElement="SequenceFlow_1528m8b"><di:waypoint x="2896" y="944" /><di:waypoint x="2896" y="1003" /></bpmndi:BPMNEdge><bpmndi:BPMNEdge id="SequenceFlow_0hp4saz_di" bpmnElement="SequenceFlow_0hp4saz"><di:waypoint x="2896" y="559" /><di:waypoint x="2896" y="894" /></bpmndi:BPMNEdge><bpmndi:BPMNEdge id="SequenceFlow_1ct54zw_di" bpmnElement="SequenceFlow_1ct54zw"><di:waypoint x="2921" y="534" /><di:waypoint x="2970" y="534" /></bpmndi:BPMNEdge><bpmndi:BPMNEdge id="SequenceFlow_06tf44m_di" bpmnElement="SequenceFlow_06tf44m"><di:waypoint x="2816" y="559" /><di:waypoint x="2816" y="653" /></bpmndi:BPMNEdge><bpmndi:BPMNEdge id="SequenceFlow_0i5xnfx_di" bpmnElement="SequenceFlow_0i5xnfx"><di:waypoint x="2766" y="693" /><di:waypoint x="2709" y="693" /></bpmndi:BPMNEdge><bpmndi:BPMNEdge id="SequenceFlow_1smnx1p_di" bpmnElement="SequenceFlow_1smnx1p"><di:waypoint x="2841" y="534" /><di:waypoint x="2871" y="534" /></bpmndi:BPMNEdge><bpmndi:BPMNEdge id="SequenceFlow_14euv6x_di" bpmnElement="SequenceFlow_14euv6x"><di:waypoint x="2769" y="534" /><di:waypoint x="2791" y="534" /></bpmndi:BPMNEdge><bpmndi:BPMNEdge id="SequenceFlow_07tm4dw_di" bpmnElement="SequenceFlow_07tm4dw"><di:waypoint x="3264" y="840" /><di:waypoint x="3264" y="890" /></bpmndi:BPMNEdge><bpmndi:BPMNEdge id="SequenceFlow_16ybaca_di" bpmnElement="SequenceFlow_16ybaca"><di:waypoint x="3264" y="574" /><di:waypoint x="3264" y="760" /></bpmndi:BPMNEdge><bpmndi:BPMNEdge id="SequenceFlow_0bwyp8d_di" bpmnElement="SequenceFlow_0bwyp8d"><di:waypoint x="3264" y="494" /><di:waypoint x="3264" y="80" /><di:waypoint x="780" y="80" /><di:waypoint x="780" y="494" /></bpmndi:BPMNEdge><bpmndi:BPMNEdge id="SequenceFlow_027horx_di" bpmnElement="SequenceFlow_027horx"><di:waypoint x="3070" y="534" /><di:waypoint x="3108" y="534" /></bpmndi:BPMNEdge><bpmndi:BPMNEdge id="SequenceFlow_0z4k2fn_di" bpmnElement="SequenceFlow_0z4k2fn"><di:waypoint x="830" y="534" /><di:waypoint x="875" y="534" /></bpmndi:BPMNEdge><bpmndi:BPMNEdge id="SequenceFlow_0or7jn6_di" bpmnElement="SequenceFlow_0or7jn6"><di:waypoint x="188" y="534" /><di:waypoint x="260" y="534" /><bpmndi:BPMNLabel><dc:Bounds x="228" y="114" width="90" height="12" /></bpmndi:BPMNLabel></bpmndi:BPMNEdge><bpmndi:BPMNShape id="_BPMNShape_StartEvent_2" bpmnElement="StartEvent_1"><dc:Bounds x="152" y="516" width="36" height="36" /></bpmndi:BPMNShape><bpmndi:BPMNShape id="EndEvent_0djl7a3_di" bpmnElement="EndEvent_0djl7a3"><dc:Bounds x="5562" y="516" width="36" height="36" /><bpmndi:BPMNLabel><dc:Bounds x="1064" y="142" width="90" height="12" /></bpmndi:BPMNLabel></bpmndi:BPMNShape><bpmndi:BPMNShape id="UserTask_1quc7do_di" bpmnElement="Task_0micukk" bioc:stroke="rgb(67, 160, 71)" bioc:fill="rgb(200, 230, 201)"><dc:Bounds x="977" y="494" width="100" height="80" /></bpmndi:BPMNShape><bpmndi:BPMNShape id="ServiceTask_18devms_di" bpmnElement="ServiceTask_18devms"><dc:Bounds x="730" y="494" width="100" height="80" /></bpmndi:BPMNShape><bpmndi:BPMNShape id="ServiceTask_0q99htm_di" bpmnElement="ServiceTask_0q99htm"><dc:Bounds x="2970" y="494" width="100" height="80" /></bpmndi:BPMNShape><bpmndi:BPMNShape id="ServiceTask_13962ax_di" bpmnElement="ServiceTask_13962ax"><dc:Bounds x="3498" y="494" width="100" height="80" /></bpmndi:BPMNShape><bpmndi:BPMNShape id="ServiceTask_1rbdr90_di" bpmnElement="ServiceTask_1rbdr90"><dc:Bounds x="3214" y="760" width="100" height="80" /></bpmndi:BPMNShape><bpmndi:BPMNShape id="UserTask_16hqj3x_di" bpmnElement="UserTask_16hqj3x" bioc:stroke="rgb(67, 160, 71)" bioc:fill="rgb(200, 230, 201)"><dc:Bounds x="3214" y="494" width="100" height="80" /></bpmndi:BPMNShape><bpmndi:BPMNShape id="ServiceTask_1x5cn3m_di" bpmnElement="ServiceTask_1x5cn3m"><dc:Bounds x="2669" y="494" width="100" height="80" /></bpmndi:BPMNShape><bpmndi:BPMNShape id="ExclusiveGateway_0imodwe_di" bpmnElement="Gateway_0gdhp0j" isMarkerVisible="true"><dc:Bounds x="2791" y="509" width="50" height="50" /></bpmndi:BPMNShape><bpmndi:BPMNShape id="ServiceTask_0mv5mtb_di" bpmnElement="ServiceTask_0mv5mtb"><dc:Bounds x="1549" y="494" width="100" height="80" /></bpmndi:BPMNShape><bpmndi:BPMNShape id="ServiceTask_18c9j99_di" bpmnElement="ServiceTask_18c9j99"><dc:Bounds x="2766" y="653" width="100" height="80" /></bpmndi:BPMNShape><bpmndi:BPMNShape id="ExclusiveGateway_03wwych_di" bpmnElement="ExclusiveGateway_03wwych" isMarkerVisible="true"><dc:Bounds x="2871" y="509" width="50" height="50" /></bpmndi:BPMNShape><bpmndi:BPMNShape id="ExclusiveGateway_0hywdw9_di" bpmnElement="ExclusiveGateway_0hywdw9" isMarkerVisible="true"><dc:Bounds x="2871" y="894" width="50" height="50" /></bpmndi:BPMNShape><bpmndi:BPMNShape id="ServiceTask_1nf3wv7_di" bpmnElement="ServiceTask_1nf3wv7"><dc:Bounds x="2846" y="1003" width="100" height="80" /></bpmndi:BPMNShape><bpmndi:BPMNShape id="EndEvent_12iswgs_di" bpmnElement="EndEvent_12iswgs"><dc:Bounds x="2878" y="1245" width="36" height="36" /></bpmndi:BPMNShape><bpmndi:BPMNShape id="ServiceTask_0ik9lqw_di" bpmnElement="ServiceTask_0ik9lqw"><dc:Bounds x="2278" y="879" width="100" height="80" /></bpmndi:BPMNShape><bpmndi:BPMNShape id="EndEvent_0bqdc1y_di" bpmnElement="EndEvent_0bqdc1y"><dc:Bounds x="2194" y="901" width="36" height="36" /></bpmndi:BPMNShape><bpmndi:BPMNShape id="ServiceTask_06mylwm_di" bpmnElement="ServiceTask_06mylwm"><dc:Bounds x="2544" y="494" width="100" height="80" /></bpmndi:BPMNShape><bpmndi:BPMNShape id="ServiceTask_03blio5_di" bpmnElement="ServiceTask_03blio5"><dc:Bounds x="4540" y="494" width="100" height="80" /></bpmndi:BPMNShape><bpmndi:BPMNShape id="ServiceTask_1frt25a_di" bpmnElement="ServiceTask_1frt25a"><dc:Bounds x="2415" y="879" width="100" height="80" /></bpmndi:BPMNShape><bpmndi:BPMNShape id="ServiceTask_1bxuff1_di" bpmnElement="ServiceTask_1bxuff1"><dc:Bounds x="2415" y="494" width="100" height="80" /></bpmndi:BPMNShape><bpmndi:BPMNShape id="ServiceTask_0b2tg5h_di" bpmnElement="ServiceTask_0b2tg5h"><dc:Bounds x="420" y="494" width="100" height="80" /></bpmndi:BPMNShape><bpmndi:BPMNShape id="ServiceTask_1ylueft_di" bpmnElement="ServiceTask_1ylueft"><dc:Bounds x="580" y="494" width="100" height="80" /></bpmndi:BPMNShape><bpmndi:BPMNShape id="ServiceTask_02aiuue_di" bpmnElement="ServiceTask_02aiuue"><dc:Bounds x="1690" y="494" width="100" height="80" /></bpmndi:BPMNShape><bpmndi:BPMNShape id="ExclusiveGateway_06k3ccs_di" bpmnElement="ExclusiveGateway_06k3ccs" isMarkerVisible="true"><dc:Bounds x="1818" y="509" width="50" height="50" /></bpmndi:BPMNShape><bpmndi:BPMNShape id="ServiceTask_1az9npp_di" bpmnElement="ServiceTask_1az9npp"><dc:Bounds x="1793" y="320" width="100" height="80" /></bpmndi:BPMNShape><bpmndi:BPMNShape id="EndEvent_1qxd8op_di" bpmnElement="EndEvent_1qxd8op"><dc:Bounds x="2162" y="132" width="36" height="36" /></bpmndi:BPMNShape><bpmndi:BPMNShape id="CallActivity_0s4qhou_di" bpmnElement="ServiceTask_05lrfm8" bioc:stroke="rgb(30, 136, 229)" bioc:fill="rgb(187, 222, 251)"><dc:Bounds x="3363" y="494" width="100" height="80" /></bpmndi:BPMNShape><bpmndi:BPMNShape id="ServiceTask_1o16y0f_di" bpmnElement="ServiceTask_1o16y0f"><dc:Bounds x="5280" y="494" width="100" height="80" /></bpmndi:BPMNShape><bpmndi:BPMNShape id="ServiceTask_0v5wugs_di" bpmnElement="ServiceTask_0v5wugs"><dc:Bounds x="5154" y="494" width="100" height="80" /></bpmndi:BPMNShape><bpmndi:BPMNShape id="ServiceTask_13qjwj0_di" bpmnElement="ServiceTask_13qjwj0"><dc:Bounds x="1104" y="494" width="100" height="80" /></bpmndi:BPMNShape><bpmndi:BPMNShape id="ScriptTask_0oxouxy_di" bpmnElement="ScriptTask_0oxouxy"><dc:Bounds x="1235" y="494" width="100" height="80" /></bpmndi:BPMNShape><bpmndi:BPMNShape id="ServiceTask_05u400x_di" bpmnElement="ServiceTask_05u400x"><dc:Bounds x="1365" y="494" width="100" height="80" /></bpmndi:BPMNShape><bpmndi:BPMNShape id="ExclusiveGateway_0g6drww_di" bpmnElement="ExclusiveGateway_0g6drww" isMarkerVisible="true"><dc:Bounds x="1481" y="509" width="50" height="50" /></bpmndi:BPMNShape><bpmndi:BPMNShape id="ServiceTask_1sq5tgf_di" bpmnElement="ServiceTask_1sq5tgf"><dc:Bounds x="4680" y="494" width="100" height="80" /></bpmndi:BPMNShape><bpmndi:BPMNShape id="ServiceTask_0vimz4i_di" bpmnElement="ServiceTask_0vimz4i"><dc:Bounds x="2080" y="494" width="100" height="80" /></bpmndi:BPMNShape><bpmndi:BPMNShape id="ExclusiveGateway_0pp5mrd_di" bpmnElement="ExclusiveGateway_0pp5mrd" isMarkerVisible="true"><dc:Bounds x="2209" y="509" width="50" height="50" /></bpmndi:BPMNShape><bpmndi:BPMNShape id="ServiceTask_1uliioi_di" bpmnElement="ServiceTask_1uliioi"><dc:Bounds x="2184" y="372" width="100" height="80" /></bpmndi:BPMNShape><bpmndi:BPMNShape id="ServiceTask_1766vpt_di" bpmnElement="ServiceTask_1766vpt"><dc:Bounds x="2669" y="879" width="100" height="80" /></bpmndi:BPMNShape><bpmndi:BPMNShape id="UserTask_1d9hm1w_di" bpmnElement="UserTask_1d9hm1w" bioc:stroke="rgb(67, 160, 71)" bioc:fill="rgb(200, 230, 201)"><dc:Bounds x="2544" y="879" width="100" height="80" /></bpmndi:BPMNShape><bpmndi:BPMNShape id="ServiceTask_10itkun_di" bpmnElement="ServiceTask_10itkun"><dc:Bounds x="2347" y="1003" width="100" height="80" /></bpmndi:BPMNShape><bpmndi:BPMNShape id="ServiceTask_0tqevuh_di" bpmnElement="ServiceTask_0tqevuh"><dc:Bounds x="3420" y="860" width="100" height="80" /></bpmndi:BPMNShape><bpmndi:BPMNShape id="ServiceTask_0pwhj6s_di" bpmnElement="ServiceTask_0pwhj6s"><dc:Bounds x="1945" y="494" width="100" height="80" /></bpmndi:BPMNShape><bpmndi:BPMNShape id="ServiceTask_1q4lky6_di" bpmnElement="ServiceTask_1q4lky6"><dc:Bounds x="2544" y="997" width="100" height="80" /></bpmndi:BPMNShape><bpmndi:BPMNShape id="UserTask_1ndz30w_di" bpmnElement="UserTask_1ndz30w" bioc:stroke="rgb(67, 160, 71)" bioc:fill="rgb(200, 230, 201)"><dc:Bounds x="2418" y="372" width="100" height="80" /></bpmndi:BPMNShape><bpmndi:BPMNShape id="ServiceTask_15s6o4b_di" bpmnElement="ServiceTask_15s6o4b"><dc:Bounds x="2560" y="372" width="100" height="80" /></bpmndi:BPMNShape><bpmndi:BPMNShape id="EndEvent_0nvke4f_di" bpmnElement="EndEvent_0nvke4f"><dc:Bounds x="3115" y="394" width="36" height="36" /></bpmndi:BPMNShape><bpmndi:BPMNShape id="ServiceTask_0u57waj_di" bpmnElement="ServiceTask_0u57waj"><dc:Bounds x="3214" y="1030" width="100" height="80" /></bpmndi:BPMNShape><bpmndi:BPMNShape id="ServiceTask_0qu1p49_di" bpmnElement="ServiceTask_0qu1p49"><dc:Bounds x="1793" y="110" width="100" height="80" /></bpmndi:BPMNShape><bpmndi:BPMNShape id="UserTask_0flnlk6_di" bpmnElement="UserTask_0flnlk6" bioc:stroke="rgb(67, 160, 71)" bioc:fill="rgb(200, 230, 201)"><dc:Bounds x="1793" y="210" width="100" height="80" /></bpmndi:BPMNShape><bpmndi:BPMNShape id="ServiceTask_09t4e6t_di" bpmnElement="ServiceTask_09t4e6t"><dc:Bounds x="2006" y="110" width="100" height="80" /></bpmndi:BPMNShape><bpmndi:BPMNShape id="UserTask_00zq93g_di" bpmnElement="UserTask_00zq93g" bioc:stroke="rgb(67, 160, 71)" bioc:fill="rgb(200, 230, 201)"><dc:Bounds x="2690" y="372" width="100" height="80" /></bpmndi:BPMNShape><bpmndi:BPMNShape id="ServiceTask_1j8iddj_di" bpmnElement="ServiceTask_1j8iddj"><dc:Bounds x="2810" y="380" width="100" height="80" /></bpmndi:BPMNShape><bpmndi:BPMNShape id="ServiceTask_0rl1xal_di" bpmnElement="ServiceTask_0rl1xal"><dc:Bounds x="2997" y="372" width="100" height="80" /></bpmndi:BPMNShape><bpmndi:BPMNShape id="UserTask_1rjmihl_di" bpmnElement="UserTask_1rjmihl" bioc:stroke="rgb(67, 160, 71)" bioc:fill="rgb(200, 230, 201)"><dc:Bounds x="2544" y="1108" width="100" height="80" /></bpmndi:BPMNShape><bpmndi:BPMNShape id="ServiceTask_0z2e3v7_di" bpmnElement="ServiceTask_0z2e3v7"><dc:Bounds x="2544" y="1223" width="100" height="80" /></bpmndi:BPMNShape><bpmndi:BPMNShape id="ServiceTask_0or4j9x_di" bpmnElement="ServiceTask_0or4j9x"><dc:Bounds x="2745" y="1223" width="100" height="80" /></bpmndi:BPMNShape><bpmndi:BPMNShape id="IntermediateCatchEvent_0xow9i1_di" bpmnElement="IntermediateCatchEvent_0xow9i1"><dc:Bounds x="1932" y="132" width="36" height="36" /></bpmndi:BPMNShape><bpmndi:BPMNShape id="IntermediateCatchEvent_0omv0cn_di" bpmnElement="IntermediateCatchEvent_0omv0cn"><dc:Bounds x="2666" y="1245" width="36" height="36" /></bpmndi:BPMNShape><bpmndi:BPMNShape id="IntermediateCatchEvent_1r0ybt7_di" bpmnElement="IntermediateCatchEvent_1r0ybt7"><dc:Bounds x="2940" y="394" width="36" height="36" /></bpmndi:BPMNShape><bpmndi:BPMNShape id="ServiceTask_1g0fkru_di" bpmnElement="ServiceTask_1g0fkru"><dc:Bounds x="4120" y="494" width="100" height="80" /></bpmndi:BPMNShape><bpmndi:BPMNShape id="ServiceTask_1ky2tca_di" bpmnElement="ServiceTask_1ky2tca"><dc:Bounds x="3940" y="494" width="100" height="80" /></bpmndi:BPMNShape><bpmndi:BPMNShape id="ServiceTask_0kljyn1_di" bpmnElement="ServiceTask_0kljyn1"><dc:Bounds x="3750" y="494" width="100" height="80" /></bpmndi:BPMNShape><bpmndi:BPMNShape id="ServiceTask_0mfco4f_di" bpmnElement="ServiceTask_0mfco4f"><dc:Bounds x="3620" y="494" width="100" height="80" /></bpmndi:BPMNShape><bpmndi:BPMNShape id="ServiceTask_03opyk2_di" bpmnElement="ServiceTask_03opyk2"><dc:Bounds x="4290" y="494" width="100" height="80" /></bpmndi:BPMNShape><bpmndi:BPMNShape id="ServiceTask_0my8nbr_di" bpmnElement="ServiceTask_0my8nbr"><dc:Bounds x="4420" y="494" width="100" height="80" /></bpmndi:BPMNShape><bpmndi:BPMNShape id="Gateway_06idv35_di" bpmnElement="Gateway_06idv35" isMarkerVisible="true"><dc:Bounds x="875" y="509" width="50" height="50" /></bpmndi:BPMNShape><bpmndi:BPMNShape id="Gateway_0q58c4k_di" bpmnElement="Gateway_0q58c4k" isMarkerVisible="true"><dc:Bounds x="2325" y="387" width="50" height="50" /></bpmndi:BPMNShape><bpmndi:BPMNShape id="Activity_0f82yz0_di" bpmnElement="Activity_0f82yz0"><dc:Bounds x="2300" y="240" width="100" height="80" /></bpmndi:BPMNShape><bpmndi:BPMNShape id="Event_0y07o51_di" bpmnElement="Event_0y07o51"><dc:Bounds x="2332" y="152" width="36" height="36" /></bpmndi:BPMNShape><bpmndi:BPMNShape id="Gateway_0dx88ba_di" bpmnElement="Gateway_0dx88ba" isMarkerVisible="true"><dc:Bounds x="2659" y="668" width="50" height="50" /></bpmndi:BPMNShape><bpmndi:BPMNShape id="Event_0d62ib1_di" bpmnElement="Event_0d62ib1"><dc:Bounds x="2666" y="772" width="36" height="36" /></bpmndi:BPMNShape><bpmndi:BPMNShape id="Gateway_1cm5ela_di" bpmnElement="Gateway_1cm5ela" isMarkerVisible="true"><dc:Bounds x="3108" y="509" width="50" height="50" /></bpmndi:BPMNShape><bpmndi:BPMNShape id="Activity_12gmm1b_di" bpmnElement="Activity_12gmm1b"><dc:Bounds x="260" y="494" width="100" height="80" /></bpmndi:BPMNShape><bpmndi:BPMNShape id="Activity_0em0qo1_di" bpmnElement="Activity_0em0qo1"><dc:Bounds x="1456" y="410" width="100" height="80" /></bpmndi:BPMNShape><bpmndi:BPMNShape id="ScriptTask_0sj004j_di" bpmnElement="ScriptTask_0sj004j"><dc:Bounds x="4830" y="494" width="100" height="80" /></bpmndi:BPMNShape><bpmndi:BPMNShape id="ServiceTask_0gne7iq_di" bpmnElement="ServiceTask_0gne7iq"><dc:Bounds x="5420" y="494" width="100" height="80" /></bpmndi:BPMNShape><bpmndi:BPMNShape id="ServiceTask_01y3qlq_di" bpmnElement="ServiceTask_01y3qlq"><dc:Bounds x="5000" y="494" width="100" height="80" /></bpmndi:BPMNShape><bpmndi:BPMNShape id="Activity_0f5n612_di" bpmnElement="Activity_0f5n612"><dc:Bounds x="3214" y="890" width="100" height="80" /></bpmndi:BPMNShape></bpmndi:BPMNPlane></bpmndi:BPMNDiagram></bpmn:definitions>