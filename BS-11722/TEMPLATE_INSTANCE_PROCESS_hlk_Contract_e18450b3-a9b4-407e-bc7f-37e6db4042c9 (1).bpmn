<?xml version="1.0" encoding="UTF-8"?>
<bpmn:definitions xmlns:bpmn="http://www.omg.org/spec/BPMN/20100524/MODEL" xmlns:bpmndi="http://www.omg.org/spec/BPMN/20100524/DI" xmlns:camunda="http://camunda.org/schema/1.0/bpmn" xmlns:dc="http://www.omg.org/spec/DD/20100524/DC" xmlns:di="http://www.omg.org/spec/DD/20100524/DI" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" id="Definitions_1" targetNamespace="http://bpmn.io/schema/bpmn" exporter="Camunda Modeler" exporterVersion="4.8.1"><bpmn:process id="TEMPLATE_INSTANCE_PROCESS_hlk_Contract_e18450b3-a9b4-407e-bc7f-37e6db4042c9" name="Договор" isExecutable="true"><bpmn:documentation /><bpmn:startEvent id="StartEvent_1"><bpmn:outgoing>SequenceFlow_1hz4o8j</bpmn:outgoing></bpmn:startEvent><bpmn:endEvent id="EndEvent_0djl7a3"><bpmn:incoming>SequenceFlow_049okmm</bpmn:incoming></bpmn:endEvent><bpmn:sequenceFlow id="SequenceFlow_049okmm" sourceRef="Task_1ujk4ck" targetRef="EndEvent_0djl7a3" /><bpmn:serviceTask id="Task_1ujk4ck" name="Сообщаем об окончании процесса"><bpmn:extensionElements><camunda:connector><camunda:inputOutput><camunda:inputParameter name="url">${ezdocUrl}/api/camunda/instance/book/processCompleted/${instanceId}</camunda:inputParameter><camunda:inputParameter name="method">POST</camunda:inputParameter><camunda:inputParameter name="headers"><camunda:map><camunda:entry key="Accept">*/*</camunda:entry></camunda:map></camunda:inputParameter></camunda:inputOutput><camunda:connectorId>http-connector</camunda:connectorId></camunda:connector></bpmn:extensionElements><bpmn:incoming>Flow_05gl2sb</bpmn:incoming><bpmn:outgoing>SequenceFlow_049okmm</bpmn:outgoing></bpmn:serviceTask><bpmn:exclusiveGateway id="ExclusiveGateway_1s9burm" default="SequenceFlow_0ovci8f"><bpmn:incoming>SequenceFlow_07srucp</bpmn:incoming><bpmn:outgoing>SequenceFlow_01adqv5</bpmn:outgoing><bpmn:outgoing>SequenceFlow_0ovci8f</bpmn:outgoing></bpmn:exclusiveGateway><bpmn:serviceTask id="ServiceTask_0rjg57o" name="определяем primaryId клиента" camunda:asyncBefore="true"><bpmn:extensionElements><camunda:connector><camunda:inputOutput><camunda:inputParameter name="url">${ezdocUrl}/api/camunda/instance/book/${instanceId}/getAttributes?systemName=hlk_InContract_ID_Client</camunda:inputParameter><camunda:inputParameter name="headers"><camunda:map><camunda:entry key="Accept">*/*</camunda:entry><camunda:entry key="Content-Type">application/json</camunda:entry></camunda:map></camunda:inputParameter><camunda:inputParameter name="method">GET</camunda:inputParameter><camunda:outputParameter name="hlk_client_app"><camunda:script scriptFormat="javascript">JSON.parse(response).hlk_InContract_ID_Client</camunda:script></camunda:outputParameter></camunda:inputOutput><camunda:connectorId>http-connector</camunda:connectorId></camunda:connector></bpmn:extensionElements><bpmn:incoming>SequenceFlow_1hz4o8j</bpmn:incoming><bpmn:outgoing>SequenceFlow_07srucp</bpmn:outgoing></bpmn:serviceTask><bpmn:serviceTask id="ServiceTask_09gac56" name="Определяем _id клиента ФЛ"><bpmn:extensionElements><camunda:connector><camunda:inputOutput><camunda:inputParameter name="url">${ezdocUrl}/api/camunda/common/executeRequest</camunda:inputParameter><camunda:inputParameter name="method">POST</camunda:inputParameter><camunda:inputParameter name="headers"><camunda:map><camunda:entry key="Accept">*/*</camunda:entry><camunda:entry key="Content-Type">application/json</camunda:entry></camunda:map></camunda:inputParameter><camunda:inputParameter name="payload">{"find":"individualPerson","filter":{"primaryId":"${hlk_client_app}","activityStatus":"ACTIVE"},"projection":{"attributes.ShortName":1}}</camunda:inputParameter><camunda:outputParameter name="referenceId"><camunda:script scriptFormat="javascript">JSON.parse(response).cursor.firstBatch[0]._id</camunda:script></camunda:outputParameter><camunda:outputParameter name="ShortName"><camunda:script scriptFormat="javascript">JSON.parse(response).cursor.firstBatch[0].attributes.ShortName</camunda:script></camunda:outputParameter></camunda:inputOutput><camunda:connectorId>http-connector</camunda:connectorId></camunda:connector></bpmn:extensionElements><bpmn:incoming>Flow_1xxcx2w</bpmn:incoming><bpmn:outgoing>Flow_1es64n2</bpmn:outgoing></bpmn:serviceTask><bpmn:serviceTask id="ServiceTask_1cl7ar5" name="Записываем владельца ФЛ"><bpmn:extensionElements><camunda:connector><camunda:inputOutput><camunda:inputParameter name="url">${ezdocUrl}/api/camunda/instance/book/${instanceId}/setAttributes</camunda:inputParameter><camunda:inputParameter name="method">POST</camunda:inputParameter><camunda:inputParameter name="headers"><camunda:map><camunda:entry key="Accept">*/*</camunda:entry><camunda:entry key="Content-Type">application/json</camunda:entry></camunda:map></camunda:inputParameter><camunda:inputParameter name="payload">{"hlk_client_FL" : {
"value" : "${ShortName}",
"primaryId" : "${hlk_client_app}",
"source" : "individualPerson",
   "_class" : "egar.ezdoc.model.entity.attribute.DictionaryValue"
}}</camunda:inputParameter></camunda:inputOutput><camunda:connectorId>http-connector</camunda:connectorId></camunda:connector></bpmn:extensionElements><bpmn:incoming>Flow_1es64n2</bpmn:incoming><bpmn:outgoing>SequenceFlow_02jeon2</bpmn:outgoing></bpmn:serviceTask><bpmn:sequenceFlow id="SequenceFlow_01adqv5" sourceRef="ExclusiveGateway_1s9burm" targetRef="Gateway_0wcmleo"><bpmn:conditionExpression xsi:type="bpmn:tFormalExpression">${hlk_client_app == null}</bpmn:conditionExpression></bpmn:sequenceFlow><bpmn:sequenceFlow id="SequenceFlow_07srucp" sourceRef="ServiceTask_0rjg57o" targetRef="ExclusiveGateway_1s9burm" /><bpmn:sequenceFlow id="SequenceFlow_0ovci8f" sourceRef="ExclusiveGateway_1s9burm" targetRef="Activity_1t2gvhc" /><bpmn:sequenceFlow id="SequenceFlow_1hz4o8j" sourceRef="StartEvent_1" targetRef="ServiceTask_0rjg57o" /><bpmn:sequenceFlow id="SequenceFlow_02jeon2" sourceRef="ServiceTask_1cl7ar5" targetRef="Activity_1xp3wou" /><bpmn:sequenceFlow id="Flow_1xxcx2w" name="ФЛ" sourceRef="Gateway_0iq9d0i" targetRef="ServiceTask_09gac56"><bpmn:conditionExpression xsi:type="bpmn:tFormalExpression">${found == true}</bpmn:conditionExpression></bpmn:sequenceFlow><bpmn:exclusiveGateway id="Gateway_0iq9d0i" default="Flow_18xhzt1"><bpmn:incoming>Flow_0m2h76c</bpmn:incoming><bpmn:outgoing>Flow_1xxcx2w</bpmn:outgoing><bpmn:outgoing>Flow_18xhzt1</bpmn:outgoing></bpmn:exclusiveGateway><bpmn:serviceTask id="Activity_1b3w4qm" name="Записываем владельца ЮЛ"><bpmn:extensionElements><camunda:connector><camunda:inputOutput><camunda:inputParameter name="url">${ezdocUrl}/api/camunda/instance/book/${instanceId}/setAttributes</camunda:inputParameter><camunda:inputParameter name="method">POST</camunda:inputParameter><camunda:inputParameter name="headers"><camunda:map><camunda:entry key="Accept">*/*</camunda:entry><camunda:entry key="Content-Type">application/json</camunda:entry></camunda:map></camunda:inputParameter><camunda:inputParameter name="payload">{"hlk_client_FL" : {
"value" : "${ShortName}",
"primaryId" : "${hlk_client_app}",
"source" : "legalEntity",
   "_class" : "egar.ezdoc.model.entity.attribute.DictionaryValue"
}}</camunda:inputParameter></camunda:inputOutput><camunda:connectorId>http-connector</camunda:connectorId></camunda:connector></bpmn:extensionElements><bpmn:incoming>Flow_1knfrj1</bpmn:incoming><bpmn:outgoing>Flow_059clws</bpmn:outgoing></bpmn:serviceTask><bpmn:sequenceFlow id="Flow_18xhzt1" sourceRef="Gateway_0iq9d0i" targetRef="Activity_1sqne12" /><bpmn:serviceTask id="Activity_1sqne12" name="Определяем _id клиента ЮЛ"><bpmn:extensionElements><camunda:connector><camunda:inputOutput><camunda:inputParameter name="url">${ezdocUrl}/api/camunda/common/executeRequest</camunda:inputParameter><camunda:inputParameter name="method">POST</camunda:inputParameter><camunda:inputParameter name="headers"><camunda:map><camunda:entry key="Accept">*/*</camunda:entry><camunda:entry key="Content-Type">application/json</camunda:entry></camunda:map></camunda:inputParameter><camunda:inputParameter name="payload">{"find":"legalEntity","filter":{"primaryId":"${hlk_client_app}","activityStatus":"ACTIVE"},"projection":{"attributes.ShortName":1}}</camunda:inputParameter><camunda:outputParameter name="referenceId"><camunda:script scriptFormat="javascript">JSON.parse(response).cursor.firstBatch[0]._id</camunda:script></camunda:outputParameter><camunda:outputParameter name="ShortName"><camunda:script scriptFormat="javascript">JSON.parse(response).cursor.firstBatch[0].attributes.ShortName</camunda:script></camunda:outputParameter></camunda:inputOutput><camunda:connectorId>http-connector</camunda:connectorId></camunda:connector></bpmn:extensionElements><bpmn:incoming>Flow_18xhzt1</bpmn:incoming><bpmn:outgoing>Flow_1knfrj1</bpmn:outgoing></bpmn:serviceTask><bpmn:sequenceFlow id="Flow_059clws" sourceRef="Activity_1b3w4qm" targetRef="Activity_0awtudz" /><bpmn:serviceTask id="Activity_1t2gvhc" name="Определяем,  ФЛ или ЮЛ"><bpmn:extensionElements><camunda:connector><camunda:inputOutput><camunda:inputParameter name="url">${ezdocUrl}/api/camunda/common/executeRequest</camunda:inputParameter><camunda:inputParameter name="method">POST</camunda:inputParameter><camunda:inputParameter name="headers"><camunda:map><camunda:entry key="Accept">*/*</camunda:entry><camunda:entry key="Content-Type">application/json</camunda:entry></camunda:map></camunda:inputParameter><camunda:inputParameter name="payload">{"find":"individualPerson","filter":{"primaryId":"${hlk_client_app}","activityStatus":"ACTIVE"},"projection":{"attributes.ShortName":1}}</camunda:inputParameter><camunda:outputParameter name="found"><camunda:script scriptFormat="javascript">!!JSON.parse(response).cursor.firstBatch.length</camunda:script></camunda:outputParameter></camunda:inputOutput><camunda:connectorId>http-connector</camunda:connectorId></camunda:connector></bpmn:extensionElements><bpmn:incoming>SequenceFlow_0ovci8f</bpmn:incoming><bpmn:outgoing>Flow_0m2h76c</bpmn:outgoing></bpmn:serviceTask><bpmn:sequenceFlow id="Flow_0m2h76c" sourceRef="Activity_1t2gvhc" targetRef="Gateway_0iq9d0i" /><bpmn:sequenceFlow id="Flow_1es64n2" sourceRef="ServiceTask_09gac56" targetRef="ServiceTask_1cl7ar5" /><bpmn:sequenceFlow id="Flow_1knfrj1" sourceRef="Activity_1sqne12" targetRef="Activity_1b3w4qm" /><bpmn:exclusiveGateway id="Gateway_0wcmleo"><bpmn:incoming>SequenceFlow_01adqv5</bpmn:incoming><bpmn:incoming>Flow_14x17vt</bpmn:incoming><bpmn:incoming>Flow_1t23fpt</bpmn:incoming><bpmn:outgoing>Flow_05gl2sb</bpmn:outgoing></bpmn:exclusiveGateway><bpmn:sequenceFlow id="Flow_05gl2sb" sourceRef="Gateway_0wcmleo" targetRef="Task_1ujk4ck" /><bpmn:serviceTask id="Activity_1xp3wou" name="Проставление в ФЛ признака Действующего Договора" camunda:asyncAfter="true"><bpmn:extensionElements><camunda:properties><camunda:property name="isEzdocServiceTask" value="true" /><camunda:property name="ezdocServiceTaskType" value="request" /><camunda:property name="requestType" value="GENERIC" /></camunda:properties><camunda:connector><camunda:inputOutput><camunda:inputParameter name="headers"><camunda:map><camunda:entry key="Accept">*/*</camunda:entry><camunda:entry key="Content-Type">application/json</camunda:entry></camunda:map></camunda:inputParameter><camunda:inputParameter name="url">${ezdocUrl}/api/camunda/instance/individual/${referenceId}/update/</camunda:inputParameter><camunda:inputParameter name="method">POST</camunda:inputParameter><camunda:inputParameter name="payload">{"Current_agreement": true}</camunda:inputParameter><camunda:outputParameter name="rrr">${response}</camunda:outputParameter></camunda:inputOutput><camunda:connectorId>http-connector</camunda:connectorId></camunda:connector></bpmn:extensionElements><bpmn:incoming>SequenceFlow_02jeon2</bpmn:incoming><bpmn:outgoing>Flow_14x17vt</bpmn:outgoing></bpmn:serviceTask><bpmn:sequenceFlow id="Flow_14x17vt" sourceRef="Activity_1xp3wou" targetRef="Gateway_0wcmleo" /><bpmn:serviceTask id="Activity_0awtudz" name="Проставление в ЮЛ признака Действующего Договора" camunda:asyncAfter="true"><bpmn:extensionElements><camunda:properties><camunda:property name="isEzdocServiceTask" value="true" /><camunda:property name="ezdocServiceTaskType" value="request" /><camunda:property name="requestType" value="GENERIC" /></camunda:properties><camunda:connector><camunda:inputOutput><camunda:inputParameter name="headers"><camunda:map><camunda:entry key="Accept">*/*</camunda:entry><camunda:entry key="Content-Type">application/json</camunda:entry></camunda:map></camunda:inputParameter><camunda:inputParameter name="url">${ezdocUrl}/api/camunda/instance/legalEntity/${referenceId}/update/</camunda:inputParameter><camunda:inputParameter name="method">POST</camunda:inputParameter><camunda:inputParameter name="payload">{"Current_agreement": true}</camunda:inputParameter><camunda:outputParameter name="rrr">${response}</camunda:outputParameter></camunda:inputOutput><camunda:connectorId>http-connector</camunda:connectorId></camunda:connector></bpmn:extensionElements><bpmn:incoming>Flow_059clws</bpmn:incoming><bpmn:outgoing>Flow_1t23fpt</bpmn:outgoing></bpmn:serviceTask><bpmn:sequenceFlow id="Flow_1t23fpt" sourceRef="Activity_0awtudz" targetRef="Gateway_0wcmleo" /></bpmn:process><bpmndi:BPMNDiagram id="BPMNDiagram_1"><bpmndi:BPMNPlane id="BPMNPlane_1" bpmnElement="TEMPLATE_INSTANCE_PROCESS_hlk_Contract_e18450b3-a9b4-407e-bc7f-37e6db4042c9"><bpmndi:BPMNEdge id="Flow_1t23fpt_di" bpmnElement="Flow_1t23fpt"><di:waypoint x="1150" y="120" /><di:waypoint x="1250" y="120" /><di:waypoint x="1250" y="335" /></bpmndi:BPMNEdge><bpmndi:BPMNEdge id="Flow_14x17vt_di" bpmnElement="Flow_14x17vt"><di:waypoint x="1200" y="240" /><di:waypoint x="1250" y="240" /><di:waypoint x="1250" y="335" /></bpmndi:BPMNEdge><bpmndi:BPMNEdge id="Flow_05gl2sb_di" bpmnElement="Flow_05gl2sb"><di:waypoint x="1275" y="360" /><di:waypoint x="1460" y="360" /></bpmndi:BPMNEdge><bpmndi:BPMNEdge id="Flow_1knfrj1_di" bpmnElement="Flow_1knfrj1"><di:waypoint x="700" y="120" /><di:waypoint x="820" y="120" /></bpmndi:BPMNEdge><bpmndi:BPMNEdge id="Flow_1es64n2_di" bpmnElement="Flow_1es64n2"><di:waypoint x="860" y="240" /><di:waypoint x="950" y="240" /></bpmndi:BPMNEdge><bpmndi:BPMNEdge id="Flow_0m2h76c_di" bpmnElement="Flow_0m2h76c"><di:waypoint x="557" y="240" /><di:waypoint x="625" y="240" /></bpmndi:BPMNEdge><bpmndi:BPMNEdge id="Flow_059clws_di" bpmnElement="Flow_059clws"><di:waypoint x="920" y="120" /><di:waypoint x="1050" y="120" /></bpmndi:BPMNEdge><bpmndi:BPMNEdge id="Flow_18xhzt1_di" bpmnElement="Flow_18xhzt1"><di:waypoint x="650" y="215" /><di:waypoint x="650" y="160" /></bpmndi:BPMNEdge><bpmndi:BPMNEdge id="Flow_1xxcx2w_di" bpmnElement="Flow_1xxcx2w"><di:waypoint x="675" y="240" /><di:waypoint x="760" y="240" /><bpmndi:BPMNLabel><dc:Bounds x="710" y="222" width="16" height="14" /></bpmndi:BPMNLabel></bpmndi:BPMNEdge><bpmndi:BPMNEdge id="SequenceFlow_02jeon2_di" bpmnElement="SequenceFlow_02jeon2"><di:waypoint x="1050" y="240" /><di:waypoint x="1100" y="240" /></bpmndi:BPMNEdge><bpmndi:BPMNEdge id="SequenceFlow_1hz4o8j_di" bpmnElement="SequenceFlow_1hz4o8j"><di:waypoint x="188" y="360" /><di:waypoint x="277" y="360" /></bpmndi:BPMNEdge><bpmndi:BPMNEdge id="SequenceFlow_0ovci8f_di" bpmnElement="SequenceFlow_0ovci8f"><di:waypoint x="507" y="335" /><di:waypoint x="507" y="280" /></bpmndi:BPMNEdge><bpmndi:BPMNEdge id="SequenceFlow_07srucp_di" bpmnElement="SequenceFlow_07srucp"><di:waypoint x="377" y="360" /><di:waypoint x="482" y="360" /></bpmndi:BPMNEdge><bpmndi:BPMNEdge id="SequenceFlow_01adqv5_di" bpmnElement="SequenceFlow_01adqv5"><di:waypoint x="532" y="360" /><di:waypoint x="1225" y="360" /></bpmndi:BPMNEdge><bpmndi:BPMNEdge id="SequenceFlow_049okmm_di" bpmnElement="SequenceFlow_049okmm"><di:waypoint x="1560" y="360" /><di:waypoint x="1612" y="360" /><bpmndi:BPMNLabel><dc:Bounds x="1026.5" y="99" width="0" height="12" /></bpmndi:BPMNLabel></bpmndi:BPMNEdge><bpmndi:BPMNShape id="_BPMNShape_StartEvent_2" bpmnElement="StartEvent_1"><dc:Bounds x="152" y="342" width="36" height="36" /></bpmndi:BPMNShape><bpmndi:BPMNShape id="EndEvent_0djl7a3_di" bpmnElement="EndEvent_0djl7a3"><dc:Bounds x="1612" y="342" width="36" height="36" /><bpmndi:BPMNLabel><dc:Bounds x="1064" y="142" width="90" height="12" /></bpmndi:BPMNLabel></bpmndi:BPMNShape><bpmndi:BPMNShape id="ServiceTask_1ezl3om_di" bpmnElement="Task_1ujk4ck"><dc:Bounds x="1460" y="320" width="100" height="80" /></bpmndi:BPMNShape><bpmndi:BPMNShape id="ExclusiveGateway_1s9burm_di" bpmnElement="ExclusiveGateway_1s9burm" isMarkerVisible="true"><dc:Bounds x="482" y="335" width="50" height="50" /></bpmndi:BPMNShape><bpmndi:BPMNShape id="ServiceTask_0rjg57o_di" bpmnElement="ServiceTask_0rjg57o"><dc:Bounds x="277" y="320" width="100" height="80" /></bpmndi:BPMNShape><bpmndi:BPMNShape id="ServiceTask_09gac56_di" bpmnElement="ServiceTask_09gac56"><dc:Bounds x="760" y="200" width="100" height="80" /></bpmndi:BPMNShape><bpmndi:BPMNShape id="ServiceTask_1cl7ar5_di" bpmnElement="ServiceTask_1cl7ar5"><dc:Bounds x="950" y="200" width="100" height="80" /></bpmndi:BPMNShape><bpmndi:BPMNShape id="Gateway_0uzsfic_di" bpmnElement="Gateway_0iq9d0i" isMarkerVisible="true"><dc:Bounds x="625" y="215" width="50" height="50" /></bpmndi:BPMNShape><bpmndi:BPMNShape id="Activity_1b3w4qm_di" bpmnElement="Activity_1b3w4qm"><dc:Bounds x="820" y="80" width="100" height="80" /></bpmndi:BPMNShape><bpmndi:BPMNShape id="Activity_1sqne12_di" bpmnElement="Activity_1sqne12"><dc:Bounds x="600" y="80" width="100" height="80" /></bpmndi:BPMNShape><bpmndi:BPMNShape id="Activity_1t2gvhc_di" bpmnElement="Activity_1t2gvhc"><dc:Bounds x="457" y="200" width="100" height="80" /></bpmndi:BPMNShape><bpmndi:BPMNShape id="Gateway_0wcmleo_di" bpmnElement="Gateway_0wcmleo" isMarkerVisible="true"><dc:Bounds x="1225" y="335" width="50" height="50" /></bpmndi:BPMNShape><bpmndi:BPMNShape id="Activity_1xp3wou_di" bpmnElement="Activity_1xp3wou"><dc:Bounds x="1100" y="200" width="100" height="80" /></bpmndi:BPMNShape><bpmndi:BPMNShape id="Activity_0awtudz_di" bpmnElement="Activity_0awtudz"><dc:Bounds x="1050" y="80" width="100" height="80" /></bpmndi:BPMNShape></bpmndi:BPMNPlane></bpmndi:BPMNDiagram></bpmn:definitions>